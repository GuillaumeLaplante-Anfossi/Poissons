\documentclass{amsart}

\usepackage[T1]{fontenc}
\usepackage{enumerate, amsmath, amsfonts, amssymb, amsthm, mathrsfs, wasysym, graphics, graphicx, xcolor, url, hyperref, hypcap, shuffle, xargs, multicol, overpic, pdflscape, multirow, hvfloat, minibox, accents, array, multido, xifthen, a4wide, ae, aecompl, blkarray, pifont, mathtools, etoolbox, dsfont, stmaryrd}
\usepackage{marginnote}
\hypersetup{colorlinks=true, citecolor=darkblue, linkcolor=darkblue}
\usepackage[all]{xy}
\usepackage[bottom]{footmisc}
\usepackage{tikz, tikz-cd, tikz-qtree}
\usetikzlibrary{trees, decorations, decorations.markings, shapes, arrows, matrix, calc, fit, intersections, patterns, angles, snakes}
\usepackage[external]{forest}
%\tikzexternalize
\graphicspath{{figures/}{figures/nodes/}}
\makeatletter\def\input@path{{figures/}}\makeatother
\usepackage{caption}
\captionsetup{width=\textwidth}
\renewcommand{\topfraction}{1} % possibility to have one page of pictures
\renewcommand{\bottomfraction}{1} % possibility to have one page of pictures
\usepackage[noabbrev,capitalise]{cleveref}
\usepackage[export]{adjustbox}
\usepackage{ulem}\normalem
\usepackage{xargs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% colors
\definecolor{darkblue}{rgb}{0,0,0.7} % darkblue color
\definecolor{green}{RGB}{57,181,74} % green color
\definecolor{violet}{RGB}{147,39,143} % violet color
\newcommand{\red}{\color{red}} % red command
\newcommand{\blue}{\color{blue}} % blue command
\newcommand{\orange}{\color{orange}} % orange command
\newcommand{\green}{\color{green}} % green command
\newcommand{\darkblue}{\color{darkblue}} % darkblue command

% marginal comments
\usepackage{todonotes}
\newcommand{\vincent}[1]{\todo[color=blue!30]{\rm #1 \\ \hfill --- V.}}
\newcommand{\vincenti}[1]{\todo[color=blue!30, inline]{\rm #1 \\ \hfill --- V.}}
\newcommand{\Guillaume}[1]{\todo[color=magenta!30]{\rm #1 \\ \hfill --- G.}}
\newcommand{\Kurt}[1]{\todo[color=orange!30]{\rm #1 \\ \hfill --- K.}}
\newcommand{\BDO}[1]{\todo[color=green!30]{\rm #1 \\ \hfill --- B.}}
\newcommand{\BDOi}[1]{\todo[color=green!30, inline]{\rm #1 \\ \hfill --- B.}}

% theorems
\newtheorem{theorem}{Theorem}[section]
\newtheorem*{theorem*}{Theorem}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{construction}[theorem]{Construction}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{question}[theorem]{Question}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{assumption}[theorem]{Assumption}
\crefname{notation}{Notation}{Notations}
\crefname{problem}{Problem}{Problems}

% math special letters
\newcommand{\R}{\mathbb{R}} % reals
\newcommand{\N}{\mathbb{N}} % naturals
\newcommand{\Z}{\mathbb{Z}} % integers
\newcommand{\C}{\mathbb{C}} % complex
\newcommand{\I}{\mathbb{I}} % set of integers
\newcommand{\K}{\mathbb{K}} % field
\newcommand{\fA}{\mathfrak{A}} % alternating group
\newcommand{\fB}{\mathfrak{S}^\textsc{b}} % signed symmetric group
\newcommand{\cA}{\mathcal{A}} % algebra
\newcommand{\cC}{\mathcal{C}} % collection
\newcommand{\cS}{\mathcal{S}} % ground set
\newcommand{\uR}{\underline{R}} % underline set
\newcommand{\uS}{\underline{S}} % underline set
\newcommand{\uT}{\underline{T}} % underline set
\newcommand{\oS}{\overline{S}} % overline set
\newcommand{\ucS}{\underline{\cS}} % underline ground set
\renewcommand{\b}[1]{{\boldsymbol{#1}}} % bold letters
\newcommand{\bb}[1]{\mathbb{#1}} % bb letters
\newcommand{\f}[1]{\mathfrak{#1}} % frak letters
\newcommand{\h}{\widehat} % hat letters

\newcommand{\Un}{\mathrm{U}} % unordered IJ
\newcommand{\Or}{\mathrm{O}} % ordered IJ

% math commands
\newcommand{\set}[2]{\left\{ #1 \;\middle|\; #2 \right\}} % set notation
\newcommand{\bigset}[2]{\big\{ #1 \;\big|\; #2 \big\}} % big set notation
\newcommand{\Bigset}[2]{\Big\{ #1 \;\Big|\; #2 \Big\}} % Big set notation
\newcommand{\setangle}[2]{\left\langle #1 \;\middle|\; #2 \right\rangle} % set notation
\newcommand{\ssm}{\smallsetminus} % small set minus
\newcommand{\dotprod}[2]{\left\langle \, #1 \; \middle| \; #2 \, \right\rangle} % dot product
\newcommand{\symdif}{\,\triangle\,} % symmetric difference
\newcommand{\one}{\b{1}} % the all one vector
\newcommand{\eqdef}{\mbox{\,\raisebox{0.2ex}{\scriptsize\ensuremath{\mathrm:}}\ensuremath{=}\,}} % :=
\newcommand{\defeq}{\mbox{~\ensuremath{=}\raisebox{0.2ex}{\scriptsize\ensuremath{\mathrm:}} }} % =:
\newcommand{\simplex}{\b{\triangle}} % simplex
\renewcommand{\implies}{\Rightarrow} % imply sign
\newcommand{\transpose}[1]{{#1}^t} % transpose matrix
\renewcommand{\complement}[1]{\bar{#1}} % complement

% operators
\DeclareMathOperator{\conv}{conv} % convex hull
\DeclareMathOperator{\vect}{vect} % linear span
\DeclareMathOperator{\cone}{cone} % cone hull
\DeclareMathOperator{\Inv}{Inv} % inversions
\DeclareMathOperator{\inv}{inv} % inversions
\DeclareMathOperator{\Ima}{Im} %Image d'une fonction
\DeclareMathOperator{\std}{std}

% others
\newcommand{\ie}{\textit{i.e.}~} % id est
\newcommand{\eg}{\textit{e.g.}~} % exempli gratia
\newcommand{\Eg}{\textit{E.g.}~} % exempli gratia
\newcommand{\apriori}{\textit{a priori}} % a priori
\newcommand{\viceversa}{\textit{vice versa}} % vice versa
\newcommand{\versus}{\textit{vs.}~} % versus
\newcommand{\aka}{\textit{a.k.a.}~} % also known as
\newcommand{\perse}{\textit{per se}} % per se
\newcommand{\ordinal}{\textsuperscript{th}} % th for ordinals
\newcommand{\ordinalst}{\textsuperscript{st}} % st for ordinals
\newcommand{\defn}[1]{\textsl{\darkblue #1}} % emphasis of a definition
\newcommand{\para}[1]{\medskip\noindent\uline{#1.}} % paragraph
\renewcommand{\topfraction}{1} % possibility to have one page of pictures
\renewcommand{\bottomfraction}{1} % possibility to have one page of pictures
\newcommand{\imagetop}[1]{\vtop{\null\hbox{#1}}} % image aligned top
\newcommand{\OEIS}[1]{\cite[{\rm \href{http://oeis.org/#1}{\texttt{#1}}}]{OEIS}}

%Hyperplane arrangements
\renewcommand{\b}[1]{\boldsymbol{#1}} % bold
\newcommandx{\arrangement}[1][1 = A]{\mathcal{#1}} % arrangement
\newcommand{\HH}{\mathbb{H}} % hyperplane
\newcommandx{\braidArrangement}[1][1 = n]{\arrangement[B]_{#1}} % braid arrangement
\newcommandx{\multiBraidArrangement}[2][1 = n, 2 = \ell]{\arrangement[B]_{#1}^{#2}} % (l,n)-braid arrangement
\newcommandx{\rank}[1][1 = \arrangement]{\operatorname{rk}(#1)} % rank
\newcommandx{\facePoset}[1][1 = \arrangement]{\mathsf{Fa}(#1)} % face poset
\newcommandx{\fPol}[2][1 = \arrangement, 2 = x]{\b{f}_{#1}(#2)} % face polynomial
\newcommandx{\bPol}[2][1 = \arrangement, 2 = x]{\b{b}_{#1}(#2)} % bounded face polynomial
\newcommandx{\flatPoset}[1][1 = \arrangement]{\mathsf{Fl}(#1)} % intersection poset
\newcommandx{\charPol}[2][1 = \arrangement, 2 = y]{\b{\chi}_{#1}(#2)} % characteristic polynomial
\newcommandx{\mobPol}[3][1 = \arrangement, 2 = x, 3 = y]{\b{\mu}_{#1}(#2, #3)} % Mobius polynomial
\newcommandx{\weirdPol}[2][1 = \arrangement, 2 = x]{\b{\pi}_{#1}(#2)} % weird polynomial
\newcommandx{\partitionPoset}[1][1 = n]{\mathsf{Pa}_{#1}} % partition poset
\newcommandx{\forestPoset}[2][1 = n, 2 = \ell]{\mathsf{Fo}_{#1}^{#2}} % partition forest poset
\newcommandx{\rainbowForests}[2][1 = n, 2 = \ell]{\mathsf{RF}_{#1}^{#2}} % rainbow forests
\newcommandx{\rainbowTrees}[2][1 = n, 2 = \ell]{\mathsf{RT}_{#1}^{#2}} % rainbow trees
\newcommandx{\Perm}[1][1 = n]{\mathsf{Perm}(#1)} % permutahedron
\makeatletter
\def\rightharpoonupfill@{\arrowfill@\relbar\relbar\rightharpoonup}
\newcommand{\overrightharpoonup}{%
\mathpalette{\overarrow@\rightharpoonupfill@}}
\makeatother
\newcommandx{\orient}[1]{\smash{\overrightharpoonup{#1}}} % ordered
\newcommandx{\orientedPartitionPoset}[1][1 = n]{\orient{\mathsf{Pa}}_{#1}} % oriented partition poset
\newcommandx{\orientedForestPoset}[2][1 = n, 2 = \ell]{\orient{\mathsf{Fo}}_{#1}^{#2}} % oriented partition forest poset

%Operadic diagonals
\newcommand{\SU}{\mathrm{SU}}
\newcommand{\LA}{\mathrm{LA}}
\newcommand{\SUD}{\triangle^{\mathrm{SU}}}
\newcommand{\LAD}{\triangle^{\mathrm{LA}}}
\newcommand{\SCP}{\mathrm{SCP}}
\newcommand{\PolySub}{\mathsf{Poly}}
\newcommand{\EC}{\mathcal{E}} %essential complimentary partitions
\newcommand{\OP}{\triangle} %ordered partitions
\newcommand{\BT}{\mathcal{B}} %bipartite trees
\newcommand{\Ainf}{\ensuremath{\mathrm{A}_\infty}}
\newcommand{\op}{\mathrm{op}}
\newcommand{\tr}{\mathrm{tr}}
\newcommand{\id}{\mathrm{id}}

%Shift operators
%\vphantom{1} ensures sequential arrows aligned.
\newcommand{\rightshift}[1]{\overrightarrow{\vphantom{1}{#1}}}
\newcommand{\rightshiftk}[2]{\overrightarrow{\vphantom{1}{#1}}^{#2}}
\newcommand{\leftshift}[1]{\overleftarrow{\vphantom{1}{#1}}}
\newcommand{\leftshiftk}[2]{\overleftarrow{\vphantom{1}{#1}}^{#2}}
%Subdiv cube defs
\newcommand{\divcube}[1]{\Box_{#1}}
\newcommand{\subdivcubeofe}{C_e}
\newcommand{\subdivcubeofouter}{C}
\newcommand{\subdivpairsev}{S_e^v}
\newcommand{\maxsubdivpairsev}{M_e^v}
\newcommand{\subdivpairsv}{S^v}
\newcommand{\maxsubdivpairsv}{M^v}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% formating the part command
\makeatletter
\def\part{\@startsection{part}{1}%
\z@{.7\linespacing\@plus\linespacing}{.8\linespacing}%
{\LARGE\sffamily\centering}}
%\@addtoreset{section}{part}
\makeatother
\renewcommand{\thepart}{\Roman{part}}
%\renewcommand{\thesection}{\arabic{part}.\arabic{section}}

% formating the table of contents
\setcounter{tocdepth}{2}
\makeatletter
\def\l@part{\@tocline{1}{8pt}{0pc}{}{}}
\def\l@section{\@tocline{1}{4pt}{0pc}{}{}}
\makeatother
\let\oldtocpart=\tocpart
\renewcommand{\tocpart}[2]{\sc\large\oldtocpart{#1}{#2}}
\let\oldtocsection=\tocsection
\renewcommand{\tocsection}[2]{\bf\oldtocsection{#1}{#2}}
\let\oldtocsubsubsection=\tocsubsubsection
\renewcommand{\tocsubsubsection}[2]{\quad\oldtocsubsubsection{#1}{#2}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{The combinatorics of the permutahedron diagonals}

\thanks{}

\author[B. Delcroix-Oger]{B\'er\'enice Delcroix-Oger}
\address[B\'{e}r\'{e}nice Delcroix-Oger]{Institut Montpelli\'erain Alexander Grothendieck, Universit\'e de Montpellier, France}
\email{berenice.delcroix-oger@umontpellier.fr}
\urladdr{\url{https://oger.perso.math.cnrs.fr/}}

\author[M. Josuat-Verg\`es]{Matthieu Josuat-Verg\`es}
\address[Matthieu Josuat-Vergès]{}
\email{}

\author[G. Laplante-Anfossi]{Guillaume Laplante-Anfossi}
\address[Guillaume Laplante-Anfossi]{School of Mathematics and Statistics, The University of Melbourne, Victoria, Australia}
\email{guillaume.laplanteanfossi@unimelb.edu.au}

\author[V. Pilaud]{Vincent Pilaud}
\address[Vincent Pilaud]{CNRS \& LIX, \'Ecole Polytechnique, Palaiseau}
\email{vincent.pilaud@lix.polytechnique.fr}
\urladdr{\url{http://www.lix.polytechnique.fr/~pilaud/}}

\author[K. Stoeckl]{Kurt Stoeckl}
\address[Kurt Stoeckl]{School of Mathematics and Statistics, The University of Melbourne, Victoria, Australia}
\email{kstoeckl@student.unimelb.edu.au}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\begin{abstract}
The purpose of this article is to provide a systematic combinatorial-geometric study of cellular diagonals on the permutahedra. 
First, we give general enumeration results for the faces of any geometric diagonal, using a theorem of Zavlasky on the M\"obius function of hyperplane arrangements.
The numbers obtained involve covering trees of bipartite graphs and Catalan families. 
Second, we prove that there are only two operadic families of diagonals on the permutahedra, and we give a bijection of their facets with planar bipartite trees and characterize their vertices as pattern-avoiding pairs of permutations.
A corollary of our study is that the Saneblidze--Umble diagonal can be recovered by a choice of vectors in the fundamental hyperplane arrangements of the permutahedra, resolving a conjecture of the third-named author.  
\end{abstract}

\vspace*{.1cm}
\maketitle

\centerline{\includegraphics[scale=.9]{diagonalPermutahedron3}}

\newpage
\enlargethispage{1cm}
\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section*{Introduction} 
\label{s:introduction}

In this article, discrete geometry \emph{informs} higher algebra.
First, we obtain some purely combinatorial results, whose study is motivated by higher algebra: the combinatorially inclined reader can read the first part of this introduction, and go directly to Section 1.
Second, we obtain some (higher) algebraic results via discrete geometry: the algebraically inclined reader can read the second part of this introduction, and go directly to Section 2.
\Guillaume{I am not sure this is the way to go anymore}

%%%%%%%%%%%%%%%

\subsection*{Motivation}

The purpose of this article is to study cellular diagonals on the permutahedra, which are cellular maps homotopic to the usual thin diagonal $\triangle : P \to P \times P, x \mapsto (x,x)$.
Such diagonals, and in particular coherent families that we call \emph{operadic} diagonals (see [DEF] \BDO{Reference ?}), are of interest in algebraic geometry and topology: via the theory of Fulton--Sturmfels \cite{fultonIntersectionTheoryToric1997a}, they give explicit formulas for the cup product on Losev--Manin toric varieties \cite{losevNewModuliSpaces2000}; they define universal tensor products of homotopy operads, and in particular universal tensor products of homotopy associative permutads (shuffle algebras) \cite{LA21}; they allow for the definition of a coproduct on permutahedral sets, which are used to models of two-fold loop spaces \cite{SaneblidzeUmble04}; and their study is moreover needed to pursue the work of Baues aiming at defining explicit combinatorial models for higher iterated loop spaces \cite{bauesGeometryLoopSpaces1980}. 
Moreover, using the canonical projections to the multiplihedra and the associahedra, they define universal tensor product of $\Ainf$-algebras and $\Ainf$-morphisms \cite{MazuirLA22}.
\Guillaume{lien avec les matroides?}

\Guillaume{Mentionner le travail en cours de Lionel Pournin?}

The toric varieties associated with the permutahedron are called Losev--Manin varieties, introduced in \cite{losevNewModuliSpaces2000}.
\Guillaume{They are De Concini--Procesi wonderful compactifications of \dots
They are also brick manifolds?}
The cohomology ring structure was studied by Losev and Manin, and quite extensively since then. \Guillaume{See for example "Graph cohomology"} 
Our current work brings a completely combinatorially explicit description of the cup product, it would be interesting to know if this new description can lead to new results, or how it can be used to recover existing ones.

Permutades

%%%%%%%%%%%%%%%

\subsection*{Combinatorics}

The purpose of the first part of this article is to study the combinatorics of the cellular diagonal of the permutohedra, explained in more details in the second part of the introduction.
 To make this part more accessible to non-algebraists, we formulate it in terms of hyperplane arrangements, as \emph{faces} of the cellular diagonal are in bijection with \emph{regions} of the associated hyperplane arrangements. 
 The hyperplane arrangement associated with  the cellular diagonal is two generically translated copies of the braid arrangement. 
 Motivated by the beautiful combinatorial formula obtained in our study, we generalize it to the study of $\ell$ generically translated copies of the braid arrangement, which would algebraically corresponds to some cellular $\ell$-gonal.
  We compute the $f$-vector and the $b$-vector of $\ell$-generically translated copies of the braid arrangement, using Zaslavsky's Theorem. 
  We refine the enumeration of the vertices of the hyperplane arrangement using a combinatorial interpretation in terms of $(\ell, n)$-trees and get the following multiplicative formula stated in Theorem \ref{thm:verticesRefinedMultiBraidArrangement} and recalled here:
\begin{theorem*}
For any~$k_1, \dots, k_\ell$ such that~$0 \le k_i \le n-1$ for~$i \in [\ell]$ and~${\sum_{i=1}^\ell k_i = n-1}$, the number of vertices~$v$ of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ such that the smallest flat of the $i$\ordinal{} copy of~$\braidArrangement$ containing~$v$ has dimension~$n-k_i-1$ is given by
\[
n^{\ell-1} \binom{n-1}{k_1, \dots, k_\ell} \prod_{i=1}^\ell (n-k_i)^{k_i-1}.
\]
\end{theorem*}

%%%%%%%%%%%%%%%

\subsection*{Higher Algebra}

The first cellular diagonal for the permutahedra was defined at the level of chains by S. Saneblidze and R. Umble in \cite{SaneblidzeUmble04}, we will call it the \emph{SU diagonal}. 
Cellular diagonals for the associahedra and the multiplihedra were also defined there, via projection. 
The first topological map for the permutahedra was given in \cite{LA21} -we will call it the \emph{LA diagonal}, where a general theory of cellular diagonals of polytopes was developed. 
The LA diagonal, however, is distinct from the SU diagonal at the cellular level \cite[Rem.~3.19]{LA21}. 

computer program for the SU diagonal \cite{vejdemo-johanssonEnumeratingSaneblidzeUmbleDiagonal2007}; we give a much more effective computer program (however, without the signs)

corollary: le dernier article de SU!
corollary: IJ-description of SU diagonal
corollary: left and right shifts for LA, decomposition of the cube associated to LA diagonal

Perspectives: 
-for general diagonal, obtain closed formulas for all the faces
-for specific diagonals, extend the bijection with bipartite trees

\subsubsection{Consequences of the equivalence between diagonals}


This result
\begin{enumerate}[i)]
    \item brings a positive answer to \cite[Rem.~2.19]{LA21}, showing that the original $\SU$ diagonal can indeed be recovered from a choice of chambers in the fundamental hyperplane arrangement of the permutahedron. 
    Remark that this choice is precisely given by the family of vectors mentioned in \cite[Rem.~4.19]{LA21}, which was already identified to be operadic,
    \item sets up the analogous question in \cite[Rem.~3.9]{MazuirLA22} for the multiplihedra,
    \item provides a new proof that all known diagonals on the associahedra coincide \cite{saneblidzeComparingDiagonalsAssociahedra2022}.
    Indeed, since the family of vectors inducing the $\SU$ diagonal all have strictly decreasing coordinates, the diagonal induced on the associahedron is given by the magical formula \cite[Thm.~2]{masudaDiagonalAssociahedra2021}, see also \cite[Prop.~3.8]{LA21}.
\end{enumerate}

Moreover, it allows us to obtain alternative descriptions of all four operadic diagonals, in particular
\begin{enumerate}
    \item subset shift and $m$-shift definitions of the $\LA$ diagonal,
    \item matrix description of the $\LA$ diagonal,
    \item a new realization of the permutahedron as subdivision of the cube, and a conjectural description of the $\LA$ diagonal in terms of this subdivision, 
\end{enumerate}
in addition to the new  \Guillaume{add references}
\begin{enumerate}
    \item[(4)] geometric construction and $(I,J)$-description of the $\SU$ diagonal,
    \item[(5)] description of the facets of the $\SU$ diagonal as labelled bipartite trees,
    \item[(6)] description of the vertices of the $\SU$ diagonal as pattern avoiding permutations,
    \item[(7)] enumerative results for the facets and vertices of the $\SU$ diagonal. 
\end{enumerate}

We end this Section by applying the isomorphism between the $\SU$ and $\LA$ diagonal to obtain explicitly the Points (1)-(3) above.

\begin{definition}[$\LA$ diagonals]
\begin{enumerate}
    \item subset shift
    \item $m$-shift
    \item matrix
\end{enumerate}
\end{definition}

\begin{definition}
    New subdivision of the cube
\end{definition}

\begin{conjecture}
    The $\LA$ diagonal is given by the formula...
\end{conjecture}

This is equivalent, via the isomorphism between $\LA$ and $\SU$ diagonals, to the analogous conjecture for the $\SU$ diagonal, presented as a fact in \cite[Equ.~(1)]{saneblidzeComparingDiagonalsAssociahedra2022}.

%%%%%%%%%%%%%%%

\begin{table}[h]
	\centerline{
		\begin{tabular}{c|c|rrrrrrr|l}
			\textbf{Pairs $(F,G) \in \Ima\triangle_{(P,\b{v})}$} & \textbf{Polytopes} & \textbf{0} & \textbf{1} & \textbf{2} & \textbf{3} & \textbf{4} & \textbf{5} & \textbf{6} & \textbf{\cite{OEIS}} \\
			\hline
			& \text{Associahedra} & 1 & 2 & 6 & 22 & 91 & 408 & 1938 & \OEIS{A000139}  \\
			$ \dim F + \dim G = \dim P$  & \text{Multiplihedra} & 1 & 2 & 8 & 42 & 254 & 1678 & 11790 &  to appear \\
			& \text{Permutahedra} & 1 & 2 & 8 & 50 & 432 & 4802 & 65536 &  \OEIS{A007334} \\
			\hline
			& \text{Associahedra} & 1 & 3 & 13 & 68 & 399 & 2530 & 16965 &  \OEIS{A000260} \\
			$\dim F=\dim G =0$ & \text{Multiplihedra} & 1 & 3 & 17 & 122 & 992 & 8721 & 80920 & to appear \\
			& \text{Permutahedra} & 1 & 3 & 17 & 149 & 1809 & 28399 & 550297 &  \OEIS{A213507} 
		\end{tabular}
	}
	\caption{Number of pairs of faces in the cellular image of the diagonal of the associahedra, multiplihedra and permutahedra of dimension $0\leq \dim P \leq 6$, induced by any good orientation vector.}
	\label{table:numerology}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
\part{Combinatorics of multiple braid arrangements}
\label{part:multiBraidArrangements}

In this first part, we study the combinatorics of hyperplane arrangements obtained as unions of generically translated copies of the braid arrangement.
%Specializing to two copies, we derive enumerative results on the diagonals of the permutahedra.
In \cref{sec:arrangements}, we first recall some classical facts on the enumeration of hyperplane arrangements (\cref{subsec:arrangements}), present the classical braid arrangement (\cref{subsec:braidArrangement}), and define our multiple braid arrangements (\cref{subsec:multiBraidArrangement}).
Then in \cref{sec:flatPoset}, we describe their flat posets in terms of partition forests (\cref{subsec:partitionForests}) and rainbow forests (\cref{subsec:rainbowForests}), from which we obtain their M\"obius polynomial (\cref{subsec:MobiusPolynomialMultiBraidArrangement}), and some surprizing formulas for their numbers of vertices and regions (\cref{subsec:verticesFacetsMultiBraidArrangement}).
Finally in \cref{sec:facePoset}, we describe their face posets in terms of ordered partition forests (\cref{subsec:orderedPartitionForests}), and explore some combinatorial criteria to describe the ordered partition forests that appear as faces for a given multiple braid arrangement (\cref{subsec:PFtoOPF,subsec:criterionOPF}).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Recollection on hyperplane arrangements and the braid arrangement}
\label{sec:arrangements}

%%%%%%%%%%%%%%%

\subsection{Hyperplane arrangements}
\label{subsec:arrangements}

We first briefly recall classical results on the combinatorics of affine hyperplane arrangements, in particular the enumerative connection between their intersection posets and their face lattices due to T.~Zaslavsky~\cite{Zaslavsky}.

\begin{definition}
A (finite affine real) \defn{hyperplane arrangement} is a finite set~$\arrangement$ of affine hyperplanes in~$\R^d$.
\end{definition}

\begin{definition}
A \defn{region} of~$\arrangement$ is a connected component of~$\R^d \ssm \bigcup_{H \in \arrangement} H$.
A \defn{face} of~$\arrangement$ is the intersection of the closure of a region of~$\arrangement$ with an hyperplane of~$\arrangement$.
The \defn{face poset} of~$\arrangement$ is the poset~$\facePoset$ of faces of~$\arrangement$ ordered by inclusion.
The \defn{$f$-polynomial}~$\fPol$ and \defn{$b$-polynomial}~$\bPol$ of~$\arrangement$ are the polynomial
\[
\fPol \eqdef \sum_{k = 0}^d f_k(\arrangement) \, x^k
\qquad\text{and}\qquad
\bPol \eqdef \sum_{k = 0}^d b_k(\arrangement) \, x^k \, ,
\]
where~$f_k(\arrangement)$ denotes the number of $k$-dimensional faces of~$\arrangement$, while~$b_k(\arrangement)$ denotes the number of bounded $k$-dimensional faces of~$\arrangement$.
\end{definition}

\begin{definition}
A \defn{flat} of~$\arrangement$ is a non-empty affine subspace of~$\R^d$ that can be obtained as the intersection of some hyperplanes of~$\arrangement$.
The \defn{flat poset} of~$\arrangement$ is poset~$\flatPoset$ of flats of~$\arrangement$ ordered by reverse inclusion.
\end{definition}

\begin{definition}
\label{def:MobiusPolynomial}
%The \defn{characteristic polynomial}~$\chi_{\arrangement}(y)$ and the \defn{M\"obius polynomial}~$\mu_{\arrangement}(x,y)$ are the polynomials respectively defined by
%\[
%\charPol \eqdef \sum_{G \in \flatPoset} \mu_{\flatPoset}(\R^d, G) \, y^{\dim(G)}
%\quad\text{and}\quad
%\mobPol \eqdef \sum_{F \le G \in \flatPoset} \mu_{\flatPoset}(F,G) \, x^{\dim(F)} \, y^{\dim(G)}
%\]
The \defn{M\"obius polynomial}~$\mu_{\arrangement}(x,y)$ is the polynomial defined by
\[
\mobPol \eqdef \sum_{F \le G} \mu_{\flatPoset}(F,G) \, x^{\dim(F)} \, y^{\dim(G)},
\]
where~$F \le G$ ranges over all intervals of the flat poset~$\flatPoset$, and~$\mu_{\flatPoset}(F,G)$ denotes the \defn{M\"obius function} on the flat poset~$\flatPoset$ defined as usual by
\[
\mu_{\flatPoset}(F, F) = 1
\qquad\text{and}\qquad
\sum_{F \le G \le H} \mu_{\flatPoset}(F,G) = 0
\]
for all~$F, G, H \in \flatPoset$.
\end{definition}

\begin{remark}
Our definition of the M\"obius polynomial slightly differs from that of \cite{Zaslavsky} as we use the dimension of~$F$ instead of its codimension, in order for the next statement to be slightly simpler.
\end{remark}

\begin{theorem}[{\cite[Thm.~A]{Zaslavsky}}]
\label{thm:Zaslavsky}
The $f$-polynomial, the $b$-polynomial, and the M\"obius polynomial of an arrangement~$\arrangement$ are related by
\[
\fPol = \mobPol[\arrangement][-x][-1]
\qquad\text{and}\qquad
\bPol = \mobPol[\arrangement][-x][1].
\]
\end{theorem}

\begin{example}
For the arrangement~$\arrangement$ of $5$ hyperplanes of \cref{fig:arrangement}, we have
\[
\mobPol = x^2y^2 - 5x^2y + 6x^2 + 5xy - 10x + 4 \, ,
\]
so that
\begin{align*}
\fPol & = \mobPol[\arrangement][-x][-1] = 12 \, x^2 + 15 \, x + 4 \\
\text{and}\qquad
\bPol & = \mobPol[\arrangement][-x][1] = 2 \, x^2 + 5 \, x + 4.
\end{align*}
%
\begin{figure}
%	\begin{overpic}[scale=.9]{intersectionPoset}
%		\put(72.5, -2){$1$}
%		\put(51, 10){$-1$}
%		\put(61, 10){$-1$}
%		\put(71, 10){$-1$}
%		\put(82, 10){$-1$}
%		\put(94, 10){$-1$}
%		\put(51.5, 32){$2$}
%		\put(66, 32){$1$}
%		\put(80, 32){$1$}
%		\put(93.5, 32){$2$}
%	\end{overpic}
%	\caption{A hyperplane arrangement (left) and its intersection poset with its M\"obius function (right).}
	\includegraphics[scale=.9]{intersectionPoset}
	\caption{A hyperplane arrangement (left) and its intersection poset (right).}
	\label{fig:arrangement}
\end{figure}
\end{example}

\begin{remark}
\label{rem:characteristicPolynomial}
The coefficient of~$x^d$ in the M\"obius polynomial~$\mobPol$ gives the more classical \defn{characteristic polynomial}
\[
\charPol \eqdef [x^d] \, \mobPol = \sum_F \mu_{\flatPoset}(\R^d,F) \, y^{\dim(F)}.
\]
By \cref{thm:Zaslavsky}, we thus have
\[
f_d(\arrangement) = (-1)^d \, \charPol[\arrangement][-1] 
\qquad\text{and}\qquad
b_d(\arrangement) = (-1)^d \, \charPol[\arrangement][1].
\]
\end{remark}

%%%%%%%%%%%%%%%

\subsection{The braid arrangement}
\label{subsec:braidArrangement}

We now briefly recall the classical combinatorics of the braid arrangement.
\vincent{add refs?}

%\begin{figure}
%	\centerline{\includegraphics[scale=.9]{figures/intersectionPosetBraidArrangement3Full}}
%	\caption{The braid arrangement $\braidArrangement[3]$ (left), its flat poset~$\flatPoset[{\braidArrangement[3]}]$ (middle), and the partition poset~$\partitionPoset[3]$ (right).}
%	\label{fig:braidArrangement3}
%\end{figure}

\begin{figure}
%	\centerline{\includegraphics[scale=.9]{figures/facePosetBraidArrangement3}}
	\caption{The face poset~$\facePoset[{\braidArrangement[3]}]$ of the braid arrangement $\braidArrangement[3]$, where faces are represented as cones (left) or as ordered set partitions of~$[3]$ (right).}
	\label{fig:facePosetBraidArrangement3}
\end{figure}

\begin{figure}
	\centerline{\includegraphics[scale=.9]{figures/intersectionPosetBraidArrangement3}}
	\caption{The flat poset~$\flatPoset[{\braidArrangement[3]}]$ of the braid arrangement $\braidArrangement[3]$, where flats are represented as intersections of hyperplanes (left) or as set partitions of~$[3]$ (right).}
	\label{fig:intersectionPosetBraidArrangement3}
\end{figure}

\begin{figure}
	\centerline{\includegraphics[scale=.26]{figures/intersectionPosetBraidArrangement4}}
	\caption{The flat poset~$\flatPoset[{\braidArrangement[4]}]$ of the braid arrangement $\braidArrangement[4]$, where flats are represented as intersections of hyperplanes (top) or as set partitions of~$[4]$ (bottom).}
	\label{fig:intersectionPosetBraidArrangement4}
\end{figure}

\begin{definition}
Fix~$n \ge 1$ and denote by~$\HH$ the hyperplane of~$\R^n$ defined by~$\sum_{s = 1}^n x_s = 0$.
The \defn{braid arrangement}~$\braidArrangement$ is the arrangement of the hyperplanes~$\set{\b{x} \in \HH}{x_s = x_t}$ for all~$1 \le s < t \le n$.
\end{definition}

\begin{remark}
\label{rem:essential}
Note that we have decided to work in the space~$\HH$ rather than in the space~$\R^n$.
The advantage is that the braid arrangement~$\braidArrangement$ is essential, so that we can speak of its vertices.
Working in~$\R^n$ would change vertices to rays, and would multiply all M\"obius polynomials by a factor~$xy$.
\end{remark}

The combinatorics of the braid arrangement~$\braidArrangement$ is well-known.
The descriptions of its face and flat posets involve both ordered and unordered set partitions.
To avoid confusions, we will always mark with an arrow the ordered structures (ordered set partitions, ordered partition forests, etc.).
Hence, $\pi$ denotes an unordered set partition (the order is irrelevant, neither inside each part, nor between two distinct part), while~$\orient{\pi}$ denotes an ordered set partition (the order inside each part is irrelevant, but the order between distinct parts is relevant).

The braid arrangement~$\braidArrangement$ has a $k$-dimensional face
\[
\Phi(\orient{\pi}) \eqdef \set{\b{x} \in \R^n}{x_s \le x_t \text{ for all $s,t$ such that the part of~$s$ is weakly before the part of~$t$ in $\pi$}}
\]
for each ordered set partition~$\orient{\pi}$ of~$[n]$ into~$k+1$ parts (or equivalently, for each surjection from~$[n]$ to~$[k+1]$).
The face poset~$\facePoset[\braidArrangement]$ is thus (isomorphic to) the refinement poset~$\orientedPartitionPoset$ on ordered set partitions (where an ordered partition~$\orient{\pi}$ is smaller than an ordered partition~$\orient{\omega}$ if each part of~$\orient{\omega}$ is the union of an interval of consecutive parts in~$\orient{\pi}$).
In particular, it has a single vertex corresponding to the ordered partition~$[n]$, $2^n-2$ rays corresponding to the proper nonempty subsets of~$[n]$ (ordered partitions of~$[n]$ into~$2$ parts), and $n!$ regions corresponding to the permutations of~$[n]$ (ordered partitions of~$[n]$ into~$n-1$ parts).

The braid arrangement~$\braidArrangement$ has a $k$-dimensional~flat
\[
\Psi(\pi) \eqdef \set{\b{x} \in \R^n}{x_s = x_t \text{ for all  $s, t$ which belong to the same part of~$\pi$}}
\]
for each (unordered) set partition~$\pi$ of~$[n]$ into $k+1$ parts.
The flat poset~$\flatPoset[\braidArrangement]$ is thus (isomorphic to) the refinement poset~$\partitionPoset$ \BDO{$\Pi_n$ ?} on set partitions of~$[n]$ (where a partition~$\pi$ is smaller than a partition~$\omega$ if each part of~$\pi$ is contained in a part of~$\omega$).
For instance, \cref{fig:intersectionPosetBraidArrangement3,fig:intersectionPosetBraidArrangement4} illustrate the flat posets of the braid arrangements~$\braidArrangement[3]$ and~$\braidArrangement[4]$.
The M\"obius function of~$\partitionPoset$ is given by
\[
\mu_{\partitionPoset}(\pi, \omega) = \prod_{p \in \omega} (-1)^{\#\pi[p]-1}(\#\pi[p]-1)! \, ,
\]
where~$\pi[p]$ denotes the restriction of the partition~$\pi$ to the part~$p$ of the partition~$\omega$, and $\#\pi[p]$ denotes its number of parts.
See for instance \cite{Birkhoff, Rota}.
The M\"obius polynomial of the braid arrangement~$\braidArrangement$ is given by
\[
\mobPol[\braidArrangement] = \sum_{k \in [n]} x^{k-1} S(n,k) \prod_{i \in [k-1]} (y-i) \, ,
\]
where~$S(n,k)$ denotes the Stirling number of second kind \OEIS{A008277}, \ie the number of set partitions of~$[n]$ into~$k$ parts.
For instance
\begin{align*}
\mobPol[{\braidArrangement[1]}] & = 1 \\
\mobPol[{\braidArrangement[2]}] & = x y - x + 1 = x (y - 1) + 1 \\
\mobPol[{\braidArrangement[3]}] & = x^2 y^2 - 3 x^2 y + 2 x^2 + 3 x y - 3 x + 1 = x^2 (y - 1) (y - 2) + 3 x (y - 1) + 1\\
\mobPol[{\braidArrangement[4]}] & = x^3 y^3 - 6 x^3 y^2 + 11 x^3 y - 6 x^3 + 6 x^2 y^2 - 18 x^2 y + 12 x^2 + 7 x y - 7 x + 1 \\
& = x^3 (y - 1) (y - 2) (y - 3) + 6 x^2 (y - 1) (y - 2) + 7 x (y - 1) + 1.
\end{align*}
In particular, the characteristic polynomial of the braid arrangement~$\braidArrangement$ is given by
\[
\charPol[\braidArrangement] = (y-1) (y-2) \dots (y-n-1).
\]
Working in~$\R^n$ rather than in~$\HH$ would lead to an additional~$y$ factor in this formula, which might be more familiar to the reader
See \cref{rem:essential}.

Finally, we will consider the evaluation of the M\"obius polynomial~$\mobPol[\braidArrangement]$ at~$y = 0$:
\[
\weirdPol[n] \eqdef \mobPol[\braidArrangement][x][0] = \sum_{k \in [n]} (-1)^{k-1} \, (k-1)! \, S(n,k) \, x^{k-1}.
\] 
The coefficients of this polynomial are given by the sequence \OEIS{A028246}.
We just observe here that it is connected to the $\b{f}$-polynomial of~$\braidArrangement$.

\begin{lemma}
We have~$\weirdPol[n] = (1-x) \, \fPol[\braidArrangement]$.
\end{lemma}

\begin{proof}
This lemma is equivalent to the following equality:
\begin{equation*}
\sum_{k=1}^n (-1)^{k-1} (k-1)! \, S(n,k) \, x^{k-1} = (1-x) \sum_{k=1}^{n-1} (-1)^{k-1} \, k! \, S(n-1,k) \, x^{k-1}.
\end{equation*}
Distributing $(1-x)$ in the right hand side gives:
\begin{gather*}
(1-x) \sum_{k=1}^{n-1} (-1)^{k-1} \, k! \, S(n-1,k) \, x^{k-1} \\
= \sum_{k=1}^{n-1} k! \, S(n-1,k) \, (-x)^{k-1} + \sum_{k=1}^{n-1} k! \, S(n-1,k) \, (-x)^{k} \\
= \sum_{k=1}^{n-1} k! \, S(n-1,k) \, (-x)^{k-1} + \sum_{k=2}^{n} (k-1)! \, S(n-1,k-1) \, (-x)^{k-1} + (n-1)! \, S(n-1, n-1) \, (-x)^{n-1} \\
= S(n-1,1) \, (-x)^0 + \sum_{k=2}^{n-1} (k-1)! \, \big( S(n-1,k-1) + k \, S(n-1,k) \big) \, (-x)^{k-1}.
\end{gather*}
The result thus follows from the inductive formula on Stirling numbers of the second kind
\[
S(n+1,k) = k S(n,k) + S(n,k-1)
\]
for $0<k<n$.
\end{proof}

%%%%%%%%%%%%%%%

\subsection{The $(\ell,n)$-braid arrrangement}
\label{subsec:multiBraidArrangement}

We now focus on the following specific hyperplane arrangements, illustrated in \cref{fig:multiBraidArrangements}.

\begin{figure}[t]
	\centerline{
	\begin{tabular}{c@{\hspace{.7cm}}c@{\hspace{.7cm}}c@{\hspace{.7cm}}c}
		\includegraphics[scale=.4]{multiBraidArrangement1}
		&
		\includegraphics[scale=.4]{multiBraidArrangement2}
		&
		\includegraphics[scale=.4]{multiBraidArrangement3}
		&
		\includegraphics[scale=.4]{multiBraidArrangement4}
		\\
		$\ell = 1$ & $\ell = 2$ & $\ell = 3$ & $\ell = 4$
	\end{tabular}
	}
	\caption{The $(\ell,3)$-braid arrangements for~$\ell \in [4]$.}
	\label{fig:multiBraidArrangements}
\end{figure}

\begin{definition}
\label{def:multiBraidArrangement}
The \defn{$(\ell,n)$-braid arrangement}~$\multiBraidArrangement$ is the arrangement obtained as the union of $\ell$ generically translated copies of the braid arrangement~$\braidArrangement$.
\end{definition}

This definition is slightly misleading, as the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ a priori depends on the (generic) translation vectors chosen for each copy.
We will see that many combinatorial aspects of~$\multiBraidArrangement$ are in fact independent of the translation vectors, in particular the flat poset and thus the $f$-vector of~$\multiBraidArrangement$.
However, the combinatorial description of the face poset of~$\multiBraidArrangement$ will depend on the translation vectors, so that we introduce the following more precise notation recording of the translations.

\begin{definition}
\label{def:multiBraidArrangementPrecise}
For any integers~$\ell,n \geq 1$, and a generic matrix~$\b{a} \eqdef (a_{i,j}) \in M_{\ell,n-1}(\R)$ of~$\R^n$, the \defn{$\b{a}$-braid arrangement}~$\multiBraidArrangement(\b{a})$ is the arrangement of hyperplanes~$\set{\b{x} \in \HH}{x_s - x_t = A_{i,s,t}}$ for all~$1 \le s < t \le n$ and~$i \in [\ell]$, where $A_{i,s,t} \eqdef \smash{\sum_{s \le j < t} a_{i,j}}$.
\end{definition}

%\begin{remark}
%\label{rem:multiBraidArrangement}
%In practice, consider the hyperplanes~$\set{\b{x} \in \HH}{x_s - x_t = A_{i,s,t}}$ for all~$1 \le s < t \le n$ and~$i \in [\ell]$, where $A_{i,s,t} \eqdef \smash{\sum_{s \le j < t} a_{i,j}}$ for an arbitrary generic matrix~$(a_{i,j}) \in M_{\ell,n-1}(\R)$.
%\end{remark}

The objective of \cref{part:multiBraidArrangements} is to explore the combinatorics of these multiple braid arrangements.
We have split our presentation into two sections:
\begin{itemize}
\item In \cref{sec:flatPoset}, we describe the flat poset~$\flatPoset[\multiBraidArrangement]$ of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ in terms of $(\ell,n)$-partition forests (\cref{subsec:partitionForests}) and labeled $(\ell,n)$-rainbow forests (\cref{subsec:rainbowForests}), which enables us to derive its M\"obius, $f$- and $b$- polynomials (\cref{subsec:MobiusPolynomialMultiBraidArrangement}), from which we extract interesting formulas for the number of vertices and regions of~$\multiBraidArrangement$ (\cref{subsec:verticesFacetsMultiBraidArrangement}). Note that all these results are independent of the translation vectors.
\item In \cref{sec:facePoset}, we describe the face poset~$\facePoset[\multiBraidArrangement(\b{a})]$ of the $\b{a}$-braid  arrangement~$\multiBraidArrangement(\b{a})$ in terms of ordered $(\ell,n)$-partition forests (\cref{subsec:orderedPartitionForests}). In contrast to the flat poset, this description of the face poset depends on the translation vectors. For a given choice of translation matrix~$\b{a}$, we describe in particular the ordered $(\ell,n)$-partitions forests with a given underlying (unordered) $(\ell,n)$-partition forest (\cref{subsec:PFtoOPF}). We then give a criterion to decide whether a given ordered $(\ell,n)$-partition forest corresponds to a face of~$\multiBraidArrangement(\b{a})$ (\cref{subsec:criterionOPF}).
\end{itemize}

\begin{remark}
Connections to other multiple braid arrangements. Shi arrangements (non generic). Discriminantal arrangements (fully generic).
\vincent{todo}
\end{remark}

\begin{remark}
\vincenti{TODO: Discuss generalizations to $\ell$ copies of an arbitrary arrangement, or a graphical arrangement.}
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Flat poset and enumeration of~$\multiBraidArrangement$}
\label{sec:flatPoset}

In this section, we describe the flat poset of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ in terms of $(\ell,n)$-partition forests and derive explicit formulas for its $f$-vector.
Remarkably, the flat poset (and thus the M\"obius, $f$- and $b$- polynomials) of~$\multiBraidArrangement$ is independent of the translation vectors as long as they are generic.

%%%%%%%%%%%%%%%

\subsection{Partition forests}
\label{subsec:partitionForests}

We first introduce the main characters of this section, which will describe the combinatorics of the flat poset of~$\multiBraidArrangement$.

\begin{definition}
The \defn{intersection hypergraph} of a $\ell$-tuple~$\b{F} \eqdef (F_1, \dots, F_\ell)$ of set partitions of~$[n]$ is the $\ell$-regular $\ell$-partite hypergraph on all parts of all the partitions~$F_i$ for~${i \in [\ell]}$, with an hyperedge connecting the parts containing~$j$  for each~$j \in [n]$.
A \defn{$(\ell,n)$-partition forest} (resp.~\defn{$(\ell,n)$-partition tree}) is a $\ell$-tuple~$\b{F} \eqdef (F_1, \dots, F_\ell)$ of set partitions of~$[n]$ whose intersection hypergraph is a hyperforest (resp.~hypertree).
The \defn{dimension} of~$\b{F}$ is~$\smash{{\dim(\b{F}) \eqdef n - 1 - \ell n + \sum_{i \in [\ell]} \#F_i}}$.
See \cref{fig:forests}.
The \defn{$(\ell,n)$-partition forest poset} is the poset~$\forestPoset$ on $(\ell,n)$-partition forests ordered by componentwise refinement.
In other words, $\forestPoset$ is the subposet of the $\ell$\ordinal{} Cartesian power of the partition poset~$\partitionPoset$ induced by $(\ell,n)$-partition forests.
Note that the maximal elements of~$\forestPoset$ are the $(\ell, n)$-partition trees.
%
\begin{figure}
	\centerline{\includegraphics[scale=.9]{forests}}
	\caption{Some $(3,6)$-partition forests (top) with their intersection hypergraphs (middle) and the corresponding labeled $(3,6)$-rainbow forests (bottom). The last two are trees. The order of the colors is red, green, blue.}
	\label{fig:forests}
\end{figure}
\end{definition}

The following statement is illustrated in \cref{fig:intersectionPosetMultiBraidArrangement32}.
%
\begin{figure}
	\centerline{\includegraphics[scale=.9]{figures/intersectionPosetMultiBraidArrangement32Full}}
	\caption{The $(2,3)$-braid arrangement $\multiBraidArrangement[3][2]$ (left), and its flat poset (right), where flats are represented as intersections of hyperplanes (top), as $(2,3)$-partitions forests (middle), and as labeled $(2,3)$-rainbow forests (bottom).}
	\label{fig:intersectionPosetMultiBraidArrangement32}
\end{figure}

\begin{proposition}
\label{prop:flatPosetMultiBraidArrangement}
The flat poset~$\flatPoset[\multiBraidArrangement]$ of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ is isomorphic to the $(\ell,n)$-partition forest poset.
\end{proposition}

\begin{proof}
Consider the hyperplanes~$\set{\b{x} \in \HH}{x_s - x_t = A_{i,s,t}}$ described in \cref{def:multiBraidArrangementPrecise}.
For each~${i \in [\ell]}$, each set partition~$\pi$ of~$[n]$ corresponds to a $(\#\pi)$-dimensional flat
\[
\Psi_i(\pi) \eqdef \set{\b{x} \in \HH}{x_s - x_t = A_{i,s,t} \text{ for all $s,t$ in the same part of $F_i$} }
\]
of the $i$\ordinal{} copy of the braid arrangement~$\braidArrangement$.
The flats of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ are thus all of the form
\[
\Psi(\b{F}) \eqdef \bigcap_{i \in [\ell]} \Psi_i(F_i)
\]
for certain $\ell$-tuples~$\b{F} \eqdef (F_1, \dots, F_\ell)$ of set partitions of~$[n]$.
Since the parameters~$A_{i,s,t}$ are generic, $\Psi(\b{F})$ is non-empty if and only if the intersection hypergraph of~$\b{F}$ is acyclic.
Moreover, $\Psi(\b{F})$ is included in~$\Psi(\b{G})$ if and only if~$\b{F}$ refines~$\b{G}$ componentwise.
Hence, the flat poset of~$\multiBraidArrangement$ is isomorphic to the $(\ell,n)$-partition forest poset.
Finally, notice that the codimension of the flat~$\Psi(\b{F})$ is the sum of the codimensions of the flats~$\Psi_i(F_i)$ for~$i \in [\ell]$, so that~$\dim(\b{F}) \eqdef n - 1 - \ell n + \sum_{i \in [\ell]} \#F_i $ is indeed the dimension of the flat~$\Psi(\b{F})$.
\end{proof}

%%%%%%%%%%%%%%%

\subsection{M\"obius polynomial}
\label{subsec:MobiusPolynomialMultiBraidArrangement}

We thus derive the M\"obius polynomial of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ by \cref{def:MobiusPolynomial,prop:flatPosetMultiBraidArrangement}.

\begin{theorem}
\label{thm:MobiusPolynomialMultiBraidArrangement}
The M\"obius polynomial of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ is given by
\[
\mobPol[\multiBraidArrangement] = x^{n-1-\ell n} y^{n-1-\ell n} \sum_{\b{F} \le \b{G}} \prod_{i \in [\ell]} x^{\#F_i} y^{\#G_i} \prod_{p \in G_i} (-1)^{\#F_i[p]-1} (\# F_i[p]-1)! \; ,
\]
where~$\b{F} \le \b{G}$ ranges over all intervals of the $(\ell,n)$-partition forest poset~$\forestPoset$, and~$F_i[p]$ denotes the restriction of the partition~$F_i$ to the part~$p$ of~$G_i$.
\end{theorem}

\begin{proof}
Observe that for~$\b{F} \eqdef (F_1, \dots, F_\ell)$ and~$\b{G} \eqdef (G_1, \dots, G_\ell)$ in~$\forestPoset$, we have
\[
[\b{F}, \b{G}] = \prod_{i \in [\ell]} [F_i, G_i] \simeq \prod_{i \in [\ell]} \prod_{p \in G_i} \partitionPoset[{\#F_i[p]}].
\]
Recall that the M\"obius function is multiplicative:
\(
\mu_{P \times Q} \big( (p,q), (p’,q’) \big) = \mu_P(p,p’) \cdot \mu_Q(q,q’),
\)
for all~$p, p' \in P$ and~$q, q' \in Q$.
Hence, we obtain that
\[
\mu_{\forestPoset}(\b{F}, \b{G}) = \prod_{i \in [\ell]} \prod_{p \in G_i} (-1)^{\#F_i[p]-1} (\# F_i[p]-1)! \, .
\]
Hence, we derive from \cref{def:MobiusPolynomial,prop:flatPosetMultiBraidArrangement} that
\begin{align*}
\mobPol[\multiBraidArrangement] 
& = \sum_{\b{F} \le \b{G}} \mu_{\forestPoset}(\b{F}, \b{G}) \, x^{\dim(\b{F})} \, y^{\dim(\b{G})} \\
& = x^{n-1-\ell n} y^{n-1-\ell n} \sum_{\b{F} \le \b{G}} \prod_{i \in [\ell]} x^{\#F_i} y^{\#G_i} \prod_{p \in G_i} (-1)^{\#F_i[p]-1} (\# F_i[p]-1)! \, .
\qedhere
\end{align*}
\end{proof}

By using the polynomial
\[
\weirdPol[n] \eqdef \mobPol[\braidArrangement][x][0] = \sum_{k \in [n]} (-1)^{k-1} \, (k-1)! \, S(n,k) \, x^{k-1}
\]
introduced at the end of \cref{subsec:braidArrangement}, the M\"obius polynomial can also be expressed as follows.

\begin{proposition} 
The M\"obius polynomial of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ is given by
\[
\mobPol[\multiBraidArrangement] = x^{(n-1)(1-\ell)} \sum_{G \in \forestPoset} y^{n-1-\ell n+\sum_{i=1}^\ell \#G_i}  \prod_{i \in [\ell]} \weirdPol[\#G_i]
\]
In terms of rainbow forests, this rewrites as
\[
\mobPol[\multiBraidArrangement] = x^{(n-1)(1-\ell)} \sum_{G \in \rainbowForests} y^{n-1+\#E(G)}  \prod_{i=1}^{\ell} \weirdPol[n-\#E(G,i)]
\]
\end{proposition}

\begin{proof}
We have
\begin{align*}
\mobPol[\multiBraidArrangement]
& = \sum_{F \leq G} \mu_{\flatPoset}(F,G) \, x^{\dim(F)} \, y^{\dim(G)}, \\
 &=\sum_{G \in \rainbowForests} y^{n-1-\ell-\#E(G)} \sum_{F \in \rainbowForests, F \leq G } \mu_{\forestPoset}(F,G) \, x^{n-1-\ell-\#E(F)}, \\
 &=\sum_{G \in \forestPoset} y^{n-1-\ell n+\sum_{i=1}^\ell \#G_i} \sum_{F \in \forestPoset, F \leq G } \mu_{\forestPoset}(F,G) \, x^{n-1-\ell n+\sum_{i=1}^\ell \#F_i},
\end{align*}
where $E(G)$ (resp.~$E(G,i)$) denotes the set of edges (resp.~of edges of color $i$) in $G$ which satisfies $n-\#E(G,i) =  \#G_i$.

Observe that for~$\b{F} \eqdef (F_1, \dots, F_\ell)$ and~$\b{G} \eqdef (G_1, \dots, G_\ell)$ in~$\forestPoset$, we have
\[
[\b{F}, \b{G}] = \prod_{i \in [\ell]} [F_i, G_i],
\]
where $[F_i, G_i]$ is an interval of $\partitionPoset[n]$. Morover, given a $(\ell,n)$-partition forest $\b{G}\eqdef (G_1, \dots, G_\ell)$, any n-tuples of partition $(F_1, \dots, F_\ell)$ satisfying for any $1\leq i \leq \ell$ $F_i \leq_{\partitionPoset[n]} G_i $ is a $(\ell,n)$-partition forest as its intersection hypergraph is a subforest of the intersection hypergraph of $G$. 
Recall moreover that the M\"obius function is multiplicative.
\vincenti{It seems you are redoing the proof of \cref{thm:MobiusPolynomialMultiBraidArrangement}. Can we not just use the result?}

Hence, we obtain that
\begin{align*}
\mobPol[\multiBraidArrangement] &=\sum_{G \in \forestPoset} y^{n-\ell n - 1 + \sum_{i=1}^\ell |G_i|} \prod_{i=1}^{\ell} \sum_{F_i \leq_{\partitionPoset[n]} G_i } \mu_{\partitionPoset[n]}(F_i,G_i) \, x^{n-\ell n - 1 + \sum_{i=1}^\ell |F_i|}, \\
 &=\sum_{G \in \forestPoset} y^{n-\ell n - 1 + \sum_{i=1}^\ell |G_i|} x^{(n-1)(1-\ell)} \prod_{i=1}^{\ell} \sum_{\pi_i \in \partitionPoset[|G_i|]}  \mu_{\partitionPoset[|G_i|]}(\pi_i,\hat{1}) \, x^{|\pi_i|-1}, 
\end{align*}
where $\hat{1}$ denotes the maximal element in $\partitionPoset[|G_i|]$ and $\pi_i$ is obtained from $F_i$ by merging elements in the same part of $G_i$.

Finally, we get:
\[
\mobPol[\multiBraidArrangement]=\sum_{G \in \forestPoset} y^{n-\ell n - 1 + \sum_{i=1}^\ell |G_i|} x^{(n-1)(1-\ell)} \prod_{i=1}^{\ell} P_{|G_i|}(x).
\qedhere
\]
\end{proof}

\begin{remark}
To further simplify this expression, we would need to count the number of rainbow forests with a prescribed number of colored edges, however this number does not admit a  known multiplicative formula, up to our knowledge. When there is only one color, the corresponding sequence (counting non colored forests on $n$ nodes and $k$ edges, rooted in the minimal label of each connected component) is \OEIS{A138464}.
\end{remark}

From \cref{thm:Zaslavsky,thm:MobiusPolynomialMultiBraidArrangement}, we thus obtain the face numbers and bounded face numbers of~$\multiBraidArrangement$, whose first few values are gathered in \cref{table:fvectorMultiBraidArrangements}.

%\begin{table}
%\centerline{
%	\begin{tabular}{c@{\hspace{.7cm}}c}
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $2$ & $1$ &&& $3$ \\
%			$3$ & $6$ & $6$ & $1$ && $13$ \\
%			$4$ & $24$ & $36$ & $14$ & $1$ & $75$
%		\end{tabular}
%		&
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $3$ & $2$ &&& $5$ \\
%			$3$ & $17$ & $24$ & $8$ && $49$ \\
%			$4$ & $149$ & $324$ & $226$ & $50$ & $749$
%		\end{tabular}
%		\\[2cm]
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $0$ & $1$ &&& $1$ \\
%			$3$ & $0$ & $0$ & $1$ && $1$ \\
%			$4$ & $0$ & $0$ & $0$ & $1$ & $1$
%		\end{tabular}
%		&
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $1$ & $2$ &&& $3$ \\
%			$3$ & $5$ & $12$ & $8$ && $25$ \\
%			$4$ & $43$ & $132$ & $138$ & $50$ & $363$
%		\end{tabular}
%		\\[2cm]
%		$\ell = 1$ & $\ell = 2$
%		\\[.8cm]
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $4$ & $3$ &&& $7$ \\
%			$3$ & $34$ & $54$ & $21$ && $109$ \\
%			$4$ & $472$ & $1152$ & $924$ & $243$ & $2791$
%		\end{tabular}
%		&
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $5$ & $4$ &&& $9$ \\
%			$3$ & $57$ & $96$ & $40$ && $193$ \\
%			$4$ & $1089$ & $2808$ & $2396$ & $676$ & $6969$
%		\end{tabular}
%		\\[2cm]
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $2$ & $3$ &&& $5$ \\
%			$3$ & $16$ & $36$ & $21$ && $73$ \\
%			$4$ & $224$ & $684$ & $702$ & $243$ & $1853$
%		\end{tabular}
%		&
%		\begin{tabular}[t]{c|cccc|c}
%			$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
%			\hline
%			$1$ & $1$ &&&& $1$ \\
%			$2$ & $3$ & $4$ &&& $7$ \\
%			$3$ & $33$ & $72$ & $40$ && $145$ \\
%			$4$ & $639$ & $1944$ & $1980$ & $676$ & $5239$
%		\end{tabular}
%		\\[2cm]
%		$\ell = 3$ & $\ell = 4$
%	\end{tabular}
%	}
%	\vspace{.3cm}
%	\caption{The face numbers (top) and the bounded face numbers (bottom) of the $(\ell,n)$-braid arrangements for~$\ell, n \in [4]$.}
%	\label{table:fvectorMultiBraidArrangements}
%\end{table}

\begin{table}
	\centerline{\scalebox{.8}{
		\begin{tabular}{c@{\hspace{.7cm}}c@{\hspace{.7cm}}c@{\hspace{.7cm}}c}
			$\ell = 1$ & $\ell = 2$ & $\ell = 3$ & $\ell = 4$
			\\[.2cm]
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $2$ & $1$ &&& $3$ \\
				$3$ & $6$ & $6$ & $1$ && $13$ \\
				$4$ & $24$ & $36$ & $14$ & $1$ & $75$
			\end{tabular}
			&
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $3$ & $2$ &&& $5$ \\
				$3$ & $17$ & $24$ & $8$ && $49$ \\
				$4$ & $149$ & $324$ & $226$ & $50$ & $749$
			\end{tabular}
			&
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $4$ & $3$ &&& $7$ \\
				$3$ & $34$ & $54$ & $21$ && $109$ \\
				$4$ & $472$ & $1152$ & $924$ & $243$ & $2791$
			\end{tabular}
			&
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $5$ & $4$ &&& $9$ \\
				$3$ & $57$ & $96$ & $40$ && $193$ \\
				$4$ & $1089$ & $2808$ & $2396$ & $676$ & $6969$
			\end{tabular}
			\\[2.3cm]
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $0$ & $1$ &&& $1$ \\
				$3$ & $0$ & $0$ & $1$ && $1$ \\
				$4$ & $0$ & $0$ & $0$ & $1$ & $1$
			\end{tabular}
			&
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $1$ & $2$ &&& $3$ \\
				$3$ & $5$ & $12$ & $8$ && $25$ \\
				$4$ & $43$ & $132$ & $138$ & $50$ & $363$
			\end{tabular}
			&
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $2$ & $3$ &&& $5$ \\
				$3$ & $16$ & $36$ & $21$ && $73$ \\
				$4$ & $224$ & $684$ & $702$ & $243$ & $1853$
			\end{tabular}
			&
			\begin{tabular}[t]{c|cccc|c}
				$n \backslash k$ & $0$ & $1$ & $2$ & $3$ & $\Sigma$ \\
				\hline
				$1$ & $1$ &&&& $1$ \\
				$2$ & $3$ & $4$ &&& $7$ \\
				$3$ & $33$ & $72$ & $40$ && $145$ \\
				$4$ & $639$ & $1944$ & $1980$ & $676$ & $5239$
			\end{tabular}
		\end{tabular}
	}}
	\vspace{.3cm}
	\caption{The face numbers (top) and the bounded face numbers (bottom) of the $(\ell,n)$-braid arrangements for~$\ell, n \in [4]$.}
	\label{table:fvectorMultiBraidArrangements}
\end{table}

\begin{corollary}
\label{coro:fbvectorsMultiBraidArrangement}
The $f$- and $b$-polynomials of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ are given by
\begin{align*}
\fPol[\multiBraidArrangement] & = x^{n-1-\ell n}\sum_{\b{F} \le \b{G}} \prod_{i \in [\ell]} x^{\#F_i} \prod_{p \in G_i} (\# F_i[p]-1)!\\
\text{and}\qquad
\bPol[\multiBraidArrangement] & = (-1)^\ell x^{n-1-\ell n} \sum_{\b{F} \le \b{G}} \prod_{i \in [\ell]} x^{\#F_i} \prod_{p \in G_i} -(\# F_i[p]-1)! \, ,
\end{align*}
where~$\b{F} \le \b{G}$ ranges over all intervals of the $(\ell,n)$-partition forest poset~$\forestPoset$, and~$F_i[p]$ denotes the restriction of the partition~$F_i$ to the part~$p$ of~$G_i$.
\end{corollary}

\begin{example}
For~$n = 1$, we have
\[
\mobPol[{\multiBraidArrangement[1][\ell]}] = \fPol[{\multiBraidArrangement[1][\ell]}] = \bPol[{\multiBraidArrangement[1][\ell]}] = 1.
\]
For~$n = 2$, we have
\[
\mobPol[{\multiBraidArrangement[2][\ell]}] = xy-\ell x+\ell,
\quad
\fPol[{\multiBraidArrangement[2][\ell]}] = (\ell+1)x+\ell
\quad\text{and}\quad
\bPol[{\multiBraidArrangement[2][\ell]}] = (\ell-1)x+\ell.
\]
The case~$n = 3$ is already more interesting.
Consider the set partitions~$P \eqdef \big\{ \{1\}, \{2\}, \{3\} \big\}$, $Q_i \eqdef \big\{ \{i\}, [3] \ssm \{i\} \big\}$ for~$i \in [3]$, and~$R \eqdef \big\{ [3] \big\}$.
Observe that the $(\ell,3)$-partition forests are all of the form
\begin{gather*}
\b{F} \eqdef P^\ell,
\quad
\b{G}_i^p \eqdef P^p Q_i P^{\ell-p-1}, % \text{ for } p \le \ell-1 \text{ and } i \in [3],
\quad
\b{H}_{i,j}^{p,q} \eqdef P^p Q_i P^{\ell-p-q-2} Q_j P^q \;\text{($i \ne j$)} % \text{ for } p + q \le \ell-2 \text{ and } i \ne j \in [3]
\quad\text{or}\quad
\b{K}^p \eqdef P^p R P^{\ell-p-1}. % \text{ for } p \le \ell-1.
\end{gather*}
(where we write a tuple of partitions of~$[3]$ as a word on~$\{P, Q_1, Q_2, Q_3, R\}$, and $p$ and $q$ are such that the total length is~$\ell$).
%\begin{gather*}
%\b{F} \eqdef (\underbrace{P, \dots, P}_\ell), \\
%\b{G}_i^p \eqdef (\underbrace{P, \dots, P}_p, Q_i, \underbrace{P, \dots, P}_{\ell-p-1}) \text{ for } p \le \ell-1 \text{ and } i \in [3],
%\\
%\b{H}_{i,j}^{p,q} \eqdef (\underbrace{P, \dots, P}_p, Q_i, \underbrace{P, \dots, P}_{\ell-p-q-2}, Q_j, \underbrace{P, \dots, P}_q) \text{ for } p + q \le \ell-2 \text{ and } i \ne j \in [3],
%\\
%\text{or}\quad
%\b{K}^p \eqdef (\underbrace{P, \dots, P}_p, R, \underbrace{P, \dots, P}_{\ell-p-1}) \text{ for } p \le \ell-1.
%\end{gather*}
Moreover, the cover relations in the $(\ell,3)$-partition forest poset are precisely the relations
\[
\b{F} \le \b{G}_i^p \hspace{-.4cm} \begin{array}{l} \rotatebox[origin=c]{45}{$\le$} \raisebox{.2cm}{$\b{H}_{i,j}^{p,q}$} \\[.1cm] \quad \le \b{K}^p \\[.1cm] \rotatebox[origin=c]{-45}{$\le$} \raisebox{-.2cm}{$\b{H}_{j,i}^{\ell-q-1, \ell-p-1}$} \end{array}
\]
for~$i \ne j$ and~$p, q$ such that~$p + q \le \ell-2$.
Hence, we have
\begin{align*}
\mobPol[{\multiBraidArrangement[3][\ell]}] & = x^2 y^2 - 3 \ell x^2 y + \ell (3 \ell - 1) x^2 + 3 \ell x y - 3 \ell (2 \ell - 1) x + \ell (3 \ell - 2) , \\
\fPol[{\multiBraidArrangement[3][\ell]}] & = (3 \ell^2 + 2 \ell + 1) x^2 + 6 \ell^2 x + \ell (3 \ell - 2), \\
\text{and}\qquad
\bPol[{\multiBraidArrangement[3][\ell]}] & = (3 \ell^2 - 4 \ell + 1) x^2 + 6 \ell (\ell - 1) x + \ell (3 \ell - 2).
\end{align*}
Observe that~$3 \ell^2 + 2 \ell + 1$ is~\OEIS{A056109}, that~$\ell (3 \ell - 2)$ is~\OEIS{A000567}, and that ${3 \ell^2 - 4 \ell + 1}$ is~\OEIS{A045944}.
%\vincenti{There is a weird connection between the first and the last. Namely, $3 \ell^2 - 4 \ell + 1 = 3 (\ell - 1)^2 + 2 (\ell - 1)$. Is there a bijective explanation on the arrangements?}
\end{example}

%%%%%%%%%%%%%%%

\subsection{Rainbow forests}
\label{subsec:rainbowForests}

In order to obtain more explicit formulas for the number of vertices and regions of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ in \cref{subsec:verticesFacetsMultiBraidArrangement}, we now introduce another combinatorial model for $(\ell,n)$-partition forests which is more adapted to their enumeration.

\begin{definition}
\label{def:rainbowForest}
A \defn{$\ell$-rainbow coloring} of a rooted plane forest~$F$ is an assignment of colors of~$[\ell]$ to the non-root nodes of~$F$ such that
\begin{enumerate}[(i)]
\item there is no monochromatic edge,
\item the colors of siblings are increasing from left to right.
\end{enumerate}
We denote by~$\|F\|$ the number of nodes of~$F$ and by~$\#F$ the number of trees of the forest~$F$ (\ie its number of connected components).
A \defn{$(\ell,n)$-rainbow forest} (resp.~\defn{tree}) is a \mbox{$\ell$-rainbow} colored forest (resp.~tree) with $\|F\| = n$ nodes.
We denote by~$\rainbowForests$ (resp.~$\rainbowTrees$) the set of $(\ell,n)$-rainbow forests (resp.~trees), and set~$\rainbowForests[][\ell] \eqdef \bigsqcup_n \rainbowForests$ (resp.~$\rainbowTrees[][\ell] \eqdef \bigsqcup_n \rainbowTrees$).
\end{definition}

For instance, we have listed all $(2,4)$-rainbow trees in \cref{fig:rainbowTrees}\,(top).
This figure actually illustrates the following statement.

\begin{lemma}
\label{lem:FussCatalan}
The $(\ell,m)$-rainbow trees are counted by the \defn{Fuss-Catalan number}
\[
\# \rainbowTrees[m][\ell] = F_{\ell,m} \eqdef \frac{1}{(\ell-1)m+1} \binom{\ell m}{m} \qquad \text{\OEIS{A062993}}.
\]
\end{lemma}

\begin{proof}
We can transform a $\ell$-rainbow tree~$R$ to a $\ell$-ary tree~$T$ as illustrated in \cref{fig:rainbowTrees}.
Namely, the parent of a node~$N$ in~$T$ is the previous sibling colored as~$N$ in~$R$ if it exists, and the parent of~$N$ in~$R$ otherwise.
This classical map is a bijection from $\ell$-rainbow trees to a $\ell$-ary trees, which are counted by the Fuss-Catalan numbers~\cite{Klarner, HiltonPedersen}.
%
\begin{figure}
	\centerline{\includegraphics[scale=.7]{rainbowTrees}}
	\caption{The $14$ $(2,4)$-rainbow trees (top) and $14$ binary trees (bottom), and the simple bijection between them (middle). The order of the colors is red, blue.}
	\label{fig:rainbowTrees}
\end{figure}
\end{proof}

\begin{remark}
\label{rem:functionalEquationFussCatalan}
Recall that the corresponding generating function~$F_\ell(z) \eqdef \sum_{m \ge 0} F_{\ell,m} \, z^m$ satisfies the functional equiation
\[
F_\ell(z) = 1 + z \, F_\ell(z)^\ell.
\]
\end{remark}

\begin{table}
	\centerline{\scalebox{.8}{
		\begin{tabular}[t]{c|ccccccccc}
			$m \backslash \ell$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ & $9$ \\
			\hline
			$1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ \\
			$2$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ & $9$ \\
			$3$ & $1$ & $5$ & $12$ & $22$ & $35$ & $51$ & $70$ & $92$ & $117$ \\
			$4$ & $1$ & $14$ & $55$ & $140$ & $285$ & $506$ & $819$ & $1240$ & $1785$ \\
			$5$ & $1$ & $42$ & $273$ & $969$ & $2530$ & $5481$ & $10472$ & $18278$ & $29799$ \\
			$6$ & $1$ & $132$ & $1428$ & $7084$ & $23751$ & $62832$ & $141778$ & $285384$ & $527085$ \\
			$7$ & $1$ & $429$ & $7752$ & $53820$ & $231880$ & $749398$ & $1997688$ & $4638348$ & $9706503$ \\
			$8$ & $1$ & $1430$ & $43263$ & $420732$ & $2330445$ & $9203634$ & $28989675$ & $77652024$ & $184138713$ \\
			$9$ & $1$ & $4862$ & $246675$ & $3362260$ & $23950355$ & $115607310$ & $430321633$ & $1329890705$ & $3573805950$
		\end{tabular}
	}}
	\vspace{.3cm}
	\caption{The Fuss-Catalan numbers~$F_{\ell,m} = \frac{1}{(\ell-1)m+1} \binom{\ell m}{m}$ for~$\ell,m \in [9]$. See \OEIS{A062993}.}
\end{table}

\begin{definition}
For a rainbow forest~$F$, we define
\[
\omega(F) \eqdef \prod_{i \in [\ell]} \prod_{N \in F} \#C_i(N)! \, ,
\]
where~$N$ ranges over all nodes of~$F$ and~$C_i(N)$ denotes the children of~$N$ colored by~$i$.
\end{definition}

\begin{definition}
\label{def:labelingRainbowForest}
A \defn{labeling} of a $(\ell,n)$-rainbow forest~$F$ is a bijective map between from the nodes of~$F$ to~$[n]$ such that
\begin{enumerate}[(i)]
\item the label of each root is minimal in its tree,
\item the labels of siblings with the same color are increasing from left to right.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lem:labelingRainbowForest}
The number~$\lambda(F)$ of labelings of a $(\ell,n)$-rainbow forest~$F$ is given by
\[
\lambda(F) = \frac{n!}{\omega(F) \prod\limits_{T \in F} \|T\|} \, .
\]
\end{lemma}

\begin{proof}
Out of all~$n!$ bijective maps from the nodes of~$F$ to~$[n]$, only~$1/\prod_{T \in F} \|T\|$ satisfy Condition~(i) of \cref{def:labelingRainbowForest}, and only $1/\prod_{i \in [\ell]} \prod_{N \in F} \#C_i(N)! = 1/\omega(F)$ satisfy Condition~(ii) of \cref{def:labelingRainbowForest}.
\end{proof}

The following statement is illustrated in \cref{fig:forests}.

\begin{proposition}
\label{prop:bijectionForests}
There is a bijection from $(\ell,n)$-partition forests to labeled $(\ell,n)$-rainbow forests, such that if the partition forest~$\b{F}$ is sent to the labeled rainbow forest~$F$, then
\[
\dim(\b{F}) = \#F-1
\qquad\text{and}\qquad
\mu_{\forestPoset}(\HH, \b{F}) = (-1)^{n-\#F} \, \omega(F).
\]
\end{proposition}

\begin{proof}
From a labeled $(\ell,n)$-rainbow forest~$F$, we construct a $(\ell,n)$-partition forest~$\b{F} \eqdef (F_1, \dots, F_\ell)$ whose $i$\ordinal{} partition~$F_i$ has a part~$\{N\} \cup C_i(N)$ for each node~$N$ of~$F$ not colored~$i$.
Condition~(i) of \cref{def:rainbowForest} ensures that each $F_i$ is indeed a partition.

Conversely, start from a $(\ell,n)$-partition forest~$\b{F} \eqdef (F_1, \dots, F_i)$.
Consider the colored clique graph~$K_{\b{F}}$ on~$[n]$ obtained by replacing each part in~$F_i$ by a clique of edges colored by~$i$.
For each~$1 < j \le n$, there is a unique shortest path in~$K_{\b{F}}$ from the vertex~$j$ to the smallest vertex in the connected component of~$j$.
Define the parent~$p$ of~$j$ to be the next vertex along this path, and color the node~$j$ by the color of the edge between~$j$ and~$p$.
This defines a labeled $(\ell,n)$-rainbow forest~$F$.

Finally, observe that
\begin{gather*}
\dim(\b{F}) = n - 1 - \ell n + \sum_{i \in [\ell]} \#F_i = \#F-1, \qquad\text{and} \\
\mu_{\forestPoset}(\HH, \b{F}) = \prod\limits_{i \in [\ell]} \prod\limits_{p \in F_i} (-1)^{\#p-1} (\#p-1) = \prod\limits_{i \in [\ell]} \prod\limits_{N \in F} (-1)^{\#C_i(N)} \#C_i(N)! = (-1)^{n-\#F} \, \omega(F).
\qedhere
\end{gather*}
\end{proof}

%%%%%%%%%%%%%%%

\subsection{Enumeration of vertices and regions of $\multiBraidArrangement$}
\label{subsec:verticesFacetsMultiBraidArrangement}

We now use the labeled $(\ell,n)$-rainbow forests of \cref{subsec:rainbowForests} to derive more explicit formulas for the number of vertices and regions of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$.
We first explain the partial order of the flat lattice in terms of rainbow forests before counting the vertices of~$\multiBraidArrangement$, whose first values are gathered in \cref{table:verticesMultiBraidArrangement}.

\begin{table}
	\centerline{\scalebox{.8}{
		\begin{tabular}[t]{c|cccccccc}
			$n \backslash \ell$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ \\ % & $9$ \\
			\hline
		$1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ \\ % & $1$ \\
		$2$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ \\ % & $9$ \\
		$3$ & $1$ & $8$ & $21$ & $40$ & $65$ & $96$ & $133$ & $176$ \\ % & $225$ \\
		$4$ & $1$ & $50$ & $243$ & $676$ & $1445$ & $2646$ & $4375$ & $6728$ \\ % & $9801$ \\
		$5$ & $1$ & $432$ & $3993$ & $16384$ & $46305$ & $105456$ & $208537$ & $373248$ \\ % & $620289$ \\
		$6$ & $1$ & $4802$ & $85683$ & $521284$ & $1953125$ & $5541126$ & $13119127$ & $27350408$ \\ % & $51883209$ \\
		$7$ & $1$ & $65536$ & $2278125$ & $20614528$ & $102555745$ & $362797056$ & $1029059101$ & $2500000000$ \\ % & $5415228513$ \\
		$8$ & $1$ & $1062882$ & $72412707$ & $976562500$ & $6457339845$ & $28500625446$ & $96889010407$ & $274371577992$ \\ % & $678770015625$ \\
%		$9$ & $1$ & $20000000$ & $2681615217$ & $53971714048$ & $474659385665$ & $2614905943296$ & $10657046640625$ & $35184372088832$ & $99426586671873$
		\end{tabular}
	}}
	\vspace{.3cm}
	\caption{The numbers $f_0(\multiBraidArrangement) = \ell \big( (\ell-1) n + 1 \big)^{n-2}$ of vertices of~$\multiBraidArrangement$ for~$\ell,n \in [8]$.}
	\label{table:verticesMultiBraidArrangement}
\end{table}

\begin{proposition}
The cover relations of the partial order on the flat poset of rainbow forests is given by the following rules. A rainbow forest $F$ is greater than a rainbow forest $G$ if $G$ can be obtained from $F$ by:
\begin{itemize}
\item Choosing a color $c$.
\item Choosing two vertices $a$ and $b$ not colored in $c$ in two connected components $A$ and $B$, with the convention that the root of $A$ is smaller than the root of $B$.
\item Removing edges between $b$ and its children $C_b$ of color $c$ and recursively "pushing" the color of $b$ to its parent until the root of $B$ is colored: we get a forest whose roots are $C_b$ and $b$, colored in $c$.
\item Grafting $b$ and all the nodes in $C_b$ on $a$.
\end{itemize}
\end{proposition}

\begin{proof}
Let us first remark that the graph obtained with these operations is indeed a rainbow forest. First, we add an edge between two connected components: the result will be acyclic. Moreover, the condition on the color of $a$ and on the deletion of edges between $b$ and vertices of color $c$ ensures that we do not add an edge between two vertices of the same color. Note that the parent of $b$ inherits the color of $b$ which is not $c$.

Let us recall that the cover relations in the flat poset is given in terms of tuples of partition by:
\begin{itemize}
\item choosing a partition $\pi$, i.e. an element of the tuple (which corresponds directly to choosing a color)
\item choosing two parts $\pi_a$ and $\pi_b$ in the partition $\pi$
\item and merging them.
\end{itemize}
so that the corresponding intersection hypergraph does not have any loop.

By choosing two vertices in different connected components of the rainbow forest, we are sure that the intersection hypergraph obtained by adding an edge is still acyclic.

The last point that has to be explained is the link between the condition on the color of $a$ and $b$ and merging two parts in the same partition. If one of the two nodes, say $a$ for instance is of color $c$, then it belongs to the same part of $\pi$ as its parent $z$. The merging is the same if we choose $z$ which is not colored $c$. Moreover, as $b$ is an other connected components, the corresponding two parts are distinct in $\pi$. Finally, a part is just a corolla so the merging corresponds to building a corolla with $a$, $b$ and their children of color $c$.
\end{proof}

\begin{theorem}
\label{thm:verticesMultiBraidArrangement}
The number of vertices of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ is
\[
f_0(\multiBraidArrangement) = \ell \big( (\ell-1) n + 1 \big)^{n-2}.
\]
\end{theorem}

\begin{proof}
By \cref{prop:flatPosetMultiBraidArrangement,prop:bijectionForests}, we just need to count the labeled $(\ell,n)$-rainbow trees.
A common reasoning for counting Cayley trees is the use of its Prüfer code defined by recursively pruning the smallest leaf while writing down the label of its parent.
This bijection can be adapted to colored Cayley trees by writing down the label of the parent colored by the color of the pruned leaf.
This leads to a bijection with certain colored words of length $n-1$.
Namely, there are two possibilities:
\begin{itemize}
\item either the pruned leaf is attached to the node~$1$ and it can have all $\ell$ colors,
\item or it is attached to one of the $n-1$ other nodes and it can only have $\ell-1$ colors.
\end{itemize}
Note that the last letter in the Prüfer code (obtained by removing the last edge) is necessarily the root $1$, with $\ell$ possible different colors.
Hence, there are 
\[
\big( \ell+(n-1)(\ell-1) \big)^{n-2} \ell = \ell \big( (\ell-1) n + 1 \big)^{n-2}
\]
such words.
Similar ideas were used in~\cite{Lewis}.
\end{proof}

\begin{theorem}
\label{thm:verticesRefinedMultiBraidArrangement}
For any~$k_1, \dots, k_\ell$ such that~$0 \le k_i \le n-1$ for~$i \in [\ell]$ and~${\sum_{i=1}^\ell k_i = n-1}$, the number of vertices~$v$ of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ such that the smallest flat of the $i$\ordinal{} copy of~$\braidArrangement$ containing~$v$ has dimension~$n-k_i-1$ is given by
\[
n^{\ell-1} \binom{n-1}{k_1, \dots, k_\ell} \prod_{i=1}^\ell (n-k_i)^{k_i-1}.
\]
\end{theorem}

\begin{proof}
By \cref{prop:flatPosetMultiBraidArrangement,prop:bijectionForests}, we just need to count the labeled $(\ell,n)$-rainbow trees with~$k_i$ nodes colored by~$i$.
Forgetting the labels, the $(\ell,n)$-rainbow trees with~$k_i$ nodes colored by~$i$ are precisely the spanning trees of the complete multipartite graph~$K_{k_1, \dots, k_\ell, 1}$ (where the last~$1$ stands for the uncolored root).
Using a Pr\"ufer code similar to that of the proof of \cref{thm:verticesMultiBraidArrangement}, R.~Lewis proved in~\cite{Lewis} that the latter are counted by~${n^{\ell-1} \prod_{i=1}^\ell (n-k_i)^{k_i-1}}$.
Finally, the possible labelings are counted by the multinomial coefficient~$\binom{n-1}{k_1, \dots, k_\ell}$.
\end{proof}

\begin{theorem}
\label{thm:topCoefficientMobiusPolynomialMultiBraidArrangement}
The characteristic polynomial~$\charPol[\multiBraidArrangement]$ of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ is given~by
\[
\charPol[\multiBraidArrangement] = \frac{(-1)^n n!}{y} \, [z^n] \, \exp \bigg( - \sum_{m \ge 1} \frac{F_{\ell,m} \, y \, z^m}{m} \bigg) ,
\]
where~$\displaystyle F_{\ell,m} \eqdef \frac{1}{(\ell-1)m+1} \binom{\ell m}{m}$ is the Fuss-Catalan number.
\end{theorem}

\begin{proof}
By \cref{thm:MobiusPolynomialMultiBraidArrangement,prop:bijectionForests}, the characteristic polynomial~$\charPol[\multiBraidArrangement]$ is
\[
\charPol[\multiBraidArrangement] = \sum_{\b{F} \in \forestPoset} \mu_{\forestPoset}(\HH, \b{F}) \, y^{\dim(\b{F})} = \sum_{F \in \rainbowForests} \lambda(F) \, (-1)^{n-\#F} \, \omega(F) \, y^{\#F-1}.
\]
From \cref{lem:labelingRainbowForest}, we observe that
\[
\frac{\lambda(F) \, \omega(F) \, (-y)^{\#F} \, z^{\|F\|}}{\|F\|!} = \prod_{T \in F} \frac{-y \, z^{\|T\|}}{\|T\|} \, ,
\]
where $T$ ranges over the trees of~$F$.
Now using that rainbow forests are exactly sets of rainbow trees, we obtain that
\[
\sum_{F \in \rainbowForests[][\ell]} \frac{ \lambda(F) \, \omega(F) \, (-y)^{\#F} \, z^{\|F\|}}{\|F\|!} = \sum_{F \in \rainbowForests[][\ell]} \prod_{T \in F} \frac{-y \, z^{\|T\|}}{\|T\|} = \exp \bigg( \sum_{T \in \rainbowTrees[][\ell]} \frac{-y \, z^{\|T\|}}{\|T\|} \bigg).
\]
From \cref{lem:FussCatalan}, we obtain that
\[
\exp \bigg( \sum_{T \in \rainbowTrees[][\ell]} \frac{-y \, z^{\|T\|}}{\|T\|} \bigg) = \exp \bigg( - \sum_{m \ge 1} \frac{F_{\ell,m} \, y \, z^m}{m} \bigg).
\]
We conclude that
\begin{align*}
\charPol[\multiBraidArrangement] 
& = \sum_{F \in \rainbowForests}  \lambda(F) \, (-1)^{n-\#F} \, \omega(F) \, y^{\#F-1} \\
& = \frac{(-1)^n \, n!}{y} [z^n] \sum_{F \in \rainbowForests[][\ell]} \frac{ \lambda(F) \, \omega(F) \, (-y)^{\#F} \, z^{\|F\|}}{\|F\|!} \\
& = \frac{(-1)^n n!}{y} \, [z^n] \, \exp \bigg( - \sum_{m \ge 1} \frac{F_{\ell,m} \, y \, z^m}{m} \bigg).
\qedhere
\end{align*}
\end{proof}

By \cref{rem:characteristicPolynomial,thm:topCoefficientMobiusPolynomialMultiBraidArrangement}, we obtain the number of regions and bounded regions of~$\multiBraidArrangement$, whose first values are gathered in \cref{table:regionsMultiBraidArrangement,table:boundedRegionsMultiBraidArrangement}.

\begin{table}
	\centerline{\scalebox{.8}{
		\begin{tabular}[t]{c|cccccccc}
			$n \backslash \ell$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ \\ % & $9$ \\
			\hline
			$1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ \\ % & $1$ \\
			$2$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ & $9$ \\ % & $10$ \\
			$3$ & $6$ & $17$ & $34$ & $57$ & $86$ & $121$ & $162$ & $209$ \\ % & $262$ \\
			$4$ & $24$ & $149$ & $472$ & $1089$ & $2096$ & $3589$ & $5664$ & $8417$ \\ % & $11944$ \\
			$5$ & $120$ & $1809$ & $9328$ & $29937$ & $73896$ & $154465$ & $287904$ & $493473$ \\ % & $793432$ \\
			$6$ & $720$ & $28399$ & $241888$ & $1085157$ & $3442816$ & $8795635$ & $19376064$ & $38323753$ \\ % & $69841072$ \\
			$7$ & $5040$ & $550297$ & $7806832$ & $49075065$ & $200320816$ & $625812385$ & $1629858672$ & $3720648337$ \\ % & $7686190000$ \\
			$8$ & $40320$ & $12732873$ & $302346112$ & $2666534049$ & $14010892416$ & $53536186825$ & $164859458688$ & $434390214657$ \\ % & $1017282905344$ \\
%			$9$ & $362880$ & $343231361$ & $13682809216$ & $169423639713$ & $1146173002496$ & $5357227099105$ & $19506923076096$ & $59328538244801$ & $157507267166848$
		\end{tabular}
	}}
	\vspace{.3cm}
	\caption{The numbers $f_{n-1}(\multiBraidArrangement)$ of regions of~$\multiBraidArrangement$ for~$\ell,n \in [8]$.}
	\label{table:regionsMultiBraidArrangement}
\end{table}

\begin{table}
	\centerline{\scalebox{.8}{
		\begin{tabular}[t]{c|cccccccc}
			$n \backslash \ell$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ \\ % & $9$ \\
			\hline
			$1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ & $1$ \\ % & $1$ \\
			$2$ & $0$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ \\ % & $8$ \\
			$3$ & $0$ & $5$ & $16$ & $33$ & $56$ & $85$ & $120$ & $161$ \\ % & $208$ \\
			$4$ & $0$ & $43$ & $224$ & $639$ & $1384$ & $2555$ & $4248$ & $6559$ \\ % & $9584$ \\
			$5$ & $0$ & $529$ & $4528$ & $17937$ & $49696$ & $111745$ & $219024$ & $389473$ \\ % & $644032$ \\
			$6$ & $0$ & $8501$ & $120272$ & $663363$ & $2354624$ & $6455225$ & $14926176$ & $30583847$ \\ % & $57255488$ \\
			$7$ & $0$ & $169021$ & $3968704$ & $30533409$ & $138995776$ & $464913325$ & $1268796096$ & $2996735329$ \\ % & $6353133184$ \\
			$8$ & $0$ & $4010455$ & $156745472$ & $1684352799$ & $9841053184$ & $40179437975$ & $129465630720$ & $352560518527$ \\ % & $846588258944$ \\
%			$9$ & $0$ & $110676833$ & $7216242688$ & $108413745057$ & $813420601856$ & $4055310777025$ & $15431698810368$ & $48461340225473$ & $131823966149632$
		\end{tabular}
	}}
	\vspace{.3cm}
	\caption{The numbers $b_{n-1}(\multiBraidArrangement)$ of bounded regions of~$\multiBraidArrangement$ for~$\ell,n \in [8]$.}
	\label{table:boundedRegionsMultiBraidArrangement}
\end{table}

\begin{theorem}
\label{thm:regionsMultiBraidArrangement}
The numbers of regions and of bounded regions of the $(\ell,n)$-braid arrangement~$\multiBraidArrangement$ are given by
\begin{align*}
f_{n-1}(\multiBraidArrangement) 
& = n! \, [z^n] \exp \Bigg( \sum_{m \ge 1} \frac{F_{\ell,m} \, z^m}{m} \Bigg) \\
\text{and}\qquad
b_{n-1}(\multiBraidArrangement)
%& = - n! \, [z^n] \exp \Bigg( - \sum_{m \ge 1} \frac{F_{\ell,m} \, z^m}{m} \Bigg) 
& = (n-1)! \, [z^{n-1}] \exp \bigg( (\ell-1) \sum_{m \ge 1} F_{\ell,m} \, z^m \bigg).
\end{align*}
where~$\displaystyle F_{\ell,m} \eqdef \frac{1}{(\ell-1)m+1} \binom{\ell m}{m}$ is the Fuss-Catalan number.
\end{theorem}

\begin{proof}
By \cref{rem:characteristicPolynomial}, we obtain from \cref{thm:topCoefficientMobiusPolynomialMultiBraidArrangement} that
\begin{align*}
f_{n-1}(\multiBraidArrangement) & = (-1)^{n-1} \charPol[\multiBraidArrangement][-1] = n! \, [z^n]  \, \exp \bigg( \sum_{m \ge 1} \frac{F_{\ell,m} \, z^m}{m} \bigg), \\
% \text{and}\qquad
b_{n-1}(\multiBraidArrangement) & = (-1)^{n-1} \charPol[\multiBraidArrangement][1] = - n! \, [z^n]  \, \exp \bigg( - \sum_{m \ge 1} \frac{F_{\ell,m} \, z^m}{m} \bigg).
\end{align*}
To conclude, we thus just need to observe that
\(
U_\ell(z) = \frac{\partial}{\partial z} V_\ell(z)
\)
where
\[
U_\ell(z) \eqdef \exp \bigg( (\ell-1) \sum_{m \ge 1} F_{\ell,m} \, z^m \bigg)
\qquad\text{and}\qquad
V_\ell(z) \eqdef - \exp \bigg( - \sum_{m \ge 1} \frac{F_{\ell,m} \, z^m}{m} \bigg).
\]
For this, consider the generating functions
\[
F_\ell(z) \eqdef \sum_{m \ge 0} F_{\ell,m} \, z^m
\qquad\text{and}\qquad
G_\ell(z) \eqdef \sum_{m \ge 1} \frac{F_{\ell,m} \, z^m}{m}.
\]
Recall from \cref{rem:functionalEquationFussCatalan} that~$F_\ell(z)$ satisfies the functional equation
\[
F_\ell(z) = 1 + z \, F_\ell(z)^\ell.
\]
We thus obtain that
\[
F_\ell'(z) \big( 1 - \ell \, z \, F_\ell(z)^{\ell-1} \big) = F_\ell(z)^\ell
\quad\text{and}\quad
F_\ell(z) \big( 1 - \ell \, z \, F_\ell(z)^{\ell-1} \big) = 1 - (\ell-1) \, z \, F_\ell(z)^\ell.
\]
Combining these two equations, we get
\begin{equation}
\label{eq:diff}
F_\ell(z)^{\ell+1} = F_\ell'(z) \big( 1 - (\ell-1) \, z \, F_\ell(z)^\ell \big).
\end{equation}
Observe now that
\begin{equation}
\label{eq:GF}
z \, G_\ell'(z) = F_\ell(z) - 1 = z \, F_\ell(z)^\ell
\qquad\text{and}\qquad
G_\ell''(z) = \ell \, F_\ell(z)^{\ell-1} \, F_\ell'(z).
\end{equation}
Hence
\[
U_\ell(z) = \exp \big( (\ell-1) \, (F_\ell(z) - 1) \big) = \exp \big( (\ell-1) \, z \, G_\ell’(z) \big)
\]
and
\[
V_\ell'(z) = \frac{\partial}{\partial z}  - \exp \big( \! - G_\ell(z) \big) = G_\ell'(z) \exp \big( -G_\ell(z) \big).
\]
Consider now the function
\[
W_\ell(z) = V_\ell'(z) / U_\ell(z) = G_\ell'(z) \exp \big( \! - G_\ell(z) - (\ell-1) \, z \, G_\ell'(z) \big).
\]
Clearly, $W_\ell(0) = 1$.
Moreover, using~\eqref{eq:GF}, we obtain that its derivative is
\begin{align*}
W_\ell'(z)
& = \Big( G_\ell''(z) \big(1 - (\ell-1) \, z \, G_\ell'(z) \big) - \ell \, G_\ell'(z)^2 \Big) \exp \big( \! - G_\ell(z) - (\ell-1) \, z \, G_\ell'(z) \big) \\
& = \ell \, F_\ell(z)^{\ell-1} \Big( F_\ell'(z) \big( 1 - (\ell-1) \, z \, F_\ell(z)^\ell \big) - F_\ell(z)^{\ell+1} \Big) \exp \big( \! - G_\ell(z) - (\ell-1) \, z \, G_\ell'(z) \big),
\end{align*}
which vanishes by~\eqref{eq:diff}.

\vincent{Can we make a bijective proof of the equality $U_\ell(z) = \frac{\partial}{\partial z} V_\ell(z)$?}
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Face poset and combinatorial description of~$\multiBraidArrangement(\b{a})$}
\label{sec:facePoset}

In this section, we describe the face poset of~$\multiBraidArrangement(\b{a})$ in terms of ordered $(\ell,n)$-partition forests.
This section highly depends on the choice of the translation matrix~$\b{a}$.

%%%%%%%%%%%%%%%

\subsection{Ordered partition forests}
\label{subsec:orderedPartitionForests}

We now introduce the combinatorial objects that will be used to encode the faces of the $\b{a}$-braid arrangement~$\multiBraidArrangement(\b{a})$.

\begin{definition}
An \defn{ordered $(\ell,n)$-partition forest} (resp.~\defn{tree}) is an $\ell$-tuple~$\orient{\b{F}} \eqdef (\orient{F_1}, \dots, \orient{F_\ell})$ of ordered set partitions of~$[n]$ such that the corresponding $\ell$-tuple~$\b{F} \eqdef (F_1, \dots, F_\ell)$ of unordered set partitions of~$[n]$ forms a $(\ell,n)$-partition forest (resp.~tree)
The \defn{ordered $(\ell,n)$-partition forest poset} is the poset~$\orientedForestPoset$ on ordered $(\ell,n)$-partition forests ordered by componentwise refinement.
In other words, $\orientedForestPoset$ is the subposet of the $\ell$\ordinal{} Cartesian power of the ordered partition poset~$\orientedPartitionPoset$ induced by ordered $(\ell,n)$-partition forests.
Note that the maximal elements of~$\orientedForestPoset$ are the ordered $(\ell, n)$-partition trees.
\end{definition}

The following statement is the analogue of \cref{prop:flatPosetMultiBraidArrangement}, and is illustrated in \cref{fig:B23a,fig:B23b}.

\begin{proposition}
\label{prop:facePosetMultiBraidArrangement}
The face poset~$\facePoset[\multiBraidArrangement(\b{a})]$ of the $\b{a}$-braid arrangement~$\multiBraidArrangement(\b{a})$ is isomorphic to an upper set~$\orientedForestPoset(\b{a})$ of the ordered $(\ell,n)$-partition forest poset~$\orientedForestPoset$.
\end{proposition}

\begin{proof}
The proof is based on that of \cref{prop:flatPosetMultiBraidArrangement}.
A face of~$\multiBraidArrangement(\b{a})$ is an intersection of faces of the $\ell$ copies of~$\multiBraidArrangement$, hence corresponds to an $\ell$-tuple of ordered partitions of~$[n]$.
Moreover, the flats supporting these faces intersect, so that the corresponding unordered partitions must form an $(\ell,n)$-partition forest.
Hence, each face of~$\multiBraidArrangement(\b{a})$ corresponds to a certain ordered $(\ell,n)$-partition forest.
Moreover, the inclusion of faces of~$\multiBraidArrangement(\b{a})$ translates to the componentwise refinement on ordered partitions.
Finally, by genericity, it is immediate that we obtain an upper set of this componentwise refinement order.
\end{proof}

\begin{figure}
	\includegraphics[scale=.9]{B23a}
	\caption{Labelings of the faces of the arrangement~$\multiBraidArrangement[3][2](\b{a})$ for~$\b{a} = \begin{bmatrix} 0 & 0 \\ -1 & -1 \end{bmatrix}$.}
	\label{fig:B23a}
\end{figure}

\begin{figure}
	\includegraphics[scale=.9]{B23b}
	\caption{Labelings of the faces of the arrangement~$\multiBraidArrangement[3][2](\b{a})$ for~$\b{a} = \begin{bmatrix} 0 & 0 \\ 1 & -2 \end{bmatrix}$.}
	\label{fig:B23b}
\end{figure}

We now fix a generic translation matrix~$\b{a} \eqdef (a_{i,j})$ and still denote by~$A_{i,s,t} \eqdef \smash{\sum_{s \le j < t} a_{i,j}}$ for all~$1 \le s < t \le n$ and~$i \in [\ell]$ (and often write~$A_{i,t,s}$ for~$-A_{i,s,t}$).
The objective of this section is to describe
\begin{itemize}
\item the ordered $(\ell,n)$-partitions forests of the upper set~$\orientedForestPoset(\b{a})$ with a given underlying (unordered) $(\ell,n)$-partition forest (\cref{subsec:PFtoOPF}),
\item a criterion to decide whether a given ordered $(\ell,n)$-partition forest belongs to the upper set~$\orientedForestPoset(\b{a})$, \ie corresponds to a face of~$\multiBraidArrangement(\b{a})$ (\cref{subsec:criterionOPF}).
\end{itemize}

%%%%%%%%%%%%%%%

\subsection{From partition forests to ordered partition forests}
\label{subsec:PFtoOPF}

In this section, we describe the ordered $(\ell,n)$-partitions forests~$\orient{\b{F}}$ of the upper set~$\orientedForestPoset(\b{a})$ with a given underlying $(\ell,n)$-partition forest~$\b{F}$.
We denote by~$cc(\b{F})$ the connected components of~$\b{F}$, meaning the partition of~$[n]$ given by the hyperedge labels of the connected components of the intersection hypergraph of~$\b{F}$.
We first observe that the choice of~$\b{a}$ fixes the order of the parts in a common connected component of~$\b{F}$.

\begin{proposition}
\label{prop:PFtoOPF1}
Consider an $(\ell,n)$-partition forest~$\b{F} \eqdef (F_1, \dots, F_\ell)$, and two integers~$s,t \in [n]$ labeling two hyperedges in the same connected component of the intersection hypergraph of~$\b{F}$.
Assume that the unique path from~$s$ to~$t$ in the hypergraph of~$\b{F}$ passes through the hyperedges labeled by~$s = r_0, \dots, r_q = t$ and through parts of the partitions~$F_{i_1}, \dots, F_{i_q}$.
Then for any ordered $(\ell,n)$-partition forest~$\orient{\b{F}} \eqdef (\orient{F_1}, \dots, \orient{F_\ell})$ of the upper set~$\orientedForestPoset(\b{a})$ with underlying $(\ell,n)$-partition forest~$\b{F}$ and any~$i \in [\ell]$, the order of~$s$ and~$t$ in~$\orient{F}_i$ is given by the sign of~$A_{i,s,t} - \sum_{p \in [q]} A_{i_p, r_{p-1}, r_p}$.
\end{proposition}

\begin{proof}
Consider any point~$\b{x}$ in the face of~$\multiBraidArrangement(\b{a})$ corresponding to~$\orient{\b{F}}$.
Along the path from~$s$ to~$t$, we have~$x_{r_{p-1}} - x_{r_p} = A_{i_p, r_{p-1}, r_p}$ for each~$p \in [q]$.
Hence, we obtain that
\[
x_s - x_t = \sum_{p \in [q]}  (x_{r_{p-1}} - x_{r_p}) = \sum_{p \in [q]} A_{i_p, r_{p-1}, r_p}.
\]
The order of~$s,t$ in~$\orient{F}_i$ is given by the sign of~$A_{i,s,t} - (x_s - x_t)$, hence of~$A_{i,s,t} - \sum_{p \in [q]} A_{i_p, r_{p-1}, r_p}$.
\end{proof}

We now describe the different ways to order the parts in distinct connected components of~$\b{F}$.
For this, we need the following posets.

\begin{definition}
Consider an $(\ell,n)$-partition forest~$\b{F}$ and denote by~$cc(\b{F})$ the connected components of~$\b{F}$.
For each pair~$s,t \in [n]$ in distinct connected components of~$cc(\b{F})$, we define the chain~$<_{s,t}$ on the $\ell$ triples~$(i,s,t)$ for~$i \in [\ell]$ given by the order of the values~$A_{i,s,t}$.
The \defn{inversion poset}~$\Inv(\b{F}, \b{a})$ is then the poset obtained by quotienting the disjoint union of the chains~$<_{s,t}$ (for all~$s,t \in [n]$ in distinct connected components of~$cc(\b{F})$) by the equivalence relation~$(i,s,t) \equiv (i,s',t')$ if~$s$ and~$s'$ belong to the same part of~$F_i$ and~$t$ and~$t'$ belong to the same part of~$F_i$.
%Note that the map~$\phi: (i,s,t) \to (i,t,s)$ is an anti-isomorphism of the poset~$\Inv(\b{F}, \b{a})$.
We say that a subset~$X$ of~$\Inv(\b{F}, \b{a})$ is antisymmetric if~$(i,s,t) \in X \iff (i,t,s) \notin X$.
\end{definition}

\begin{proposition}
\label{prop:PFtoOPF2}
The ordered $(\ell,n)$-partition forests of the upper set~$\orientedForestPoset(\b{a})$ with a given underlying $(\ell,n)$-partition forest~$\b{F}$ are in bijection with the antisymmetric lower sets of the inversion poset~$\Inv(\b{F}, \b{a})$.
\end{proposition}

\begin{proof}
Consider an ordered $(\ell,n)$-partition forest~$\orient{\b{F}}$ of the upper set~$\orientedForestPoset(\b{a})$.
Let~$\b{x}$ be any point of the face of~$\multiBraidArrangement(\b{a})$ corresponding to~$\orient{\b{F}}$.
For each pair~$s,t \in [n]$ in distinct connected components of~$cc(\b{F})$, let~$I_{s,t}(\orient{\b{F}})$ be the set of indices~$i \in [\ell]$ such that~$x_s - x_t < A_{i,s,t}$.
Note that~$I_{s,t}$ is by definition a lower set of the chain~$<_{s,t}$ of~$\Inv(\b{F}, \b{a})$.
Hence, $I(\orient{F}) \eqdef \bigcup_{s,t} I_{s,t} / {\equiv}$ is a lower set of~$\Inv(\b{F}, \b{a})$.
Moreover, it is clearly antisymmetric since
\[
(i,s,t) \in I(\orient{F}) \iff x_s - x_t < A_{i,s,t} \iff x_t - x_s > A_{i,t,s} \iff (i,t,s) \notin I(\orient{F}).
\]

Conversely, given an antisymmetric lower set~$I$ of~$\Inv(\b{F}, \b{a})$, we can reconstruct an ordered $(\ell,n)$-partition forest~$\orient{\b{F}}$ by ordering each pair~$s,t \in [n]$ in~$\orient{F}_i$ 
\begin{itemize}
\item according to \cref{prop:PFtoOPF1} (hence independently of~$I$) if $s$ and~$t$ belong to the same connected component of~$\b{F}$,
\item according to~$I$ if~$s$ and~$t$ belong to distinct connected components of~$\b{F}$. Namely, we place the block of~$\orient{F}_i$ containing~$s$ before the block of~$\orient{F}_i$ containing~$t$ if and only if~$(i,s,t) \in I$.
\end{itemize}
It is then straightforward to check that the resulting ordered $(\ell,n)$-partition forest belongs to the upper set~$\orientedForestPoset(\b{a})$, by exhibiting a point~$\b{x}$ in of the corresponding face of~$\multiBraidArrangement(\b{a})$.
\end{proof}

%%%%%%%%%%%%%%%

\subsection{A criterion for ordered partition forests}
\label{subsec:criterionOPF}

We now consider a given ordered $(\ell,n)$-partition forest~$\orient{F}$ and provide a criterion to decide if it belongs to the upper set~$\orientedForestPoset(\b{a})$ corresponding to the faces of~$\multiBraidArrangement(\b{a})$.
For this, we need the following directed graph associated to~$\orient{\b{F}}$.

\begin{definition}
For an ordered partition~$\orient{\pi} \eqdef \orient{\pi}_1 | \dots | \orient{\pi}_k$ of~$[n]$, we denote by~$D_{\orient{\pi}}$ the directed graph on~$[n]$ with an arc~$\max(\orient{\pi}_j) \to \min(\orient{\pi}_{j+1})$ for each~$j \in [k-1]$ and a cycle~${x_1 \to \dots \to x_p \to x_1}$ for each part~$\orient{\pi}_j = \{x_1 < \dots < x_p\}$.
Note that~$D_{\orient{\pi}}$ has~$n$ vertices and~$n + k$ arcs.
For an ordered $(\ell,n)$-partition forest~$\orient{\b{F}} \eqdef (\orient{F_1}, \dots, \orient{F_\ell})$, we denote by~$D_{\orient{\b{F}}}$ the superposition of the directed graphs~$D_{\orient{F}_i}$ for~$i \in [\ell]$, where the arcs of~$D_{\orient{F}_i}$ are labeled by~$i$.
\end{definition}

\begin{proposition}
An ordered $(\ell,n)$-partition forest~$\orient{\b{F}}$ belongs to the upper set~$\orientedForestPoset(\b{a})$ if and only if $\sum_{\alpha \in \gamma} A_{i(\alpha), s(\alpha), t(\alpha)} \ge 0$ for any (simple) oriented cycle~$\gamma$ in~$D_{\orient{\b{F}}}$, where each arc~$\alpha \in \gamma$ has label~$i(\alpha)$, source~$s(\alpha)$, and target~$t(\alpha)$.
\end{proposition}

\begin{proof}
Consider an ordered $(\ell,n)$-partition forest~$\orient{\b{F}} \eqdef (\orient{F}_1, \dots, \orient{F}_\ell)$.
For each~$i \in [\ell]$, denote by
\begin{itemize}
\item $m_i$ the number of arcs of~$D_{\orient{F}_i}$
\item $M_i$ the incidence matrix of~$D_{\orient{F}_i}$, with $m_i$ rows and $n$ columns, with a row for each arc~$\alpha$ of~$D_{\orient{F}_i}$ containing a $-1$ in column~$s(\alpha)$, a $1$ in column~$t(\alpha)$, and $0$ elsewhere,
\item $\b{z}_i$ the column vector in~$\R^{m_i}$ with a row for each arc~$\alpha$ of~$D_{\orient{F}_i}$ containing the value~$A_{i(\alpha), s(\alpha), t(\alpha)}$.
\end{itemize}
Then a point~$\b{x} \in \R^n$ belongs to the face of the $i$\ordinal braid arrangement corresponding to~$\orient{F}_i$ if and only if it satisfies~$M_i \, \b{x} \le \b{z}_i$.
Hence, $\orient{\b{F}}$ appears as a face of the $\b{a}$-braid arrangement if and only if there exists~$\b{x} \in \R^n$ such that~$M \, \b{x} \le \b{z}$, where~$M$ is the $(m \times n)$-matrix (where~$m \eqdef \sum_{i \in [\ell]} m_i$), obtained by piling the matrices~$M_i$ for~$i \in [\ell]$ and similarly, $\b{z}$ is the column vector obtained by piling the vectors~$\b{z}_i$.
A direct application of the Farkas lemma (see \eg \cite[Prop.~1.7]{Ziegler-polytopes}), there exists~$\b{x} \in \R^n$ such that~$M \, \b{x} \le \b{z}$ if and only if~$\b{c} \b{z} \ge 0$ for any~$\b{c} \in (\R^m)^*$ with~$\b{c} \ge \b{0}$ and~$\b{c} M = \b{0}$.
Now it is classical that the left kernel of the incidence matrix of a directed graph is generated by its circuits (non-necessarily oriented cycles), and that the positive cone in this left kernel is generated by its oriented cycles.
\end{proof}

\begin{remark}
Note that we made some arbitrary choices here by choosing the arc from~$\max(\orient{\pi}_j)$ to~$\min(\orient{\pi}_{j+1})$ between two consecutive parts~$\orient{\pi}_j$ and~$\orient{\pi}_{j+1}$ and a cycle inside each part~$\orient{\pi}_j$ (while we said that the order in each part is irrelevant).
We could instead have considered all arcs connecting two elements of two consecutive parts, or two elements inside the same part.
Our choices just limit the amount of oriented cycles in~$D_{\orient{\pi}}$.
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
\part{Diagonals of permutahedra}
\label{part:diagonalsPermutahedra}

This second part is devoted to the study of the combinatorics of the diagonals of the permutahedra.
In \cref{sec:cellularDiagonals}, we first recall the definition and some know facts about diagonals of polytopes (\cref{subsec:cellularDiagonalsPolytopes}), which we immediately specialize to the classical permutahedron (\cref{sec:cellularDiagonalsPermutahedra}), and connect to \cref{part:multiBraidArrangements} to derive enumerative statements on the diagonals of permutahedra (\cref{subsec:enumerationDiagonalPermutahedra}).

\vincent{To complete}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Cellular diagonals}
\label{sec:cellularDiagonals}

%%%%%%%%%%%%%%%

\subsection{Cellular diagonals for polytopes}
\label{subsec:cellularDiagonalsPolytopes}
 
Cellular approximations of the thin diagonal for families of polytopes are of fundamental importance in algebraic topology and geometry.
They allow one to define the cup product and thus define the ring structure on the cohomology groups of a topological space, and combinatorially on the Chow groups of a toric variety. 

\begin{definition} 
\label{def:thinDiagonal}
The \defn{thin diagonal} of a set $X$ is the map~$\delta : X \to X \times X$ defined by $\delta(x) \eqdef (x,x)$ for all $x \in X$.
See \cref{fig:examplesDiagonals1}\,(left).
\end{definition}

\begin{definition} 
\label{def:cellularDiagonal}
A \defn{cellular diagonal} of a $d$-dimensional polytope $P$ is a continuous map ${\Delta : P \to P \times P}$ such that
\begin{enumerate}
\item its image is a union of $d$-dimensional faces of $P\times P$ (\ie it is \defn{cellular}),
\item it agrees with the thin diagonal of~$P$ on the vertices of $P$, and
\item it is homotopic to the thin diagonal of~$P$, relative to the image of the vertices of~$P$. 
\end{enumerate}
See \cref{fig:examplesDiagonals1}\,(middle left).
A cellular diagonal is said to be \defn{face-coherent} if its restriction to a face of $P$ is itself a cellular diagonal for that face. 
\end{definition}

A powerful geometric technique to define face-coherent cellular diagonals on polytopes first appeared in \cite{fultonIntersectionTheoryToric1997a}, was presented in \cite{masudaDiagonalAssociahedra2021}, and was fully developed in \cite{LA21}.
We provide in \cref{thm:diagonal} the precise (but slightly technical) definition of these diagonals, even though we will only use the characterization of the faces in their image provided in \cref{thm:universalFormula}.

The key idea is that any vector $\b{v}$ in generic position with respect to $P$ defines a cellular diagonal of $P$.
For $\b{z}$ a point of $P$, let us denote by $\rho_{\b{z}} P \eqdef 2\b{z}-P$ denotes the reflection of $P$ with respect to the point~$\b{z}$.

\begin{definition}
    The \defn{fundamental hyperplane arrangement}~$\mathcal{H}_P$ of a polytope~$P \subset \R^d$ is the set of all linear hyperplanes of~$\R^d$ orthogonal to the edges of $P\cap \rho_{\b{z}} P$ for all $\b{z} \in P$. 
    See \cref{fig:examplesHyperplanes}.
\end{definition}

\begin{figure}[p]
	\centerline{
		\includegraphics[scale=.3]{HypSimplex.png}
		\includegraphics[scale=.35]{HypCube.png}
        \ \
		\includegraphics[scale=.3]{HypPermuto.png}
	}
	\caption{The fundamental hyperplane arrangements of the $3$-dimensional simplex, cube, and permutahedron.
    In blue are pictured the hyperplanes which are not perpendicular to actual edges of the polytope $P$, but only to edges of some intersection $P\cap \rho_z P$. 
    Left and rightmost illustrations from~\cite[Fig.~12]{LA21}.}
	\label{fig:examplesHyperplanes}
\end{figure}

A vector is \defn{generic with respect to~$P$} if it does not belong to the union of the hyperplanes of the fundamental hyperplane arrangement~$\mathcal{H}_P$.
In particular, such a vector is not perpendicular to any edge of $P$, and we denote by~$\min_{\b{v}}(P)$ (resp.~$\max_{\b{v}}(P)$) the unique vertex of~$P$ which minimizes (resp.~maximizes) the scalar product with~$\b{v}$. 

\begin{theorem}
    \label{thm:diagonal}
    For any vector $\b{v} \in \R^d$ in generic position with respect to $P$, the tight coherent section~$\triangle_{(P,\b{v})}$ of the projection $P \times P \to P, (\b{x}, \b{y}) \mapsto (\b{x}+\b{y})/2$ selected by the vector~$(-\b{v}, \b{v})$ defines a cellular diagonal of~$P$.
    More precisely, $\triangle_{(P,\b{v})}$ is given by the explicit formula
    \begin{align*}
    \begin{array}{rlcl}
        \triangle_{(P,\b{v})}\ : & P & \to & P\times P \\
        & \b{z} & \mapsto & \bigl( \min_{\b{v}}(P\cap \rho_{\b{z}} P), \, \max_{\b{v}}(P\cap \rho_{\b{z}} P) \bigr) \ .
    \end{array}
    \end{align*}
\end{theorem}

\begin{definition}
    A \defn{geometric diagonal} of a polytope~$P$ is a diagonal of the form~$\triangle_{(P,\b{v})}$ for some vector~$\b{v} \in \R^d$ in generic position with respect to~$P$.
\end{definition}

A geometric diagonal~$\triangle_{(P,\b{v})}$ only depends on the region of~$\mathcal{H}_P$ containing~$\b{v}$, see~\cite[Prop.~1.23]{LA21}.

\begin{figure}[p]
	\centerline{\scalebox{1.25}{
	\begin{tabular}{c@{\hspace{-.2cm}}c@{\hspace{-.2cm}}c@{\hspace{-.2cm}}c}
		\includegraphics[scale=1.2]{diagonalSegment1} &
		\includegraphics[scale=1.2]{diagonalSegment2} &
		\raisebox{-.2cm}{\includegraphics[scale=1]{diagonalSegment3}} &
		\raisebox{-.2cm}{\includegraphics[scale=1]{diagonalSegment4}}
		\\
		\includegraphics[scale=.9]{diagonalTriangle1} &
		\includegraphics[scale=.9]{diagonalTriangle2} &
		\includegraphics[scale=.6]{diagonalTriangle3} &
		\includegraphics[scale=.6]{diagonalTriangle4}	
		\\
		\includegraphics[scale=.9]{diagonalSquarre1} &
		\includegraphics[scale=.9]{diagonalSquarre2} &
		\includegraphics[scale=.6]{diagonalSquarre3} &
		\includegraphics[scale=.6]{diagonalSquarre4}
	\end{tabular}
	}}
	\caption{The diagonals of the segment (top), the triangle (middle) and the squarre (bottom). For each of them, we have represented the thin diagonal of~$P$ (left, in blue) and the cellular diagonal of~$P$ (middle left, in red) both in~$P \times P$, and the polytopal subdivision of~$P$ (middle right) and the common refinement of the two copies of the normal fan of~$P$ (right) both in~$P$.}
	\label{fig:examplesDiagonals1}
\end{figure}

%\begin{figure}[h!]
%	\includegraphics[scale=.9]{diagonalTriangle3}
%	\quad
%	\includegraphics[scale=.9]{diagonalTriangle4}
%	\quad
%	\includegraphics[scale=.9]{diagonalSquarre3}
%	\includegraphics[scale=.9]{diagonalSquarre4}
%	\caption{The thin (in blue) and cellular (in red) diagonals of the triangle and the square.}
%	\label{fig:examplesDiagonals1}
%\end{figure}

\begin{figure}[p]
	\centerline{
		\includegraphics[scale=.3]{diagonalSimplexGuillaume.png}
		\includegraphics[scale=.35]{diagonalCubeGuillaume.png}
		\includegraphics[scale=.3]{diagonalPermutahedronGuillaume.png}
	}
	\caption{The subdivisions induced by cellular diagonals of the $3$-dimensional simplex (left), cube (middle), and permutahedron (right). Right illustration from~\cite[Fig.~13]{LA21}.}
	\label{fig:examplesDiagonals2}
\end{figure}

Now the following \defn{universal formula}~\cite[Thm.~1.26]{LA21} expresses combinatorially the faces in the image of the geometric diagonal~$\triangle_{(P,\b{v})}$.
Recall that the \defn{normal cone} of a face~$F$ of a polytope~$P$ in~$\R^d$ is the cone of directions~$\b{c} \in \R^d$ such that the maximum of the scalar product~$\dotprod{\b{c}}{\b{x}}$ over~$P$ is attained for some~$\b{x}$ in~$F$.

\begin{theorem}[{\cite[Thm.~1.26]{LA21}}]
\label{thm:universalFormula}
Fix a vector $\b{v} \in \R^d$ in generic position with respect to $P$.
For each hyperplane~$H$ of the fundamental hyperplane arrangement~$\mathcal{H}_P$, denote by~$H^{\b{v}}$ the open half space defined by~$H$ and containing~$\b{v}$.
The faces of~$P \times P$ in the image of the geometric diagonal~$\triangle_{(P,\b{v})}$ are the faces~$F \times G$ where~$F$ and~$G$ are faces of~$P$ such that either the normal cone of~$F$ intersects~$H^{-\b{v}}$ or the normal cone of~$G$ intersects~$H^{\b{v}}$, for each~$H \in \mathcal{H}_P$.
\end{theorem}

The image of $\triangle_{(P,\b{v})}$ is a union of pairs of faces $F \times G$ of the Cartesian product~$P \times P$.
By drawing the polytopes~${(F+G)/2}$ for all pairs of faces $(F,G) \in \Ima \triangle_{(P,\b{v})}$, we can visualize~$\triangle_{(P,\b{v})}$ as a polytopal subdivision of $P$.
See \cref{fig:examplesDiagonals1}\,(middle right) and \cref{fig:examplesDiagonals2}.

It turns out that the dual of this complex is just the common refinement of two translated copies of the normal fan of~$P$.
See \cref{fig:examplesDiagonals1}\,(right).
Recall that the \defn{normal fan} of~$P$ is the fan formed by the normal cones of all faces of~$P$.
We thus obtain the following statement.

\begin{proposition}[{\cite[Coro.~1.4]{LA21}}]
\label{prop:diagonalCommonRefinement}
The inclusion poset on the faces in the image of the diagonal~$\triangle_{(P,\b{v})}$ is isomorphic to the reverse inclusion poset of the faces of the common refinement of two copies of the normal fan of~$P$, translated from each other by the vector~$\b{v}$. 
\end{proposition}

Finally, the following statement relates the image of the diagonal~$\triangle_{(P, \b{v})}$ to the intervals of the poset obtained by orienting the skeleton of~$P$ in direction~$\b{v}$.

\begin{proposition}[{\cite[Prop. 1.17]{LA21}}]
\label{prop:magicalFormula}
For any polytope $P$ and any generic vector $\b{v}$,
\begin{equation}
\label{eq:magique}
\Ima\triangle_{(P, \b{v})} \quad \subseteq \bigcup_{\substack{F,G \text{ faces of } P \\ \max_{\b{v}}(F) \, \le \, \min_{\b{v}}(G)}} F \times G \ .
\end{equation}
\end{proposition}

\begin{remark}
For some polytopes such as the simplices \cite{EilenbergMacLane54}, the cubes \cite{serre1951}, the freehedra \cite{saneblidze2009}, and the associahedra \cite{masudaDiagonalAssociahedra2021}, the reverse inclusion also holds (in the case of the simplices and the cubes, the diagonals are know as \emph{Alexander--Whitney} and \emph{Serre} maps).
According to \cite{masudaDiagonalAssociahedra2021}, the resulting equality enhancing~(\ref{eq:magique}) was called \defn{magical formula} by J.-L. Loday.
Polytopes of greater complexity such as the multiplihedra \cite{MazuirLA22} or the operahedra \cite{LA21}, which include the permutahedra, do not possess this exceptional property. 
\end{remark}

\begin{remark}
This is in fact precisely the content of the \emph{Fulton--Sturmfels formula} for the intersection product on toric varieties \cite[Thm.~4.2]{fultonIntersectionTheoryToric1997a}, where the definition of cellular diagonals as tight coherent sections first appeared.
\end{remark}

%%%%%%%%%%%%%%%

\subsection{Cellular diagonals for the permutahedra}
\label{sec:cellularDiagonalsPermutahedra}

We now specialize the statements of \cref{subsec:cellularDiagonalsPolytopes} to the standard permutahedron.
We first recall its definition.

\begin{definition}
The \defn{permutahedron}~$\Perm$ is the polytope defined equivalently as
\begin{itemize}
\item the convex hull of the points~$\sum_{i \in [n]} i \, \b{e}_{\sigma(i)}$ for all permutations~$\sigma$ of~$[n]$, see \cite{Schoute},
\item the intersection of the hyperplane~$\smash{\bigset{\b{x} \in \R^n}{\sum_{i \in I} x_i = \binom{n+1}{2}}}$ with the affine halfspaces $\smash{\bigset{\b{x} \in \R^n}{\sum_{i \in I} x_i \ge \binom{|I|+1}{2}}}$ for all~${\varnothing \ne I \subsetneq [n]}$, see \cite{Rado}.
\end{itemize}
The normal fan of the permutahedron~$\Perm$ is the fan defined by the braid arrangement~$\braidArrangement$.
In particular, the faces of~$\Perm$ correspond to the ordered partitions of~$[n]$.
Moreover, when oriented in a generic direction, the skeleton of the permutahedron~$\Perm$ is isomorphic to the Hasse diagram of the classical weak order on permutations of~$[n]$.
% when oriented in the direction~${\b{\omega} \eqdef (n,\dots,1) - (1,\dots,n) = \sum_{i \in [n]} (n+1-2i) \, \b{e}_i}$
\end{definition}

The fundamental hyperplane arrangement of the permutahedron~$\Perm$ was described in~\cite[Sect.~3.1]{LA21}.
As we will use the following set throughout the paper, we embed it in a definition.

\begin{definition}
\label{def:Un}
For~$n \in \N$, we define
\[
\Un(n) \eqdef \{ \{I,J\} \ | \ I,J \subset [n] \text{ with } |I|=|J| \text{ and } I \cap J = \varnothing\}.
\]
An \defn{ordering} of~$\Un(n)$ is a set containing exactly one of the two ordered pairs $(I,J)$ or $(J,I)$ for each $\{I,J\} \in \Un(n)$.
\end{definition}

\begin{proposition}[{\cite[Sect.~3.1]{LA21}}]
The fundamental hyperplane arrangement of the permutahedron~$\Perm$ is given by the hyperplanes~$\bigset{\b{x} \in \R^n}{\sum\limits_{i \in I} x_i = \sum\limits_{j \in J} x_j}$ for all~$\{I,J\} \in \Un(n)$.
\end{proposition}

For a vector~$\b{v}$ generic with respect to~$\Perm$, we denote by~$\Or(\b{v})$ the ordering of~$\Un(n)$ such that~$\sum_{i \in I} v_i > \sum_{j \in J} v_j$ for all~$(I,J) \in \Or(\b{v})$.
Applying \cref{thm:universalFormula}, we next describe the faces in the image of the geometric diagonal~$\triangle_{(\Perm, \b{v})}$.
For this, the following definition will be convenient.

\begin{definition}
    \label{def:domination}
For $I,J \subseteq [n]$ and an ordered partition $\sigma$ of~$[n]$ into $k$ blocks, we say that $I$~\defn{dominates} $J$ in~$\sigma$ if for all $\ell \in [k]$, the first~$\ell$ blocks of~$\sigma$ contain more elements of~$I$ than of~$J$, or the same number of elements.
\end{definition}

\begin{theorem}[{\cite[Thm.~3.16]{LA21}}]
\label{thm:IJ-description}
A pair~$(\sigma, \tau)$ of ordered partitions of~$[n]$ corresponds to a face in the image of the geometric diagonal~$\triangle_{(\Perm, \b{v})}$ if and only if, for all~$(I,J) \in \Or(\b{v})$, $J$ does not dominate~$I$ in~$\sigma$ or $I$ does not dominate~$J$ in~$\tau$.
\end{theorem}

As the normal fan of the permutahedron~$\Perm$ is the fan defined by the braid arrangement~$\braidArrangement$, we obtain by \cref{prop:diagonalCommonRefinement} the following connection between the diagonal of~$\Perm$ and the $(2,n)$-braid arrangement~$\multiBraidArrangement[2][n]$ studied in \cref{part:multiBraidArrangements}, illustrated in \cref{fig:diagonalPermutahedron1}.
%
\begin{figure}
	\includegraphics[scale=.9]{diagonalPermutahedron1}
	\caption{The duality between the $(2,3)$-braid arrangement~$\multiBraidArrangement[3][2]$ (left) and the diagonal of the permutahedron~$\Perm[3]$ (right).}
	\label{fig:diagonalPermutahedron1}
\end{figure}

\begin{proposition}
\label{prop:diagonalPermutahedraMultiBraidArrangements}
The inclusion poset on the faces in the image of the diagonal~$\triangle_{(\Perm, \b{v})}$ is isomorphic to the reverse inclusion poset of the faces of the $(2,n)$-braid arrangement~$\multiBraidArrangement[2][n]$. 
\end{proposition}

\begin{remark}
Similarly, the combinatorics of the $(\ell-1)$\ordinalst{} iteration of a diagonal of the permutahedron~$\Perm$ is given by the combinatorics of the $(\ell,n)$-braid arrangement.
\end{remark}

Finally, the permutahedron~$\Perm$ is not magical in the sense of \cref{prop:magicalFormula}.

\begin{proposition}[{\cite[Sect.~3]{LA21}}]
For any~$n > 3$ and any generic vector~$\b{v}$, the diagonal~$\triangle_{(\Perm, \b{v})}$ of the permutahedron~$\Perm$ does \emph{not} satisfy the magical formula.
Namely, the inclusion      
\begin{equation*}
\Ima\triangle_{(\Perm, \b{v})} \quad \subsetneq \bigcup_{\substack{F,G \text{ faces of } \Perm \\ \max_{\b{v}}(F) \, \le \, \min_{\b{v}}(G)}} F \times G  
\end{equation*}
is strict.
\end{proposition}

%%%%%%%%%%%%%%%

\subsection{Enumerative results on cellular diagonals of the permutahedra} 
\label{subsec:enumerationDiagonalPermutahedra}

Relying on \cref{prop:diagonalPermutahedraMultiBraidArrangements}, we now specialize the results of \cref{part:multiBraidArrangements} to the case~$\ell = 2$ to derive enumerative results on the diagonals of the permutahedra.

Observe that one can easily compute the full M\"obius polynomials of the $(2,n)$-braid arrangements~$\multiBraidArrangement[n][2]$ from \cref{thm:MobiusPolynomialMultiBraidArrangement}:
\begin{align*}
\mobPol[{\multiBraidArrangement[1][2]}] & = 1 \, , \\
\mobPol[{\multiBraidArrangement[2][2]}] & = x y - 2 x + 2 \, , \\
\mobPol[{\multiBraidArrangement[3][2]}] & = x^2 y^2 - 6 x^2 y + 10 x^2 + 6 x y - 18 x + 8 \, , \\
\mobPol[{\multiBraidArrangement[4][2]}] & = x^3 y^3 - 12 x^3 y^2 + 52 x^3 y - 84 x^3 + 12 x^2 y^2 - 96 x^2 y + 216 x^2 + 44 x y - 182 x + 50 \, , \\
\mobPol[{\multiBraidArrangement[5][2]}] & = x^4 y^4 - 20 x^4 y^3 + 160 x^4 y^2 - 620 x^4 y + 1008 x^4 \\ & \quad+ 20 x^3 y^3 - 300 x^3 y^2 + 1640 x^3 y - 3360 x^3 \\ & \quad+ 140 x^2 y^2 - 1430 x^2 y + 4130 x^2 + 410 x y - 2210 x + 432 \, .
\end{align*}
%which can be encoded in matrices as
%{\small
%\[
%\left(\begin{array}{r}
%1
%\end{array}\right)
%\left(\begin{array}{rr}
%2 & -2 \\
%0 & 1
%\end{array}\right)
%\left(\begin{array}{rrr}
%8 & -18 & 10 \\
%0 & 6 & -6 \\
%0 & 0 & 1
%\end{array}\right)
%\left(\begin{array}{rrrr}
%50 & -182 & 216 & -84 \\
%0 & 44 & -96 & 52 \\
%0 & 0 & 12 & -12 \\
%0 & 0 & 0 & 1
%\end{array}\right)
%\left(\begin{array}{rrrrr}
%432 & -2210 & 4130 & -3360 & 1008 \\
%0 & 410 & -1430 & 1640 & -620 \\
%0 & 0 & 140 & -300 & 160 \\
%0 & 0 & 0 & 20 & -20 \\
%0 & 0 & 0 & 0 & 1
%\end{array}\right)
%%\left(\begin{array}{r}
%%1
%%\end{array}\right)
%%\left(\begin{array}{rr}
%%2 & 0 \\
%%-2 & 1
%%\end{array}\right)
%%\left(\begin{array}{rrr}
%%8 & 0 & 0 \\
%%-18 & 6 & 0 \\
%%10 & -6 & 1
%%\end{array}\right)
%%\left(\begin{array}{rrrr}
%%50 & 0 & 0 & 0 \\
%%-182 & 44 & 0 & 0 \\
%%216 & -96 & 12 & 0 \\
%%-84 & 52 & -12 & 1
%%\end{array}\right)
%%\left(\begin{array}{rrrrr}
%%432 & 0 & 0 & 0 & 0 \\
%%-2210 & 410 & 0 & 0 & 0 \\
%%4130 & -1430 & 140 & 0 & 0 \\
%%-3360 & 1640 & -300 & 20 & 0 \\
%%1008 & -620 & 160 & -20 & 1
%%\end{array}\right)
%%\left(\begin{array}{rrrrrr}
%%4802 & 0 & 0 & 0 & 0 & 0 \\
%%-31922 & 4732 & 0 & 0 & 0 & 0 \\
%%82560 & -23100 & 1830 & 0 & 0 & 0 \\
%%-104400 & 41560 & -6210 & 340 & 0 & 0 \\
%%64800 & -32760 & 6960 & -720 & 30 & 0 \\
%%-15840 & 9568 & -2580 & 380 & -30 & 1
%%\end{array}\right)
%\]
%}

We now focus on the number of vertices, regions, and bounded regions of the $(2,n)$-braid arrangement~$\multiBraidArrangement[n][2]$, to obtain the number of facets, vertices, and internal vertices of the diagonal of the permutahedron~$\Perm$.
The first few values are gathered in \cref{table:enumerationDiagonalPermutahedra1,table:enumerationDiagonalPermutahedra2}.

\begin{table}
	\centerline{\scalebox{1}{
		\begin{tabular}[t]{c|ccccccccccc}
			$n$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ & $9$ & $\dots$ & OEIS \\
			\hline
			facets & $1$ & $2$ & $8$ & $50$ & $432$ & $4802$ & $65536$ & $1062882$ & $20000000$ & $\dots$ & \OEIS{A007334} \\
			vertices & $1$ & $3$ & $17$ & $149$ & $1809$ & $28399$ & $550297$ & $12732873$ & $343231361$ & $\dots$ & \OEIS{A213507} \\
			int. verts. & $1$ & $1$ & $5$ & $43$ & $529$ & $8501$ & $169021$ & $4010455$ & $110676833$ & $\dots$ & \OEIS{A251568}
		\end{tabular}
	}}
	\vspace{.3cm}
	\caption{The numbers of facets, vertices, and internal vertices of the diagonal of the permutahedron~$\Perm$ for~$n \in [9]$.}
	\label{table:enumerationDiagonalPermutahedra1}
\end{table}

\begin{table}
	\centerline{
		\begin{tabular}{c@{\quad}c@{\quad}c@{\quad}c}
			$n = 1$ & $n = 2$ & $n = 3$ & $n = 4$
			\\[.1cm]
			\begin{tabular}[t]{r|c}
				\textbf{dim} & \textbf{0}  \\
				\hline
				\textbf{0} & 1  
			\end{tabular}
			&
			\begin{tabular}[t]{r|cc}
				\textbf{dim} & \textbf{0} & \textbf{1}  \\
				\hline
				\textbf{0} & 3 & 1 \\
				\textbf{1} & 1 &  
			\end{tabular}
			&
			\begin{tabular}[t]{r|ccc}
				\textbf{dim} & \textbf{0} & \textbf{1} & \textbf{2}  \\
				\hline
				\textbf{0} & 17 & 12 & 1 \\
				\textbf{1} & 12 &  6 & \\
				\textbf{2} & 1 &  & 
			\end{tabular}
			&
			\begin{tabular}[t]{r|cccc}
				\textbf{dim} & \textbf{0} & \textbf{1} & \textbf{2} & \textbf{3} \\
				\hline
				\textbf{0} & 149 & 162 & 38 & 1 \\
				\textbf{1} & 162 & 150 & 24 & \\
				\textbf{2} & 38 & 24 & & \\
				\textbf{3} & 1 & & &
			\end{tabular}
		\end{tabular}
	}
	\vspace{.3cm}
	\centerline{
		\begin{tabular}{c@{\quad}c}
			$n = 5$ & $n = 6$
			\\[.1cm]
			\begin{tabular}[t]{r|ccccc}
				\textbf{dim} & \textbf{0} & \textbf{1} & \textbf{2} & \textbf{3} & \textbf{4} \\
				\hline
				\textbf{0} & 1809 & 2660 & 1080 & 110 & 1 \\
				\textbf{1} & 2660 & 3540 & 1200 & 80 & \\
				\textbf{2} & 1080 & 1200 & 270 & & \\
				\textbf{3} & 110 & 80 & && \\
				\textbf{4} & 1 & & & &
			\end{tabular}
			&
			\begin{tabular}[t]{r|cccccc}
				\textbf{dim} & \textbf{0} & \textbf{1} & \textbf{2} & \textbf{3} & \textbf{4} & \textbf{5} \\
				\hline
				\textbf{0} & 28399 & 52635 & 30820 & 6165 & 302 & 1 \\
				\textbf{1} & 52635 & 90870 & 67580 & 7785 & 240 & \\
				\textbf{2} & 30820 & 47580 & 20480 & 2160 & & \\
				\textbf{3} & 6165 & 7785 & 2160 & && \\
				\textbf{4} & 302 & 240 & & &&\\
				\textbf{5} & 1 & & & &&
			\end{tabular}
		\end{tabular}
	}
	\caption{Number of pairs of faces in the cellular image of the diagonal of the permutahedron~$\Perm$ for~$n \in [6]$.}
	\label{table:enumerationDiagonalPermutahedra2}
\end{table}

\begin{corollary}
\label{coro:enumerationDiagonalPermutahedra}
The diagonal of the permutahedron~$\Perm$ has 
\begin{itemize}
\item $2 (n + 1)^{n-2}$ facets,
\item $n \binom{n-1}{k_1} (n-k_1)^{k_1-1} (n-k_2)^{k_2-1}$ facets corresponding to pairs~$(F_1, F_2)$ of faces of the permutahedron~$\Perm$ with~$\dim(F_1) = k_1$ and~$\dim(F_2) = k_2$ (thus~$k_1 + k_2 = n-1$),
\item $\displaystyle n! \, [z^n] \exp \bigg( \sum_{m \ge 1} \frac{C_m \, z^m}{m} \bigg)$ vertices,
\item $\displaystyle (n-1)! \, [z^{n-1}] \exp \bigg( \sum_{m \ge 1} C_m \, z^m \bigg)$ internal vertices,
\end{itemize}
where~$\displaystyle C_m \eqdef \frac{1}{m+1} \binom{2m}{m}$ denotes the $m$\ordinal{} Catalan number.
\end{corollary}

\begin{proof}
Use the duality between the $(2,n)$-braid arrangement~$\multiBraidArrangement[n][2]$ and the diagonal of the permutahedron~$\Perm$ (see \cref{fig:diagonalPermutahedron1}), and specialize \cref{thm:verticesMultiBraidArrangement,thm:regionsMultiBraidArrangement} to~$\ell = 2$.
\end{proof}

\begin{remark}
For completeness, we provide an alternative simpler proof of the first point of \cref{coro:enumerationDiagonalPermutahedra}.
By \cref{prop:flatPosetMultiBraidArrangement}, we just need to count the $(2,n)$-partition trees.
Consider a $(2,n)$-partition tree~$\b{F} \eqdef (F_1,F_2)$ (hence~$\# F_1 + \# F_2 = n + 1$).
Consider the intersection tree~$T$ of~$\b{F}$ with vertices labeled by the parts of~$F_1$ and of~$F_2$ and edges labeled by~$[n]$, root~$T$ at the part of~$F_1$ containing vertex~$1$, forget the vertex labels of~$T$, and send each edge label of~$T$ to the next vertex away from the root, and label the root by~$0$.
See \cref{fig:tree}.
The result is a spanning tree of the complete graph~$K_{n+1}$ on~$\{0, \dots, n\}$ which must contain the edge~$(0,1)$ (because we have chosen the root to be the part of~$F_1$ containing~$1$).
%
\begin{figure}
	\centerline{\includegraphics[scale=1]{tree}}
	\caption{The bijection from rooted $(\ell,n)$-partition trees (left) to spanning trees of~$K_{n+1}$ containing the edge~$(0,1)$ (right).}
	\label{fig:tree}
\end{figure}
%
Finally, by double counting the pairs~$(T,e)$ where $T$ is a spanning tree of~$K_{n+1}$ and $e$ is an edge of~$T$, we see that $n$ times the number of spanning trees of~$K_{n+1}$ equals $\binom{n+1}{2}$ times the number of spanning trees of~$K_{n+1}$ containing~$(0,1)$.
Hence, by Cayley's formula for spanning trees of~$K_{n+1}$, we obtain that the number of $(2,n)$-partition trees~is
\[
\frac{2n}{n(n+1)} (n+1)^{n-1} = 2 (n + 1)^{n-2}.
\]
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{Operadic diagonals}
\label{sec:operadicDiagonals}

This section is devoted to the combinatorics of two specific diagonals of the permutahedra, the LA and SU diagonals (\cref{subsec:LASUdiagonal}).
We show that these are the only two operadic diagonals which induce the weak Bruhat order (\cref{prop:unique-operad}), and that they are isomorphic (\cref{subsec:isos-LA-SU}). 
Using results from the preceding Section we characterize the facets of these diagonals in terms of paths in $(2,n)$-trees (\cref{subsec:facets-operadic-diags}), and the vertices of these diagonals as pattern-avoiding pairs of permutations (\cref{subsec:vertices-operadic-diags}).

%%%%%%%%%%%%%%%

\subsection{The $\LA$ and $\SU$ diagonals}
\label{subsec:LASUdiagonal}

Recall from \cref{sec:cellularDiagonalsPermutahedra} that a geometric diagonal of the permutahedron~$\Perm$ gives a choice of ordering of the sets
\[
\Un(n)  \eqdef  \set{\{I,J\}}{I,J \subset [n] \text{ with } |I|= |J| \text{ and } I\cap J = \varnothing}.
\]
As we consider in this section diagonals for all permutahedra, we define~$\Un \eqdef \{\Un(n)\}_{n \geq 1}$.

\begin{definition}
An \defn{ordering} of~$\Un(n)$ is a choice of one of the two ordered pairs $(I,J)$ or $(J,I)$ for each $\{I,J\} \in \Un(n)$.
An \defn{ordering} of $\Un \eqdef \{\Un(n)\}_{n \ge 1}$ is a family~$\Or \eqdef \{\Or(n)\}_{n \ge 1}$ where~$\Or(n)$ is an ordering of~$\Un(n)$ for each~$n \ge 1$.
\end{definition}

\begin{definition}
The \defn{$\LA$} and~\defn{$\SU$ orderings} are defined by
\begin{itemize} 
    \item $\LA(n) \eqdef \set{(I,J)}{\{I,J\} \in \Un(n) \text{ and } \min(I\cup J) = \min I}$ and
    \item $\SU(n) \eqdef \set{(I,J)}{\{I,J\} \in \Un(n) \text{ and } \max(I\cup J) = \max J}$.
\end{itemize}
\end{definition}

\begin{definition}
\label{def:LA-and-SU}
The \defn{$\LA$ diagonal} $\LAD$ (resp. \defn{$\SU$ diagonal} $\SUD$) of the permutahedron~$\Perm$ is the geometric diagonal given by any vector $\vec v \in \R^n$ satisfying  
\[
\sum_{i \in I} v_i > \sum_{j \in J} v_j,
\]
for all~$(I,J) \in \LA(n)$ (resp.~$(I,J) \in \SU(n)$).
\end{definition}

We will prove in \cref{thm:recover-SU} that $\SUD$ is a topological enhancement of the Saneblidze--Umble diagonal from \cite{SaneblidzeUmble04}.
Both of these diagonals have opposites $(\LAD)^{\op}$ and $(\SUD)^{\op}$, obtained by permuting the factors in every term: at the level of orderings, they are obtained by permuting $I$ and $J$ in the definitions of $\LA(n)$ and $\SU(n)$, while they are given geometrically by taking $-\vec v$ instead of $\vec v$ as an orientation vector. 
The faces of the $\LA$ and $\SU$ diagonals are described the following specialisation of \cref{thm:IJ-description}.

\begin{theorem}
\label{p:minimal}
For a pair $(\sigma,\tau)$ of ordered partitions of $[n]$, we have
\begin{eqnarray*}
    (\sigma,\tau)\notin \LAD 
    & \iff & \exists (I,J) \in \LA(n) \ , J \text{ dominates } I \text{ in } \sigma \text{ and } I \text{ dominates } J \text{ in } \tau \ .
\end{eqnarray*}
The same holds for the $\SU$ diagonal by replacing $\LAD$ by $\SUD$ and $\LA(n)$ by $\SU(n)$.
\end{theorem}

%%%%%%%%%%%%%%%

\subsection{The operadic property}

The goal of this section is to prove that the $\LA$ and $\SU$ diagonals are the only two operadic diagonals which induce the weak Bruhat order the vertices of the permutahedra (\cref{prop:unique-operad}). 
In order to define this special property, we need a weighted version of the standard permutahedron $\Perm$ from \cite[Sec. 2.2]{LA21}. 

\begin{definition}
    For any $\omega \in \N$, the \defn{permutahedron of weight $\omega$} $\Perm[n,\omega] \subset \R^n$ is the convex hull  of the points points~$\sum_{i \in [n]} (\omega + i-1) \, \b{e}_{\sigma(i)}$  for all permutations $\sigma$ of $[n]$. 
\end{definition}

Let $A_1 \eqdef \{a_1,\dots,a_p\}, B \eqdef \{b_1,\dots,b_q\}$ be a partition of $[n]$.
The facet of the permutahedron $\Perm$ corresponding to the ordered partition $B | A$ is isomorphic to the product $\Perm[p,q+1] \times \Perm[q]$ of lower dimensional permutahedra, via the permutation of coordinates
\begin{equation*}
    \begin{matrix}
        \Theta & : & \R^{p} \times \R^{q} & \overset{\cong}{\longrightarrow} & \R^{n} \\
         & & (x_1,\ldots,x_p) \times (x_{p+1}, \ldots, x_{n})  & \mapsto & (x_{\sigma^{-1}(1)},\ldots,x_{\sigma^{-1}(n)})
    \end{matrix}
\end{equation*}
where $\sigma$ is the $(p,q)$-shuffle defined by $\sigma(i) \eqdef a_i$ for $1 \leq i \leq p$, and $\sigma(p+j)\eqdef b_j$ for $1 \leq j \leq q$.
Note that this map is a particular instance of the eponym map introduced in Point (5) of \cite[Prop. 2.3]{LA21}.

\begin{definition}
\label{def:operadic diagonal}
A family of diagonals $\triangle \eqdef \{\triangle_n : P_n \to P_n \times P_n\}_{n\geq 1}$ of the permutahedra is \defn{operadic} if for every face $A_1 | \ldots | A_k$ of the permutahedron $\Perm[|A_1|+\cdots + |A_k|]$, the map $\Theta$ induces a topological cellular isomorphism \[  \triangle(A_1) \times \ldots \times \triangle(A_k) \cong \triangle(A_1 | \ldots | A_k) \ . \]
\end{definition}
In other words, we require that the diagonal $\triangle$ commutes with the map $\Theta$, see \cite[Section 4.2]{LA21}.
At the algebraic level, this property is called ``comultiplicativity" in \cite{SaneblidzeUmble04}.
Note that in particular such an isomorphism respects the poset structures. 

For a pair $(I,J)$ in an ordering $\Or$, we denote by $\std(I,J)$ the \defn{standardisation function}, e.g. $\std(\{5,9,10\},\{6,8,12\}) = (\{1,4,5\},\{2,3,6\})$.
By convention, we set $\std(\{\emptyset\},\{\emptyset\}) \eqdef (\{\emptyset\},\{\emptyset\})$.

\begin{definition}
\label{def:operadic-ordering}
An ordering $\Or$ of $\Un$ is \defn{operadic} if for every $\{I,J\} \in \Un$, the following two conditions hold
\begin{enumerate}
    \item if $\std(I,J)$ is in $\Or$, then so is $(I,J)$,
    \item if there exists $I'\subset I, J'\subset J$ such that $(I',J')$ and $(I\setminus I',J\setminus J')$ are in $\Or$, then so is $(I,J)$.
\end{enumerate}
\end{definition}

We call \defn{indecomposables} of $\Or$ the pairs $(I,J) \in \Or$ for which the only subpair $(I',J')$ satisfying Condition (2) above is the pair $(I,J)$ itself.

\begin{proposition}
\label{prop:equiv-operadic}
    A geometric diagonal of the permutahedra is operadic if and only if its associated ordering is. 
\end{proposition}

\begin{proof}
    Every operadic diagonal satisfies \cite[Prop.~4.14]{LA21}, which amounts precisely to an operadic ordering of $\Un$ in the above sense. 
\end{proof}

We now turn to the study of the $\LA$ and $\SU$ orderings.

\begin{lemma} 
\label{lem:operadic-ordering}
The $\LA$ and $\SU$ orderings are operadic, and their indecomposables are the pairs whose standardisation are $(\{1\},\{2\})$ and
\begin{align}
(\{1,k+2,k+3,\dots,2k-1,2k\}, \{2,3,\dots,k+1\}) \tag{$\LA$} \label{eq:std-LA} \\
(\{k,k+1,\dots,2k-1\},\{1,2,3,\dots,k-1,2k\}) \tag{$\SU$}
\end{align} 
for $k\geq 1$. 
The dual orders $\LA^{op}$ and $\SU^{op}$ are also operadic, and generated by the opposite pairs.
\end{lemma}

\begin{proof}
We present the proof for the $\LA$ ordering, the proofs for the $\SU$ and opposite orders are similar.
First, we verify that $\LA$ is operadic. 
Condition (1) follows from the fact that standardising a pair preserves its minimal element.
Condition (2) also holds, since whenever $(I',J')$ and its complement are in $\LA$, we have $\min(I)=\min\{\min(I'),\min(I\setminus I')\}$, and thus $(I,J)$ itself is in $\LA$.

Second, we compute the indecomposables. 
Let $(I,J)$ be a pair with standardisation (\ref{eq:std-LA}).
If we try to decompose $(I,J)$ as a non-trivial union, there is always one pair $(I',J')$ in this union for which~$\min (I\cup J) \notin I'$, so we have $\min ( I' \cup J') = \min J'$, which implies that $(I',J') \notin \LA$.
Thus, the pair~$(I,J)$ is indecomposable. 

It remains to show that any pair $(I,J)$ in $\LA$ whose standardisation is not of the form (\ref{eq:std-LA}) can be decomposed as a union of such pairs. 
Let us denote by $(I_k,J_k)$ the standard form (\ref{eq:std-LA}) and let $(I,J)\in \LA$ be such that $\std(I,J) \neq (I_k,J_k)$.
Then there exists $i_2 \in I\setminus \min I$ such that $i_2 < \max J$.
This means that $(I,J)$ can be decomposed as a union: if we write it as $(\{i_1,\dots,i_k\},\{j_1,\dots,j_k\})$, where each set ordered smallest to largest, then we must have $\min (I\cup J)=i_1<i_2<j_k$, in which case $(\{i_2\},\{j_k\})$ and $(\{i_1,i_3,\dots,i_k\},\{j_1,\dots,j_{k-1}\})$ are both smaller $\LA$ pairs.
Then it must be the case that $\std((\{i_2\},\{j_k\})) = (\{1\},\{2\})$, and $\std((\{i_1,i_3,\dots,i_k\},\{j_1,\dots,j_{k-1}\}))$ is either $(I_{k-1},J_{k-1})$, or we can repeat this decomposition.
This process must eventually terminate with the right-hand side reducing to $(I_l,J_l)$ for some $1 \leq l \leq k-1$.
In other words, any $(I,J) = (\{i_1,\dots,i_k\}, \{j_1,\dots,j_k\})$ decomposes as
\begin{align*}
	(I,J) = (\{i_2\},\{j_k\}) \sqcup (\{i_3\},\{j_{k-1}\}) \sqcup \dots \sqcup (\{i_{l+1} \},\{j_{k-l-1} \}) \sqcup (I',J')
\end{align*}
where $\std((I',J')) = (I_l,J_l)$, and $1\leq l \leq k$.
\end{proof}

\begin{remark}
    We note that the decomposition in \cref{lem:operadic-ordering} is one of potentially many different decompositions of the pair $(I,J)$. 
    However, by definition of the $\LA$ order, for any decomposition $(I,J) = (\sqcup_{a\in A} I_a, \sqcup_{a \in A} J_a)$, we have that $\forall a \in A, \std(I_a, J_a) \in \LA$.
    As such all decompositions of a pair $(I,J)$ order it the same way.
\end{remark}

\begin{proposition}
\label{prop:operadic-ordering}
The only operadic orderings of $\Un=\{\Un(n)\}_{n\geq 1}$ are the $\LA,\SU,\LA^{\op}$ and $\SU^{\op}$ orderings.
\end{proposition}

\begin{proof}
We build operadic orderings inductively, showing that the choices for $\Un(n)$, $n\leq 4$ determine higher ones. 
We prove the statement for the $\LA$ order, the $\SU$ and opposite orders are similar. 
First, we decide to order by $(\{1\},\{2\})$ the unique pair of $\Un(2)$.
The operadic property then determines the orders of all the pairs of $\Un(3)$ and $\Un(4)$, except the pair $\{\{1,4\},\{2,3\}\}$, for which we choose the order $(\{1,4\},\{2,3\})$.
Now, we claim that all the higher choices are forced by the operadic property. 
Starting instead with the orders $(\{1\},\{2\})$ and $(\{2,3\},\{1,4\})$ would give the $\SU$ diagonal, and reversing the pairs would give the opposite orders. 

Let $l\geq 2$ and suppose that for all $k\leq l$, we have given the pair $\{I_k,J_k\} \eqdef \{\{1,k+2,k+3,\dots,2k-1,2k\},\{2,3,\dots,k+1\}\}$ the $\LA$ ordering $(I_k,J_k)$.
Then from \cref{lem:operadic-ordering} we know that the only $\{I,J\}$ pair of order $l+1$ that will not decompose, and hence be specified by the already chosen conditions, is $\{I_{l+1},J_{l+1}\}$.
As such, the only way we can vary from $\LA$ is to order this elements in the opposite direction $(J_{l+1},I_{l+1})$.
Let us show that this choice leads to a contradiction in the ordering of the pair $\{I_m,J_m\}$ of order $m \eqdef l+2$ (see \cref{ex:Non-coherent order contradiction}).
On the one side, we can write $\{I_m,J_m\} = \{I_a \cup I_b, J_a \cup J_b\}$ with $I_a \eqdef  \{1,m+3,\dots,2m\}, J_a \eqdef  \{4,5,\dots,m+2\}, I_b \eqdef \{3\}$ and $J_b \eqdef  \{2\}$. 
By hypothesis, we have the orders $(J_a,I_a)$ and $(J_b,I_b)$ which imply the order $(J_m,I_m)$ since our ordering is operadic. 
On the other side, we can write $\{I_m,J_m\} = \{I_c \cup I_d, J_c \cup J_d\}$, where $I_c \eqdef  \{1,m+3,\dots,  2m-1\}, J_c \eqdef \{2,5,\dots,m+1\}, I_d \eqdef \{3, 2m\}$ and $J_d \eqdef  \{4, m+2\}$.
By hypothesis, we have the orders $(I_c,J_c)$ and $(I_d,J_d)$ which imply that $(I_m,J_m)$, a contradiction.
Thus, the only possible operadic choice of ordering for $\{I_{l+1},J_{l+1}\}$ is the $\LA$ ordering, which finishes the proof. 
\end{proof}

\begin{example} 
\label{ex:Non-coherent order contradiction}
Suppose that the $\LA$ order holds for pairs of order $1$ and $2$, but is reversed for pairs of order $3$, i.e. we have 
\begin{align*}
    \{1\}<\{2\},\quad \{1,4\}< \{2,3\}, \text{ and } \{1, 5, 6 \} > \{2, 3, 4\} \ .
\end{align*}
Then $\{I,J\}=\{\{1, 3, 7, 8\}, \{2, 4, 5, 6\}\}$ admits two different orientations.
In particular, 
\begin{align*}
    \{1, 7, 8\} > \{ 4, 5, 6 \} \text{ and } \{3\} > \{2\} &\implies \{1, 3, 7, 8\} >\{2, 4, 5, 6\} \ \text{and} \\
    \{1, 7\}< \{2, 5\} \text{ and } \{3, 8\}< \{4, 6\} &\implies \{1, 3, 7, 8\} <\{2, 4, 5, 6\} \ .
\end{align*}
\end{example}

Combining \cref{prop:equiv-operadic} with \cref{prop:operadic-ordering}, we get the main result of this section.
Recall that a vector induces the weak Bruhat order on the vertices of the standard permutahedron if and only if it has strictly decreasing coordinates.\Guillaume{@Vincent: quoi citer?}

\begin{theorem}
\label{prop:unique-operad}
There are exactly four operadic geometric diagonals of the permutahedra, given by the $\LA$ and $\SU$ diagonals, and their opposites. 
The $\LA$ and $\SU$ diagonals are the only operadic geometric diagonals which induce the weak Bruhat order on the vertices.
\end{theorem}

\begin{remark}
    This answers by the negative a conjecture regarding unicity of diagonals on the permutahedra, raised at the beginning of \cite[Sect.~3]{SaneblidzeUmble04}, and could be seen as an alternative statement. 
    See \cref{sec:shifts} where we prove that the geometric $\SU$ diagonal is a topological enhancement of the $\SU$ diagonal from \cite{SaneblidzeUmble04}.
\end{remark}

%%%%%%%%%%%%%%%

\subsection{Isomorphisms between operadic diagonals}
\label{subsec:isos-LA-SU}

Let $P$ be a centrally symmetric polytope, and let $s : P \to P$ be its involution, given by taking a point $p \in P$ to its reflection $s(p)$ with respect to the center of symmetry of $P$. 
Note that this map is cellular, and induces an involution on the face lattice of $P$. 
For $P$ the permutahedron, this face poset involution is given by the assignment $A_1 | \cdots | A_k \mapsto A_k | \cdots | A_1$. 

The permutahedron possesses another symmetry: the cellular involution $r : P \to P$ which sends a point $p \in P$ to its reflection with respect to the hyperplane of equation \[ \sum_{i=1}^{\lfloor n/2 \rfloor}x_i = \sum_{i=1}^{\lfloor n/2 \rfloor}x_{n-i+1} \ . \]
This involution also respects the face poset structure. 
In terms of ordered partitions, it replaces each block $A_j$ in $A_1 | \cdots | A_k$ by the block $r(A_j) \eqdef \{n-i+1 \ | \ i \in A_j\}$.

The involution $t : P \times P \to P \times P$ sending $(x,y)$ to~$(y,x)$ takes a cellular diagonal to another cellular diagonal.
As we have already remarked in \cref{subsec:LASUdiagonal}, in the case of the permutahedron it sends $\LAD$ to $(\LAD)^\op$ and $\SUD$ to $(\SUD)^\op$.

\begin{theorem}
    \label{thm:bijection-operadic-diagonals}
    For $P$ the permutahedron, the involutions $t$ and $rs \times rs$ are cellular isomorphisms between the four operadic diagonals, through the following commutative diagram
    \begin{center}
        \begin{tikzcd}
        \LAD \arrow[r,"t"] \arrow[d,"rs \times rs"]&
        (\LAD)^{\op}\arrow[d,"rs \times rs"]\\
        \SUD \arrow[r,"t"] &
        (\SUD)^\op \ .
        \end{tikzcd}
        \end{center}
    Moreover, they induce poset isomorphisms at the level of the face lattices. 
\end{theorem}

\begin{proof} \Guillaume{Could be rephrased in terms of domination...}
    The result for the transpositions $t$ and the commutativity of the diagram are straighforward, so we prove that $rs\times rs$ is a cellular isomorphism respecting the poset structure. 
    First, we observe that the assignment $(I,J) \mapsto (r(J),r(I))$ defines a bijection between $\LA(n)$ and $\SU(n)$. 
    Indeed, we have $r(\min(I\cup J))=\max(I\cup J)$; since $I \cap J = \varnothing$, $r$ is well-defined, and it is a bijection with inverse $r$ itself.  
    Denoting by $N^c$ the complement of a subset $N \subset [n]$, we have that $|N \cap I| > |N\cap J| \iff |N^c \cap I|< |N^c \cap J|$.
    Combining this with the fact that $|N \cap I| > |N\cap J| \iff |r(N) \cap r(I)| > |r(N) \cap r(J)|$, we obtain that 
    \begin{eqnarray*}
        |N \cap I| > |N\cap J| \iff |r(N)^c \cap r(I)| < |r(N)^c \cap r(J)| \ .
    \end{eqnarray*}
    Similarly, we have $|N' \cap I| < |N'\cap J| \iff |r(N')^c \cap r(I)| > |r(N')^c \cap r(J)|$, so that $(\sigma,\tau) \in \LAD$ if and only if $(rs(\sigma),rs(\tau)) \in \SUD$. 
    Finally, since both $t,r$ and $s$ preserve the poset structures, so does their composition, which finishes the proof.
\end{proof}

\begin{remark} \label{rem:Alternate Isomorphism}
There is a second, distinct isomorphism given by $t(r\times r)$.
This follows as $s\times s:\LAD \to (\LAD)^{\op}$ is an isomorphism (and also for  $s\times s:\SUD \to (\SUD)^{\op}$ ), as such the composite 
\begin{center}
\begin{tikzcd}
t(r\times r):\LAD \arrow[r,"s\times s"] &
(\LAD)^{\op}\arrow[r,"rs \times rs"] &
(\SUD)^\op \arrow[r,"t"] & \SUD
\end{tikzcd}
\end{center}
is also an isomorphism.
This second isomorphism has the conceptual benefit of sending left shift operators to left shift operators (and right to right), see \cref{prop:trr is an isomorphism of shifts}.
\end{remark}

%%%%%%%%%%%%%%%

\subsection{Facets of operadic diagonals}
\label{subsec:facets-operadic-diags}

We aim at describing the facets of the $\LA$ and $\SU$ diagonals. 
We have seen in \cref{subsec:multiBraidArrangement} that facets of any diagonal of the permutahedron are in bijection with $(2,n)$-trees, that is, pairs of unordered partitions of $[n]$ whose intersection graph is a tree.
These pairs of partitions were first studied and called essential complementary partitions in \cite{chen1969computer,chen1971tables,kajitani1982number}.
We now explain how to order these pairs of partitions to get the facets of $\LAD$ and $\SUD$. 

\begin{theorem}
    \label{thm:facet-ordering}
    Let $(\sigma,\tau)$ be two ordered partitions of $[n]$ whose underlying intersection graph is a $(2,n)$-tree.
    We have that $(\sigma,\tau) \in \LAD$ (resp. $\SUD$) if and only if the minimum (resp. maximum) of every directed path between two consecutive blocks of $\sigma$ or $\tau$ is oriented from $\sigma$ to $\tau$, that is from left to right (resp. from $\tau$ to $\sigma$, that is from right to left).
\end{theorem}

\begin{proof}
    We specialize \cref{prop:PFtoOPF1} to the $\LA$ diagonal, the proof for the $\SU$ diagonal is similar. 
    Let $\vec v$ be a vector inducing the $\LA$ diagonal as in \cref{def:LA-and-SU}.
    Without loss of generality, we place the first copy of the braid arrangement centered at $0$, and the second copy centered at $\vec v$.
    From \cref{def:multiBraidArrangementPrecise} we get that $A_{1,s,t}=0$ and $A_{2,s,t}=v_s-v_t$ for any edges $s,t$.
    We treat the case of a two consecutive blocks $A$ and $B$ of $\sigma$, the analysis for $\tau$ is similar. 
    The directed path between $A$ and $B$ is a sequence of edges $r_0,r_1,\dots,r_q$.  
    Let us denote by $I \eqdef \{r_0,r_2,\dots\}$ de set of edges directed from $\sigma$ to $\tau$, and by $J \eqdef \{r_1,r_3,\dots\}$ its complement. 
    According to \cref{prop:PFtoOPF1}, the order between $A$ and $B$ is determined by the sign of $A_{1,r_0,r_q}- \sum_{p \in [q]} A_{i_p,r_{p-1},r_p}$, where $i_p$ is the copy of the block adjacent to both edges $r_{p-1}$ and $r_p$. 
    Thus, the order between $A$ and $B$ is determined by the sign of $\sum_{i \in I} v_i - \sum_{j \in J} v_j$, which according to the definition of $\LAD$ is positive whenever $\min(I\cup J) \in I$. 
    Thus, the pair $(\sigma,\tau) \in \LAD$ if and only if the mimum of every directed path between two consecutive blocks of $\sigma$ or $\tau$ is oriented from $\sigma$ to $\tau$. 
\end{proof}

The $\LA$ and $\SU$ diagonals coincide up to dimension $2$. \Guillaume{Shouldn't we say that before?}
Their facets for the $2$-dimensional permutahedron are illustrated on the first page of this article.  

\begin{example}
\label{ex:ECbijection}
Below are the two orderings of the $(2,7)$-tree $\{15,234,6,7\} \times \{13,2,46,57\}$ giving facets of the $\LA$ (left) and $\SU$ (right) diagonals, obtained via \cref{thm:facet-ordering}.
Note that ordered partitions should be read from top to bottom.\Guillaume{Does this fit with previous conventions?}
\begin{center}
\begin{tikzpicture}[scale=.7]  
\node (1) at (-1.5, -1) {$15$};
\node (2) at (-1.5, -2) {$7$};
\node (3) at (-1.5, -3) {$234$};
\node (4) at (-1.5, -4) {$6$};
%
\node (5) at (1.5, -1) {$57$};
\node (6) at (1.5, -2) {$46$};
\node (7) at (1.5, -3) {$13$};
\node (8) at (1.5, -4) {$2$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (7);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (6); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (7); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (8); 
\draw[thick] (4) to [in=180, out=0, looseness=0] (6);
%
\end{tikzpicture}
$\quad$
\begin{tikzpicture}[scale=.7]  
    \node (2) at (1.5, -4) {$2$};
    \node (13) at (1.5, -3) {$13$};
    \node (46) at (1.5, -2) {$46$};
    \node (57) at (1.5, -1) {$57$};
    %
    \node (7) at (-1.5, -4) {$7$};
    \node (6) at (-1.5, -3) {$6$};
    \node (234) at (-1.5, -2) {$234$};
    \node (15) at (-1.5, -1) {$15$};
    %
    \draw[thick] (2) to [out=180, in=0, looseness=0] (234);
    \draw[thick] (13) to [out=180, in=0, looseness=0] (15); 
    \draw[thick] (13) to [out=180, in=0, looseness=0] (234);
    \draw[thick] (46) to [out=180, in=0, looseness=0] (234);
    \draw[thick] (46) to [out=180, in=0, looseness=0] (6); 
    \draw[thick] (57) to [out=180, in=0, looseness=0] (15);
    \draw[thick] (57) to [out=180, in=0, looseness=0] (7);
    %
    \end{tikzpicture}
\end{center}
In the $\LA$ facet (left), we have $7 < 234$ since the minimum $1$ of the path $7 \xrightarrow{7} 57 \xrightarrow{5} 15 \xrightarrow{1} 13 \xrightarrow{3} 234$ between the two vertices is oriented from left to right. 
In this case, we have $(I,J)=(\{1,7\},\{3,5\})$.
Similarly, the path $57 \xrightarrow{5} 15 \xrightarrow{1} 13 \xrightarrow{3} 234 \xrightarrow{4} 46$ imposes that $57 < 46$, while we have $(I,J)=(\{1,4\},\{3,5\})$.
\end{example}

\begin{remark}
    Note that forgetting the order in a facet of $\LAD$, and then ordering again the $(2,n)$-tree to obtain a facet of $\SUD$, provides an isomorphism between facets that was not considered in \cref{subsec:isos-LA-SU}.
    However this map is not defined on the other faces.
\end{remark}

\begin{example}
The isomorphism $rs\times rs$ from \cref{thm:bijection-operadic-diagonals} sends the $\LA$ facet from \cref{ex:ECbijection} (left) to the following $\SU$ facet (right).
\begin{center}
\begin{tikzpicture}[scale=.7]  
    \node (1) at (-1.5, -1) {$15$};
    \node (2) at (-1.5, -2) {$7$};
    \node (3) at (-1.5, -3) {$234$};
    \node (4) at (-1.5, -4) {$6$};
    %
    \node (5) at (1.5, -1) {$57$};
    \node (6) at (1.5, -2) {$46$};
    \node (7) at (1.5, -3) {$13$};
    \node (8) at (1.5, -4) {$2$};
    %
    \draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
    \draw[thick] (1) to [in=180, out=0, looseness=0] (7);
    \draw[thick] (2) to [in=180, out=0, looseness=0] (5); 
    \draw[thick] (3) to [in=180, out=0, looseness=0] (6); 
    \draw[thick] (3) to [in=180, out=0, looseness=0] (7); 
    \draw[thick] (3) to [in=180, out=0, looseness=0] (8); 
    \draw[thick] (4) to [in=180, out=0, looseness=0] (6);
    %
\end{tikzpicture}
    $\quad$
\begin{tikzpicture}[scale=.7]  
    \node (1) at (1.5, -4) {$13$};
    \node (2) at (1.5, -3) {$24$};
    \node (3) at (1.5, -2) {$57$};
    \node (4) at (1.5, -1) {$6$};
    %
    \node (5) at (-1.5, -4) {$37$};
    \node (6) at (-1.5, -3) {$1$};
    \node (7) at (-1.5, -2) {$456$};
    \node (8) at (-1.5, -1) {$2$};
    %
    \draw[thick] (1) to [out=180, in=0, looseness=0] (5);
    \draw[thick] (1) to [out=180, in=0, looseness=0] (6); 
    \draw[thick] (2) to [out=180, in=0, looseness=0] (7);
    \draw[thick] (2) to [out=180, in=0, looseness=0](8);
    \draw[thick] (3) to [out=180, in=0, looseness=0] (5); 
    \draw[thick] (3) to [out=180, in=0, looseness=0] (7);
    \draw[thick] (4) to [out=180, in=0, looseness=0] (7);
    %
\end{tikzpicture}
\end{center}
Moreover, it sends the path $57 \xrightarrow{5} 15 \xrightarrow{1} 13 \xrightarrow{3} 234 \xrightarrow{4} 46 $ to the path $24 \xrightarrow{4} 456 \xrightarrow{5} 57 \xrightarrow{7} 37 \xrightarrow{3} 13$, where the maximum $7$ is oriented from right to left, witnessing the fact that $24 < 13$. 
The associated $(I,J)=(\{1,4 \},\{3,5\})$ becomes $(r(J),r(I))=(\{3,5 \},\{4,7\})$.
\end{example}


%%%%%%%%%%%%%%%

\subsection{Vertices of operadic diagonals}
\label{subsec:vertices-operadic-diags}

We are now interested in characterizing the vertices that occur in an operadic diagonal as pattern-avoiding pairs of partitions of $[n]$. 
These pairs form a strict subset of the weak Bruhat intervals. 
We first need the following Lemma, which follows directly from the definition of domination (\cref{def:domination}).

\begin{lemma}
\label{lem:Coherent Domination}
Let $\sigma$ be an ordered partition of $[n]$ and let $I,J \subseteq [n]$ be such that $I$ dominates $J$ in $\sigma$. 
For an element $i$ in $I$ or $J$, we denote by $\nu(i)$ the index of the block containing it in $\sigma$. 
Then, for any $i \in I,j \in J$, we have that $I\setminus i$ dominates $J\setminus j$ in $\sigma$ if and only if either
\begin{enumerate}
    \item $j$ comes before $i$ in $\sigma$, or 
    \item for all $k$ between $\nu(i)$ and $\nu(j)$, the first $k$ blocks of $\sigma$ contain stricly more elements of $I$ than of $J$.
\end{enumerate}
\end{lemma}

As before, we represent a permutation $\sigma: [n] \to [n]$ by the non-commutative word~$\sigma(1)\cdots \sigma(n)$.

\begin{definition}
    For $k\leq n$, a permutation $\tau$ of $[k]$ is a \defn{pattern} of a permutation $\sigma$ of $[n]$ if there exists a subset $I \subset [n]$ of size $|I|=k$ such that $\std(I \cap \sigma)=\tau$. 
    We say that $\sigma$ \defn{avoids} $\tau$ if $\tau$ is not a pattern of $\sigma$. 
\end{definition}

\begin{example}
    Pairs of permutations $(\sigma,\tau)$ avoiding the patterns $(21,12)$ are precisely intervals of the weak Bruhat order. 
\end{example}

\begin{theorem}
\label{prop: LAD Fish Pattern}
A pair of permutations of $[n]$ is in the $\LA$ (resp. $\SU$) diagonal if and only if for any~$k\geq 1$ and for any $(I,J) \in \LA(k)$ (resp. $\SU(k)$) of size $|I|=|J|=k$ it avoids the patterns 
\begin{align}
    (j_1 i_1 j_2 i_2 \cdots j_k i_k,\ i_2 j_1 i_3 j_2 \cdots i_k j_{k-1} i_1 j_k) \ , \tag{LA} \label{eq:pattern} \\
    \text{ resp. } (j_1 i_1 j_2 i_2 \cdots j_k i_k, \ i_1 j_k i_2 j_1 \cdots i_{k-1} j_{k-2}i_k j_{k-1}) \ , \tag{SU}
\end{align}
where $I=\{i_1,\dots,i_k\}$, $J=\{j_1,\dots,j_k\}$ and $i_1=1$ (resp. $j_k=2k$).
\end{theorem}

\begin{example}
    There are $(k-1)!k!$ avoided patterns.
    For $k=1,2$ they are given by $(21,12)$, $(2134,4213)$ and $(3124,4312)$ for the $\LA$ diagonal, and by $(21,12)$, $(1243,2431)$ and $(1342, 3421)$ for the $\SU$ diagonal.
\end{example}

\begin{proof}
We give the proof for the $\LA$ diagonal, the one for the $\SU$ diagonal is similar, and can be obtained by applying either of the two isomorphisms of \cref{subsec:isos-LA-SU}.
According to \cref{thm:IJ-description}, we have that $(\sigma,\tau) \notin \LAD$ if and only if there is an $(I,J)$ such that~$J$ dominates $I$ in $\sigma$ and $I$ dominates $J$ in $\tau$.
It remains to show this last condition is equivalent to the existence of a pattern of the form (\ref{eq:pattern}).
It is clear that if a pair of permutations $(\sigma,\tau)$ contains a pattern, then the associated $(I,J)$ satisfies the domination condition; thus we just need to show the reverse implication. 
We proceed by induction on the cardinality $|I|=|J|$. 
The case of cardinality $1$ is clear. 
Now suppose that for all $(I,J)$ of size $|I|=|J|\leq m-1$, we have that if~$J$ dominates $I$ in $\sigma$ and $I$ dominates $J$ in $\tau$, then $(\sigma,\tau)$ contains a pattern of the form~(\ref{eq:pattern}).

We need to show that this is still true for the pairs $(I,J)$ of size $|I|=|J|=m$.
Firstly, suppose that the leftmost element $i_1$ of $I$ in $\sigma$ is not $1$, and let us write $j_1$ for the leftmost element of $J$ in $\tau$.
Let us consider the pair $(I',J') \eqdef (I\setminus \{i_1\}, J \setminus \{j_1\})$.
Using both cases of \cref{lem:Coherent Domination}, we have that $J'$ dominates $I'$ in $\sigma$, and $I'$ dominates $J'$ in $\tau$, and we can thus conclude with the induction hypothesis. 

Secondly, suppose that the leftmost element of $I$ in $\sigma$ is $i_1=1$.
Then, for $n\geq1$ we prove that,
\begin{enumerate}[(a)]
    \item if the intersection of $(\sigma,\tau)$ with $I \cup J$ is of the form $$(j_1 i_1 j_2 i_2 ... j_{n-1} i_{n-1} w i_{n} w', \ i_2 j_1 i_3 j_2 ... i_{n}j_{n-1}w'') \ , $$ and $j_n$ is the leftmost element of $J\setminus \{j_1,...,j_{n-1}\}$ in $\tau$, then either we have $w = j_n$, or we can conclude with the induction hypothesis.
    \item if the intersection of $(\sigma,\tau)$ with $I \cup J$ is of the form $$(j_1 i_1 j_2 i_2 ... j_{n-1} i_{n-1} w'', \ i_2 j_1 i_3 j_2 ... i_{n-1}j_{n-2} w j_{n-1} w'') \ , $$ and $i_n$ is the leftmost $I\setminus \{i_1,...,i_{n-1}\}$ in $\sigma$, then either we have $w = i_n$, or we can conclude with the induction hypothesis.
\end{enumerate}
We prove $(a)$, the proof of $(b)$ proceeds similarly. 
Let $j_n$ be the leftmost element of $J\setminus \{j_1,...,j_{n-1} \}$ in $\tau$.
Suppose that $w\neq j_n$, then either (i) $w$ consists of multiple elements of $J$ including $j_n$, or (ii) $j_n$ comes after $i_n$ in $\sigma$.
Now consider the pair $(I',J') \eqdef (I_k\setminus \{i_n\}, J_k \setminus \{j_n\})$.
As was the case for the proof that $i_1=1$, we have that $I'$ dominate $J'$ in $\tau$.
To prove that $J'$ dominates $I'$ in $\sigma$, we split by the cases.
In case (i), we may apply condition $(2)$ of \cref{lem:Coherent Domination}.
In case (ii), either $i_n$ comes before $j_n$, in which case we meet condition $(1)$ of \cref{lem:Coherent Domination}, or $j_n$ comes before $i_n$.
In this last situation, we have that condition $(2)$ of \cref{lem:Coherent Domination} holds as $i_n$ is the leftmost element of $I\setminus \{i_1,...,i_{n-1} \}$ in $\sigma$.
Thus, if $w \neq j_n$, we can apply the induction hypothesis. 

Having in hand statements (a) and (b) above, we can inductively generate the entire permutation, determining $j_1$ via $(a)$, then $i_2$ via $(b)$, then $j_2$ via $(a)$ and so on.
This inductive process fully generates the intersection of $I\cup J$ with $\sigma$, and places all elements of the intersection with $\tau$ except $i_1$, with a final known expression of the form $i_2 j_1 i_3 j_2 \cdots i_k j_{k-1} w j_k w''$.
However, as $j_k$ must be dominated by an element of $I$, this forces $w = i_1$ and $w'' =\varnothing$, completing the proof.
\end{proof}

\begin{example}
    These are a subset of intervals of the weak Bruhat order...
    \Guillaume{Give the lists in low dimensions?}
\end{example}

\begin{remark}
    The avoided patterns resemble a fish, when drawn as... \Guillaume{Make some drawings?!}
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{Shifts and the lattice of facets}
\label{sec:shifts}

In this section we show that the geometric $\SU$ diagonal $\SUD$ is a topological enhancement of the original Saneblidze-Umble diagonal \cite{SaneblidzeUmble04}.
This study leads to a natural lattice structure on the set of facets of operadic diagonals, and to alternative combinatorial descriptions such as a matrix and a cubical representations. 
Throughout this Section, we borrow notation from \cite{saneblidzeComparingDiagonalsAssociahedra2022}.

%%%%%%%%%%%%%%%

\subsection{Topological enhancement of the original $\SU$ diagonal}

In this section we prove that the geometric $\SU$ diagonal $\SUD$ agrees at the cellular level with the original Saneblidze-Umble diagonal defined in \cite{SaneblidzeUmble04}.
The proof is technical and procedes in several steps: we introduce two additional combinatorial descriptions of the diagonal, that we call the $1$-shift and $m$-shift $\SU$ diagonals, and show the sequence of equivalences
\begin{center}
\begin{tikzcd}
\text{original $\SUD$} \arrow[r,leftrightarrow,"\ref{prop:iso-original-shift-diagonals}"]&
\text{$1$-shift $\SUD$} \arrow[r,leftrightarrow,"\ref{prop:iso-1-to-m-shift}"]&
\text{$m$-shift $\SUD$} \arrow[r,leftrightarrow,"\ref{prop:iso-shift-IJ-diagonals}"]&
\text{geometric $\SUD$} \ .
\end{tikzcd}
\end{center}

%%%%%%%%%%%%%%%

\subsubsection{Strong complementary pairs}

\begin{definition}
\label{def:strong-complementary-pairs}
A \defn{strong complementary pair ($\SCP$ for short)} is a pair$(\sigma,\tau)$ of ordered partitions of $[n]$ where $\sigma$ is obtained from a permutation of $[n]$ by merging the adjacent elements which are decreasing, and $\tau$ is obtained from the same permutation by merging the adjacent elements which are increasing.
\end{definition}

We denote by $\SCP(n)$ the set of $\SCP$s of $[n]$, which is in bijection with the set of permutations of $[n]$.
As is clear from the definition, the intersection graph of an $\SCP$ is a $(2,n)$-tree.

\begin{example}
\label{ex:strong-complementary}
The SCP associated to the permutation $3|1|7|4|2|5|6$ is
\begin{center}
\begin{tikzpicture}[scale=.7]  
    \node (p) at (0, 0) {$13|247|5|6 \times 3|17|4|256$};
    \node (1) at (-1.5, -1) {$13$};
    \node (2) at (-1.5, -2) {$247$};
    \node (3) at (-1.5, -3) {$5$};
    \node (4) at (-1.5, -4) {$6$};
    %
    \node (5) at (1.5, -1) {$3$};
    \node (6) at (1.5, -2) {$17$};
    \node (7) at (1.5, -3) {$4$};
    \node (8) at (1.5, -4) {$256$};
    %
    \draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
    \draw[thick] (1) to [in=180, out=0, looseness=0] (6); 
    \draw[thick] (2) to [in=180, out=0, looseness=0] (6); 
    \draw[thick] (2) to [in=180, out=0, looseness=0] (7); 
    \draw[thick] (2) to [in=180, out=0, looseness=0] (8); 
    \draw[thick] (3) to [in=180, out=0, looseness=0] (8); 
    \draw[thick] (4) to [in=180, out=0, looseness=0] (8);
    %
\end{tikzpicture}
\end{center}
Observe that the permutation can be read off the intersection graph of the SCP by a vertical down slice through the edges.
\end{example}

\begin{notation}
    For a $(2,n)$-tree $(\sigma,\tau)$, we denote by $\sigma_{i,j}$ (resp.~$\tau_{i,j}$) the unique oriented path between blocks $\sigma_{i}$ and $\sigma_j$ (resp.~$\tau_{i}$ and $\tau_j$).
\end{notation}
Note that we make a slight abuse in notation as the path $\sigma_{i,j}$ also depends on $\tau$.
We can immediately characterise the paths between adjacent blocks in $\SCP$s.

\begin{proposition} 
\label{lem:SCP-path-desc}
For any strong complementary pair $(\sigma,\tau)$, we have that
\begin{enumerate}
    \item $ \sigma_{i,i+1} = ( \min \sigma_i, \max \sigma_{i+1} )$ and $\min \sigma_i< \max \sigma_{i+1}$, and
    \item $  \tau_{i,i+1} =  ( \max \tau_i, \min \tau_{i+1} )$ and $\min \tau_{i+1}< \max \tau_{i}$.
\end{enumerate}
As a consequence, all strong complementary pairs are in both $\LAD$ and $\SUD$, and constitute precisely the set of facets $(\sigma,\tau)$ such that $\max_{\vec v}(\sigma) = \min_{\vec v}(\tau)$.
\end{proposition}
\begin{proof}
First, the path description of $(\sigma,\tau)$ is a straightforward observation. 
Second, since the minima of these paths are traversed from left to right, and the maxima from right to left, \cref{thm:facet-ordering} implies that strong complementary partitions are in both geometric operadic diagonals~$\LAD$ and~$\SUD$.
Third, the fact that these constitute the facets $(\sigma,\tau) \in \LAD$ or $\SUD$ satisfying $\max_{\vec v}(\sigma) = \min_{\vec v}(\tau)$ can be seen as follows.
The maximal (resp. minimal) vertex of a face $\sigma$ of the permutahedron with respect to the weak Bruhat order, is obtained by ordering the elements of each block of $\sigma$ in decreasing (resp. increasing) order. 
Thus, it is clear that the original permutation giving rise to a $\SCP$ $(\sigma,\tau)$ is the permutation $\max_{\vec v}(\sigma)=\min_{\vec v}(\tau)$, for any vector $\vec v$ inducing the weak Bruhat order.
Since both diagonals agree with this order on the vertices, we have that $\SCP$s are indeed facets of $\LAD$ and $\SUD$ with the desired property. 
The fact that these are \emph{all} the facets with this property follows from the bijection betweeen $\SCP(n)$ and the permutations of~$[n]$.
\end{proof}


%%%%%%%%%%%%%%%

\subsubsection{$\SU$ diagonals}

We recall the definiton of the original $\SU$ diagonal of \cite{SaneblidzeUmble04}, based on the description given in \cite{saneblidzeComparingDiagonalsAssociahedra2022}.
We introduce two other descriptions, the $1$-shift and $m$-shift $\SU$ diagonals, which will be shown later to be equivalent to the original one.

\begin{definition}
\label{def:subset shifts}
Let $\sigma=\sigma_1|\dots|\sigma_k$ be an ordered partition, and let 
$M_i\subsetneq \sigma_{i}$ be a non-empty subset of the block $\sigma_i$.
For $m\geq 1$, the \defn{right $m$-shift} moves the subset $M_i$, $m$ blocks to the right  
\begin{align*}
    R_{M_i}(\sigma) \eqdef \sigma_1|\dots|\sigma_i \ssm M_i|\dots | \sigma_{i+m} \cup M_i|\dots|\sigma_k
\end{align*}
while the \defn{left $m$-shift} moves it $m$ blocks to the left 
\begin{align*}
    L_{M_{i}}(\sigma) \eqdef \sigma_1|\dots|\sigma_{i-m} \cup M_{i}| \dots |\sigma_{i} \ssm M_{i}|\dots|\sigma_l \ .
\end{align*}
\end{definition}

\begin{definition}
    \label{def:movable-subsets}
    Let $(\sigma,\tau) = (\sigma_1|\dots|\sigma_k,\tau_1|\dots|\tau_l)$ be a pair of ordered partitions.
    For an integer~$m\geq 1$, a non-empty subset $M_i \subsetneq \sigma_i$ (resp.~$M_{i}\subsetneq \tau_{i}$) is \defn{$m$-block movable} if 
    \begin{enumerate}
        \item $\min \sigma_i \notin M_i$ (resp.~$\min \tau_{i} \notin M_i$), and
        \item $\min M_i> \max \sigma_{i+m}$ (resp.~$\min M_{i}> \max \tau_{i-m}$).
    \end{enumerate}
    It is \defn{$m$-path movable} if $\min M_i> \max \sigma_{i,i+m}$ (resp.~$\min M_{i}> \max \tau_{i,i-m}$).
\end{definition}

\begin{example}
Performing the $1$-shifts $R_7$ and $L_{5,6}$ on $1$-movable subsets (they are both block and path-movable) of the strong complementary pair~$(\sigma,\tau)$ of \cref{ex:strong-complementary}, one obtains the pair~$R_{7}(\sigma) \times L_{56}(\tau)$, as illustrated below.
\begin{center}
\begin{tikzpicture}[scale=.7]  
    \node (p) at (0, 0) {$13|247|5|6 \times 3|17|4|256$};
    \node (1) at (-1.5, -1) {$13$};
    \node (2) at (-1.5, -2) {$247$};
    \node (3) at (-1.5, -3) {$5$};
    \node (4) at (-1.5, -4) {$6$};
    %
    \node (5) at (1.5, -1) {$3$};
    \node (6) at (1.5, -2) {$17$};
    \node (7) at (1.5, -3) {$4$};
    \node (8) at (1.5, -4) {$256$};
    %
    \draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
    \draw[thick] (1) to [in=180, out=0, looseness=0] (6); 
    \draw[thick] (2) to [in=180, out=0, looseness=0] (6); 
    \draw[thick] (2) to [in=180, out=0, looseness=0] (7); 
    \draw[thick] (2) to [in=180, out=0, looseness=0] (8); 
    \draw[thick] (3) to [in=180, out=0, looseness=0] (8); 
    \draw[thick] (4) to [in=180, out=0, looseness=0] (8);
    %
\end{tikzpicture}
\quad
\raisebox{3em}{$\xrightarrow{R_{7} \times L_{56}}$}
\quad
\begin{tikzpicture}[scale=.7]  
\node (p) at (0, 0) {$13|24|57|6 \times 3|17|456|2$};
\node (1) at (-1.5, -1) {$13$};
\node (2) at (-1.5, -2) {$24$};
\node (3) at (-1.5, -3) {$57$};
\node (4) at (-1.5, -4) {$6$};
%
\node (5) at (1.5, -1) {$3$};
\node (6) at (1.5, -2) {$17$};
\node (7) at (1.5, -3) {$456$};
\node (8) at (1.5, -4) {$2$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (6); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (6); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (7); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (8); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (7); 
\draw[thick] (4) to [in=180, out=0, looseness=0] (7);
%
\end{tikzpicture}
\end{center}
\end{example}

We shall concentrate on two distinct families of shifts: $1$-shifts of $1$-block movable subsets of various sizes, and $m$-shifts of $m$-path movable singletons, for various $m\geq 1$,
and show that specific sequences generate the same diagonal. 

\begin{definition}
\label{def:admissible-shift-sequences}
Let $(\sigma,\tau)$ be a pair of ordered partitions. 
For~$p\geq 1$, a sequence of right shifts~$\textbf{M} = (M_{i_1},\dots,M_{i_p}) \in [n]^{p}$ is \defn{admissible of original type} if 
\begin{enumerate}
    \item we have $1\leq i_1 < i_2 < \dots < i_p \leq k-1$, and
    \item each $M_{i_j}$ is a $1$-block movable subset of $R_{M_{i_j-1}}\dots R_{M_{i_1}}(\sigma)_{i_j}$.
\end{enumerate}
A sequence of right shifts is \defn{admissible of $m$-path type} if each $M_{i_j}$ is a $m$-path movable element of $R_{M_{i_j-1}}\dots R_{M_{i_1}}(\sigma)_{i_j}$, for some $m\geq 1$.
\end{definition}

In both cases, the resulting ordered partition is denoted by $R_\mathbf{M}(\sigma) \eqdef R_{M_{i_p}}\dots R_{M_{i_1}}(\sigma)$.
Admissible sequences of left shifts are defined similarly and are denoted by $L_\mathbf{N}(\tau)$.
By convention, we declare the empty sequence of shift operators to be admissible, and to act by the identity, i.e. we have $R_{\mathbf{\varnothing}}(\sigma)  \eqdef  \sigma$ and $L_{\mathbf{\varnothing}} (\tau) \eqdef  \tau$.

\begin{definition}
\label{def:classical-SU}
The facets of the \defn{original $\SU$ diagonal} and the \defn{$m$-shift $\SU$ diagonal} are defined by the formula
    \begin{align*}
        \SUD([n]) = \bigcup_{(\sigma,\tau)} \bigcup_{\mathbf{M}, \mathbf{N}} R_\mathbf{M}(\sigma)\times L_\mathbf{N}(\tau)
    \end{align*}
where the unions are taken over all strong complementary partitions $(\sigma, \tau)$ of $[n]$, and over all admissible sequences of shifts $\textbf{M},\textbf{N}$ of the corresponding type.
\end{definition}

\begin{remark}
    Observe that the left (resp.~right) shifts acts on the right (resp.~left) ordered partition.
    In the analogous description for the diagonal $\LAD$ obtained at the end of the Section \Guillaume{[REF]}, left and right shifts act on the left and right ordered partitions, respectively. 
\end{remark}

%%%%%%%%%%%%%%%

\subsubsection{First isomorphism between $\SU$ diagonals}

First, we show that the $m$-shift $\SU$ diagonal is equivalent to the \emph{$1$-shift $\SU$ diagonal}, which given by exactly the same definition, but where only $1$-shifts are performed. 

\begin{proposition}
    \label{prop:iso-1-to-m-shift}
    The $1$-shift and $m$-shift $\SU$ diagonals coincide.
\end{proposition}

\begin{proof}
    It is clear that any admissible sequence of $1$-shifts is an admissible sequence of $m$-shifts, and thus that the facets of the $1$-shift $\SU$ diagonal are facets of the $m$-shift $\SU$ diagonal. 
    For the reverse inclusion, we need to show that any $m$-shift can be rexpressed as an admissible sequence of $1$-shift. 
    We proceed by induction.
    For the case $m=1$ there is nothing to prove.
    Let $(\sigma,\tau)$ be a pair of ordered partitions in the $m$-shift diagonal. 
    Suppose now that an element $\rho \in \sigma_i$ is $m$-movable, i.e. $\rho \neq \min \sigma_i$ and $\rho > \max \sigma_{i,i+m}$.
    Observing that it is in fact $1$-movable, since $\sigma_{i,i+m}=\sigma_{i,i+1}\sigma_{i+1,i+m}$ we have that $\max \sigma_{i,i+m}\geq \max \sigma_{i,i+1}$, allows us to apply the induction hypothesis.
\end{proof}

We will now compare the $1$-shift and original $\SU$ diagonals. 

\begin{proposition} 
\label{prop:SU-preserves-max}
Admissible sequences of shifts of the original $\SU$ diagonal conserve 
\begin{enumerate}
    \item the maximal element of any path between two blocks of the same ordered partition,
    \item the direction in which this element is traversed. 
\end{enumerate}

In particular, for a pair of ordered partitions $(R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$ obtained via an admissible sequence of shifts from a strong complementary pair~$(\sigma,\tau)$, we have that
\begin{align}
    \label{eq:max-1}
    \max R_{\mathbf{M}}(\sigma)_{i,j} = \max \sigma_{i,j} \text{ and } \max L_{\mathbf{N}}(\tau)_{i,j} = \max \tau_{i,j}
\end{align}
and consequently that
\begin{align}
    \label{eq:max-2}
    \max R_{\mathbf{M}}(\sigma)_{i,i+1} = \max \sigma_{i+1} \text{ and } \max L_{\mathbf{N}}(\tau)_{i,i+1} = \max \tau_{i}  \ .
\end{align}
\end{proposition}

\Guillaume{review terminology in the proof}

\begin{proof}
We consider the right subset shift operator; the left subset shift operator proceeds similarly.
Let us start with Point (1).
As $\SCP$s trivially meet the above conditions, we will prove the result inductively by assuming the result holds for $(R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$, and then showing that applying an admissible operator $R_{M_k}$ conserves the maximal elements of paths.
By the inductive hypothesis, we know that $\max R_{\mathbf{M}}(\sigma)_{k,k+1}= \max \sigma_{k+1}$.
As $R_{M_k}$ is an admissible operator, we know two things.
Firstly $\min M_k > \max R_{\mathbf{M}}(\sigma)_{k+1}$.
Secondly, as $k$ is greater than the maximal index used by $\mathbf{M}$, we have that $\max \sigma_{k+1} = \max R_{\mathbf{M}}(\sigma)_{k+1}$.
So combining these we know that
\begin{align}
    \label{eq:shift-subset-dominates}
    \min M_k > \max R_{\mathbf{M}}(\sigma)_{k+1} = \max \sigma_{k+1} = \max R_{\mathbf{M}}(\sigma)_{k,k+1} \ . 
\end{align}
A key consequence of this inequality is that the corresponding graph of $(R_{M_k}R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$ is a bipartite tree conditional on $(R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$ being a bipartite tree: the shift will not disconnect the graph as none of the shifted elements are in the path $R_{\mathbf{M}}(\sigma)_{k,k+1}$. 
So, it is legitimate to speak of unique paths between blocks. 

We now explicitly explore how the shift operator $R_{M_k}$ alters paths. 
Throughout the rest of this proof, we use the following shorthand: we denote by $\delta_{k,k+1} \eqdef  R_{\mathbf{M}}(\sigma)_{k,k+1}$ the path between the adjacent blocks in $(R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$, and by $\delta_{k+1,k}$ the same path reversed.
Let~$\gamma$ be any path between two blocks of $(R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$, and let~$\gamma'$ be the path between the same blocks, by indices, in $(R_{M_k}R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$. 
There are four cases to consider. 
\begin{enumerate}

    \item $\gamma$ does not contain an element of $M_k$.
    It is thus unaffected by the shift, so $\gamma' = \gamma$.

    \item $\gamma$ contains one element $m\in M_k$, i.e. it is of the form $\gamma = \alpha m \beta$, with $\alpha$ or $\beta$ possibly empty.
    Note that in virtue of \cref{eq:shift-subset-dominates}, $m$ is not in $\delta_{k,k+1}$, and $\delta_{k,k+1}$ is unaffected by the shift. 
    We assume that $m$ is incoming to $R_\mathbf{M}(\sigma)_{k}$, the case when it is outgoing is similar.
    We must have $\alpha \cap \delta_{k,k+1}=\varnothing$ since otherwise there would be an oriented loop from $R_\mathbf{M}(\sigma)_{k}$ to itself.
    For the same reason, $\beta \cap \delta_{k,k+1}$ must be connected and starting at $R_\mathbf{M}(\sigma)_{k}$.
    Then there are two cases to consider:
    \begin{enumerate}

        \item $\beta$ does not use any steps of $\delta_{k,k+1}$, in which case $\gamma' = \alpha m \delta_{k+1,k} \beta$.
        This is a path in the tree of $(R_{M_k}R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$ with no repeated steps, as such it must be the unique minimal path. 
        
        \item $\beta$ uses steps of $\delta_{k,k+1}$, in which case $\gamma' = \alpha m (\delta_{k+1,k}\ssm \beta)(\beta \ssm \delta_{k+1,k})$.
        This follows, as we know that $\beta$ must follow the path $\delta_{k,k+1}$ for some time before diverging ($\beta$ could also be a subset of $\delta_{k,k+1}$, in which case it will never diverge).
        As such, the path $(\delta_{k+1,k}\ssm \beta)$ reaches the point of divergence from $R_{\mathbf{M}}(\sigma)_{k+1}$ instead of $R_{\mathbf{M}}(\sigma)_{k}$, then the path $(\beta \ssm \delta_{k+1,k})$ completes the rest of the route unchanged.

    \end{enumerate}

    \item $\gamma$ contains two elements of $M_k$. In which case we still have $\gamma'=\gamma$ (in path elements) but $\gamma'$ will step through the $(k+1)$\ordinalst{} block instead of $\gamma$ stepping through the $k$\ordinal{} block.
    
    \item $\gamma$ contains more than two elements of $M_k$. 
    This is impossible, as $\gamma$ would not be a minimal path on a tree.

\end{enumerate}
Observe all (non-trivial or non-contradictory) paths $\gamma'$ contain $m>\min M_k$ and either some addition or deletion by $\delta_{k,k+1}$.
It thus follows from \cref{eq:shift-subset-dominates} that $\max \gamma' = \max \gamma$: in each case, the maximal element will either be $m$, or in $\alpha$, or in $\beta$.

For Point (2), we need to see that the maximal element $\max \gamma = \max \gamma'$ are traversed in the same direction.
It is immediate for cases (1), (2a) and (3); the condition is empty in the case (4).
For the case (2b) it follows from the observation that the number of steps of $\beta \cap \delta_{k,k+1}$ and $\delta_{k,k+1} \ssm \beta$ have the same parity: since $\delta_{k,k+1}$ has an even number of steps, either they both have an even number of steps, or an odd number, which completes the proof.
\end{proof}

\begin{remark}
    Note that in \cref{eq:max-1}, the maxima $\max \sigma_{i,j}$ and $\max \tau_{i,j}$ are maxima of \emph{paths}, while in \cref{eq:max-2} the maxima $\max \sigma_{i+1}$ and $\max \tau_{i}$ are maxima of \emph{blocks}.
\end{remark}

\begin{corollary} 
\label{cor:SU-shift-preserves-max}
Admissible sequences of shifts of the $m$-path $\SU$ diagonal conserve 
\begin{enumerate}
    \item the maximal element of any path between two blocks of the same ordered partition,
    \item the direction in which this element is traversed. 
\end{enumerate}
In particular, if a pair of ordered partitions $(\sigma',\tau')$ is generated from a strong complementary pair~$(\sigma,\tau)$ by $m$-path shifts, then we have
\begin{align}
    \label{eq:max-3}
    \max \sigma'_{i,i+m} = \max \sigma_{i+m} \text{ and } \max \tau'_{i,i+m} = \max \tau_{i} \ .
\end{align}
\end{corollary}

\begin{proof}
    By \cref{prop:iso-1-to-m-shift}, it suffices to treat the case of $1$-shifts. 
    By definition of the admissible $1$-path shifts, \cref{eq:shift-subset-dominates} holds and we can run the proof of \cref{prop:SU-preserves-max} \emph{mutatis mutandis}.
\end{proof}

We have now dropped the assumption that $\min M_k > \max R_{\mathbf{M}}(\sigma)_{k+1}$, and the assumption that we need to perform shifts in an increasing order; once this is done, we can generate all subset shifts by chains of singleton set shifts.

\begin{theorem}
\label{prop:iso-original-shift-diagonals}
The original and $m$-shift $\SU$ diagonals coincide.
\end{theorem}

\Guillaume{review terminology in the proof}

\begin{proof}
Since $m$-shift and $1$-shift diagonals are equivalent (\cref{prop:iso-1-to-m-shift}), it suffices to show that the $1$-shift and original $\SU$ diagonals coincide. 

We analyse the right shift operator, the case of the left shift is similar. 
First, we observe that any subset right shift $R_{M_k}(\sigma)$ can be decomposed into a series of singleton right shifts: since $\min M_k > \max \sigma_{k,k+1}$ by the proof of \cref{prop:SU-preserves-max}, we can shift the elements of $M_k$ to the right one after the other (in any order!).
This shows that any facet of the original $\SU$ diagonal is also a facet in the $1$-shift $\SU$ diagonal.

For the reverse inclusion, we proceed by induction. 
We are required to show that if we apply a right $1$-shift to $(R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$, say $(R_{\rho}R_{\mathbf{M}}(\sigma),L_{\mathbf{N}}(\tau))$, then this can be re-expressed as a well-defined subset shift operation $(R_{\mathbf{M'}}(\sigma),L_{\mathbf{N}}(\tau))$. Suppose that prior to the $1$-shift that $\rho$ lives in block $l$, then we must have
\begin{align*}
    1 \leq i_1 < \dots < i_j \leq l < i_{j+1} <\dots< i_p \leq k-1
\end{align*}
for some $j$. 
If $i_j < l$, then we have $R_{\rho}R_{\mathbf{M}}(\sigma) = R_{M_{i_p}}\dots R_{\{\rho\}_{l}}R_{M_{i_j}}\dots R_{M_{i_1}}(\sigma)$, and we are done.
Otherwise, if $i_j = l$, we set $M'_{i_j} = M_{i_j} \cup \{\rho \}$. 
It is clear that we have $R_{\rho}R_{\mathbf{M}}(\sigma) = R_{M_{i_p}}\dots R_{M'_{i_j}}\dots R_{M_{i_1}}(\sigma)$, however, we need to check that $R_{M'_{i_j}}$ is a well-defined subset operator. 
That is, we need to check that $\min M_{i_j}' > \max (R_{M_{i_{j-1}}}\dots R_{M_{i_1}}(\sigma))_{i_j+1}$.
If~$\rho > \min M_{i_j}$, then we are done since in this case $\min M_{i_j}'=\min M_{i_j}$ and $R_{M_{i_j}}$ is a well-defined subset shift operator.
Otherwise, we have $\rho=\min M_{i_j}'$. 
Since by definition subset shift operators do not move the minimal element of a block, we have that $\rho > \min R_{\mathbf{M}}(\sigma)_{i_j}= \min (R_{M_{i_{j-1}}}\dots R_{M_{i_1}}(\sigma))_{i_j}$.
Then using the induction hypothesis, \cref{prop:SU-preserves-max} shows that $\rho>\max \sigma_{i_j+1} = \max (R_{M_{i_{j-1}}}\dots R_{M_{i_1}}(\sigma))_{i_j + 1}$, where the equality follows as $i_1<\dots<i_{j-1}<i_j$. 
This proves that $R_{M'_{i_j}}$ is well-defined, completing the inductive proof.
\end{proof}

%%%%%%%%%%%%%%%

\subsubsection{Inversions}

In this section, we combinatorially characterise inversions of the $(I,J)$ $\SU$ diagonal as crossings in the bipartite tree.
We will use this as a tool to prove that the $m$-shift and the $(I,J)$ diagonal coincide in the next section.
Later, we will discuss in \cref{sec:Shift-lattice}, how the inversions are compatible with a shift lattice structure.

\begin{definition}
Let $(\sigma,\tau)$ be a pair of ordered partitions of $[n]$, we say that $(x,y)$, where $x<y$, is an \emph{inversion} if $x$ appears before $y$ in $\sigma$ and $y$ appears before $x$ in $\tau$. 
\end{definition}

\begin{remark}
    If $(\sigma,\tau)$ is a pair of permutations, the inversions of $(\sigma,\tau)$ are the classical inversions of $\tau$ which are not inversions of $\sigma$. 
    In particular, if $\sigma$ is the identity permutation, then the inversions of $(\sigma,\tau)$ coincide with the classical inversions of $\tau$. 
\end{remark}

\begin{proposition}
\label{p:crossings}
The set of inversions of a $(I,J)$ diagonal facet is in bijection with its set of edge crossings. 
Moreover, the set $\SCP$ is equal to the set of facets with no crossings.
\end{proposition}

\begin{proof}
For the first part of the statement, it is clear that every inversion gives rise to a crossing. 
For the converse, one needs to check that an anti-inversion, where $y$ appears before $x$ in $\sigma$ and $x$ appears before $y$ in $\tau$, cannot occur in a facet of $\SUD$; this follows immediately from the $(I,J)$-conditions for $|I|=|J|=1$. 
The second part of the statement follows from the fact that facets of the diagonal with no crossings are in bijection with permutations.
As explained above, from a partition one obtains a strong complementary pair, which is in $\SUD$. 
In the other way around, given a strong complementary pair, one can read-off the partition in the associated tree, which has no crossings, by a vertical down-slice of edges, see \cref{ex:strong-complementary}.
\end{proof}

We say that an edge crossing is an \emph{adjacent crossing} if the two crossing elements are in adjacent blocks (i.e. $\sigma_i|\sigma_{i+1}$ or $\tau_i|\tau_{i+1}$).

\begin{lemma}
    \label{lem:adjacent-crossing}
A facet $(\sigma,\tau)$ of the $(I,J)$ diagonal has a crossing if and only if it has an adjacent crossing.
\end{lemma}

\begin{proof}
An adjacent crossing is clearly a crossing. In the other direction, suppose there is a crossing between an element of $\sigma_i$ and an element of $\sigma_j$. If $\sigma_i$ and $\sigma_j$ are not adjacent, then the 'triangle' produced by the crossing elements encloses other $\sigma_k$ such that $i<k<j$, and this produces other crossings. We may repeat this process until end an adjacent crossing.
\end{proof}



%%%%%%%%%%%%%%%

\subsubsection{Second isomorphism: $m$-shift and $(I,J)$ diagonals coincide}\label{sec:Iso m-shifts to IJ}

We now aim at showing that the $m$-shift and the $\SU$ diagonal defined via $(I,J)$ conditions coincide (\cref{prop:unique-operad}).
We first identify that left (right) shift operators are natural inverses to right (resp.~left) shift operators.

\begin{definition} 
\label{def:inverse-shift}
Let $(\sigma,\tau)$ be a pair of ordered partitions. 
Let $\rho \in \sigma_{i+m}$ be such that $\rho>\max \sigma_{i,i+m}$.
The \emph{inverse right $m$-shift} $R_\rho^{-1}$ is the left $m$-shift which sends $\rho$ to the block $\sigma_i$. 
Inverse left $m$-shift operators are defined similarly. 
\end{definition}
It is clear that the inverse shift operators are indeed inverse to shift operators, i.e. that we have $R_\rho R_\rho^{-1}= R_\rho^{-1} R_\rho= \id$.
Then we observe that the $(I,J)$ diagonal is closed with respect to shifts.

\begin{proposition} 
    \label{lem:IJ-closed-under-shifts}
    Let $(\sigma,\tau)$ be a pair of facets in the $(I,J)$ diagonal.
    Then,
    \begin{enumerate}
        \item any pair of ordered partitions obtained by applying an $m$-shift to $(\sigma,\tau)$ is also in the $(I,J)$ diagonal,
        \item applying an $m$-shift strictly increases the number of inversions of $(\sigma,\tau)$.
    \end{enumerate}
    Dually, the $(I,J)$ diagonal is also closed under inverse shifts, and applying an inverse $m$-shift strictly decreases the number of inversions of $(\sigma,\tau)$.
\end{proposition}

\begin{proof}
    We consider just the right shift for the primary statement, the left shift and dual result proceeds similarly. 
    By \cref{cor:SU-shift-preserves-max}, we have that the maxima of paths between consecutive vertices in $(R_{\rho}(\sigma),\tau)$ are the same as the ones in $(\sigma,\tau)$, and are moreover traversed in the same direction.
    Thus, all maxima of paths in $(R_{\rho}(\sigma),\tau)$ are traversed from right to left, and hence by \cref{thm:facets}, we have that $(R_{\rho}(\sigma),\tau)$ is in the $(I,J)$ diagonal, which proves Point (1).
    For Point (2), observe that the $(I,J)$ conditions for $|I|=|J|=1$ imply that $\rho$ must appear before $\min \sigma_i$ in $\tau$; as a result, after the $m$-shift these two edges will create a new intersection.
\end{proof}

\begin{lemma}
\label{lem:inverse-to-SCP}
Any facet $(\sigma,\tau)$ of the $(I,J)$ diagonal is mapped to a strong complementary pair by a finite number of inverse $m$-shifts.
\end{lemma}

\begin{proof}
Since the number of inversions of a pair of ordered partitions $(\sigma,\tau)$ in the $(I,J)$ diagonal is finite, we will only be able to apply a finite chain of inverse shift operators to it before no further operations are available. 
It thus remains to show that for any pair $(\sigma,\tau)$ which is not a strong complementary one, performing an inverse $m$-shift is possible. 
We consider the following cases, illustrated in \cref{ex:proof-inverse-shift}.
\begin{enumerate}
    \item All adjacent blocks are connected by paths of length $2$.
    \item There exist adjacent blocks which are connected by a path of length $2k$ for $k>1$.
    \begin{enumerate}
        \item The maximal step of this path is not the last step.
        \item The maximal step of this path is the last step.
        \begin{enumerate}
            \item The $\tau$ block containing the maximal step is not the greatest block.
            \item The $\tau$ block containing the maximal step is the greatest block.
        \end{enumerate}
    \end{enumerate}
\end{enumerate}
In Case $(1)$, if $(\sigma,\tau)$ is not a $\SCP$ then it must have a crossing, and hence an adjacent crossing by \cref{lem:adjacent-crossing}. 
This adjacent crossing is of the following form (we illustrate the case where the crossing happens on the left, the case when it happens on the right is similar) 
\begin{center}
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_i$};
\node (2) at (-1.5, -2) {$\sigma_{i+1}$};
%
\node (4) at (1.5, -1) {$\tau_j$};
\node (5) at (1.5, -2) {$\tau_{k}$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\node (6) at (0.9, -0.7) {$\rho$};
\node (7) at (0, -2.3) {$b$};
\node (8) at (-0.9, -0.7) {$c$};
\end{tikzpicture}
\quad
\raisebox{1em}{$\xrightarrow{R^{-1}_{\rho}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_i \sqcup \rho$};
\node (2) at (-1.5, -2) {$\sigma_{i+1}\setminus \rho$};
%
\node (4) at (1.5, -1) {$\tau_j$};
\node (5) at (1.5, -2) {$\tau_{k}$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\end{center}
By definition of the $(I,J)$ diagonal, the fact that $\tau_j < \tau_k$ implies that $\rho > b$, and the fact that $\sigma_i < \sigma_{i+1}$ implies that $b>c$.
Thus, we have $\rho > \max \sigma_{i,i+1}$ which implies $R_\rho^{-1}$ is well-defined.

In Case $(2a)$, consider the two adjacent blocks say $\sigma_i|\sigma_{i+1}$ (the $\tau$ case is similar), let $\rho \eqdef \max \sigma_{i,i+1}$, and let $m\geq 1$ be such that $\rho$ steps into $\sigma_{i+1+m}$. 
Since $\max \sigma_{i,i+1+m} = \max \sigma_{i,i+1}= \rho$ the definition of the $(I,J)$ diagonal implies that $\sigma_{i,i+1+m}$ comes after $\sigma_{i}$, and by assumption after $\sigma_{i+1}$. 
Thus, we know that $m > 1$, and using dashed lines to denote paths of length $\geq 1$ we have,
\begin{center}
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_i$};
\node (2) at (-1.5, -2) {$\sigma_{i+1}$};
\node (3) at (-1.5, -3) {$\sigma_{i+1+m}$};
%
\node (4) at (1.5, -1) {$\hphantom{.}$};
\node (5) at (1.5, -2) {$\hphantom{.}$};
%
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick,dashed] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (3) to [in=180, out=0, looseness=0] (4);
\draw[thick,dashed] (3) to [in=180, out=0, looseness=0] (5);
%
\node (6) at (1.3, -1.3) {$\rho$};
\end{tikzpicture}
$\xrightarrow{R_\rho^{-1}}$
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_i$};
\node (2) at (-1.5, -2) {$\sigma_{i+1}\sqcup \rho$};
\node (3) at (-1.5, -3) {$\sigma_{i+1+m}\setminus \rho$};
%
\node (4) at (1.5, -1) {$\hphantom{.}$};
\node (5) at (1.5, -2) {$\hphantom{.}$};
%
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick,dashed] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick,dashed] (3) to [in=180, out=0, looseness=0] (5);
%
\node (6) at (1.3, -1.3) {$\rho$};
\end{tikzpicture}
\end{center}
As $\rho=\max \sigma_{i,i+1} > \max\sigma_{i+1+m,i+1}$ the inverse $m$-shift operation is well-defined.

In the Case $(2bi)$, there exists $j,m>0$ such that $\tau_{j-m}$ is the block of $\tau$ which contains the maximal element $\rho$, and $\tau_j$ is any greater block on the path from $\sigma_i$ to $\sigma_{i+1}$. 
Then we may apply the following inverse $m$-shift operator.
\begin{center}
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_i$};
\node (2) at (-1.5, -2) {$\sigma_{i+1}$};
\node (3) at (-1.5, -3) {$\sigma_{i+1+m}$};
%
\node (4) at (1.5, -1) {$\tau_{j-m}$};
\node (5) at (1.5, -2) {$\tau_j$};
%
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick,dashed] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (3) to [in=180, out=0, looseness=0] (4);
%
\node (6) at (0.3, -2.8) {$\rho$};
\end{tikzpicture}
$\xrightarrow{L_\rho^{-1}}$
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_i$};
\node (2) at (-1.5, -2) {$\sigma_{i+1}$};
\node (3) at (-1.5, -3) {$\sigma_{i+1+m}$};
%
\node (4) at (1.5, -1) {$\tau_{j-m}\setminus \rho$};
\node (5) at (1.5, -2) {$\tau_j \sqcup \rho$};
%
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick,dashed] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
%
\node (6) at (0.3, -2.8) {$\rho$};
\end{tikzpicture}
\end{center}

There remains to be treated Case $(2bii)$.
We consider the path $\sigma_{i,i+1} \eqdef (i_1,j_1,i_2,...,i_{k},\rho)$ to be of length $2k$, $k>1$. 
We denote by $\tau_j$ the block of $\tau$ containing the maximal step $\rho$ of this path, which by hypothesis is the last block of $\tau$. 
Let $\sigma_{i-n}$ be the last block of $\sigma$ which is attained by the path $\sigma_{i,i+1}$ before $\sigma_{i+1}$. 
We must have $n>1$, since $\rho$ is the last step and $\sigma_i|\sigma_{i+1}$ are adjacent blocks.
The situation can be pictured as on the left.
\begin{center}
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_{i-n}$};
\node (2) at (-1.5, -2) {$\sigma_{i}$};
\node (3) at (-1.5, -3) {$\sigma_{i+1}$};
%
\node (4) at (1.5, -1) {$\tau_{j-m}$};
\node (5) at (1.5, -2) {$\tau_j$};
%
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick,dashed] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
%
\node (6) at  (0.8, -2.5) {$\rho$};
\node (7) at  (0.8, -1.5) {$i_k$};
\end{tikzpicture}
$\xrightarrow{L_{\rho'}^{-1}}$
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$\sigma_{i-n}$};
\node (2) at (-1.5, -2) {$\sigma_{i}$};
\node (3) at (-1.5, -3) {$\sigma_{i+1}$};
%
\node (4) at (1.5, -1) {$\tau_{j-m}\setminus \rho'$};
\node (5) at (1.5, -2) {$\tau_j \sqcup \rho'$};
%
\draw[thick,dashed] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick,dashed] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
%
\node (6) at  (0.45, -2.5) {$\rho$};
\node (7) at  (0.45, -1.5) {$i_k$};
\end{tikzpicture}
\end{center}
Now let $\rho' \eqdef \max\sigma_{i,i-n}$ be the maximum of the path $\sigma_{i,i-n}=(i_1,j_1,i_2,...,i_{k-1},j_{k-1})$, and let $\tau_{j-m}$, $m\geq 1$ be the block of $\tau$ containing $\rho'$.
We want to show that an inverse left $m$-shift can bring $\rho'$ back to $\tau_j$.  
We just need to show that $\rho' > i_k$, since the path $\tau_{j-m,j}$ is a subset of the path $\sigma_{i,i+1}$. 
This would imply that both $\rho' > \max \tau_{j-m,j}$ and $\rho' > i_k \geq \min \tau_j$, and thus that an inverse left shift $L_{\rho'}^{-1}$ can be performed.
To see that this is indeed the case, it suffices to look at the last steps $$\tau_l \overset{j_{k-1}}{\longrightarrow} \sigma_{i-n} \overset{i_{k}}{\longrightarrow} \tau_j \overset{\rho}{\longrightarrow} \sigma_{i+1}$$ of the path $\sigma_{i,i+1}$. 
By the definition of the $(I,J)$ diagonal, the fact that $\tau_l < \tau_j$ implies that $j_{k-1} > i_k$, and thus that $\rho' > i_k$, which finishes the proof. 
\end{proof}

\begin{example}
\label{ex:proof-inverse-shift}
Here is an example of each of the cases in the prior proof. We display $1$, $2.a$, $2.b.i$ and, $2.b.ii$ respectively, reading the diagrams  from top-left to bottom-right. 

\begin{center}
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$1$};
\node (2) at (-1.5, -2) {$23$};
%
\node (4) at (1.5, -1) {$3$};
\node (5) at (1.5, -2) {$12$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\end{tikzpicture}
\quad
\raisebox{1em}{$\xrightarrow{R^{-1}_{3}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$13$};
\node (2) at (-1.5, -2) {$2$};
%
\node (4) at (1.5, -1) {$3$};
\node (5) at (1.5, -2) {$12$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
,
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$1$};
\node (2) at (-1.5, -2) {$2$};
\node (3) at (-1.5, -3) {$34$};
%
\node (4) at (1.5, -1) {$14$};
\node (5) at (1.5, -2) {$23$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (4);
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\quad
\raisebox{1.5em}{$\xrightarrow{R^{-1}_{4}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$1$};
\node (2) at (-1.5, -2) {$24$};
\node (3) at (-1.5, -3) {$3$};
%
\node (4) at (1.5, -1) {$14$};
\node (5) at (1.5, -2) {$23$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\end{center}
\begin{center}
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$13$};
\node (2) at (-1.5, -2) {$2$};
\node (3) at (-1.5, -3) {$4$};
%
\node (4) at (1.5, -1) {$34$};
\node (5) at (1.5, -2) {$12$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (4);
\end{tikzpicture}
\quad
\raisebox{1.5em}{$\xrightarrow{L^{-1}_{4}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$13$};
\node (2) at (-1.5, -2) {$2$};
\node (3) at (-1.5, -3) {$4$};
%
\node (4) at (1.5, -1) {$3$};
\node (5) at (1.5, -2) {$124$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
,
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$12$};
\node (2) at (-1.5, -2) {$3$};
\node (3) at (-1.5, -3) {$4$};
%
\node (4) at (1.5, -1) {$23$};
\node (5) at (1.5, -2) {$14$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\quad
\raisebox{1.5em}{$\xrightarrow{L^{-1}_{3}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$12$};
\node (2) at (-1.5, -2) {$3$};
\node (3) at (-1.5, -3) {$4$};
%
\node (4) at (1.5, -1) {$2$};
\node (5) at (1.5, -2) {$134$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (3) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\end{center}
Note, as we have chosen minimal illustrative examples, each inverse $m$-shift is an inverse $1$-shift, and after each shift we obtain a $SCP$. 
This is not typically the case.

\end{example}

\begin{theorem} 
\label{prop:iso-shift-IJ-diagonals}
    The $m$-shift and $(I,J)$ diagonals coincide.
\end{theorem}

\begin{proof}

    We first note that $\SCP$s are known elements of both the $m$-shift and $(I,J)$ diagonals (\cref{lem:SCP-path-desc}).
    The proof that every facet of $m$-shift $\SUD$ is in $\SUD$ follows from the closure of $\SUD$ under the shift operator (\cref{lem:IJ-closed-under-shifts}).
    The proof that every facet of $\SUD$ is in shift $\SUD$ follows from the closure of $\SUD$ under the inverse shift operator (\cref{lem:IJ-closed-under-shifts}) and the fact that every facet is sent to a $\SCP$ after a finite number of inverse shifts(\cref{lem:inverse-to-SCP}).
    In particular, as shift operators are the inverse of the inverse shift operators, for any given $\SUD$ facet, this provides a $\SCP$ and a sequence of shifts to form it, showing it is a shift $\SUD$ facet.
\end{proof}

We are now in position to conclude.

\begin{theorem}
    \label{thm:recover-SU}
    The original and $(I,J)$ $\SU$ diagonals coincide.
\end{theorem}

\begin{proof}
    \cref{prop:iso-original-shift-diagonals} says that the original and $m$-shift diagonals are the same, and \cref{prop:iso-shift-IJ-diagonals} says that the $m$-shift and $(I,J)$ diagonal coincide.
    Thus, all the different definitions agree with the geometrically defined $\SUD$. 
\end{proof}

%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%

\subsection{Shifts Under the Face Poset Isomorphism}

Previously in \cref{thm:bijection-operadic-diagonals}, we constructed an isomorphism of face-posets $sr\times sr:\LAD\to\SUD$.
In addition, we showed in \cref{rem:Alternate Isomorphism}, that $t(r\times r):\LAD\to\SUD$ is also an isomorphism.
In this section, we use this second isomorphism to directly translate the known shift results for the $\SU$ diagonal to the $\LA$ diagonal. 
We first explicitly define all $\LA$ shift diagonals before establishing this connection.
We note that in the $\LA$ diagonal, for $(\sigma,\tau)\in \LAD$, the left shift operators $L_\mathbf{N}$ will act on $\sigma$ and the right shift operators $R_\mathbf{M}$ will act on $\tau$, the opposite of $\SU$.
The indexing of the following definition compared to \cref{def:movable-subsets} accounts for this fact.

\begin{definition}[$\LA$ moveable subsets]
\label{def:LAD movable-subsets}
Let $(\sigma,\tau) = (\sigma_1|\dots|\sigma_k,\tau_1|\dots|\tau_l)$ be a pair of ordered partitions.
For an integer $m\geq 1$, a non-empty subset $M_i \subset \sigma_i$ (resp.~$M_{i}\subset \tau_{i}$) is \emph{$1$-block movable} if 
\begin{enumerate}
    \item $\max \sigma_i \notin M_i$ (resp.~$\max \tau_{i} \notin M_i$), and
    \item $\max M_i < \max \sigma_{i-1}$ (resp.~$\min M_{i} < \max \tau_{i+1}$).
\end{enumerate}
It is \emph{$m$-path movable} if it satisfies $(1)$ above and if
\begin{enumerate}
    \item[(2')] $\max M_i < \min \sigma_{i,i-m}$ (resp.~$\max M_{i} < \min \tau_{i,i+m}$).
\end{enumerate}
\end{definition}
With our new definitions of moveable subsets, to obtain the correct definition of an admissible sequence of shifts, simply replace $\sigma$ with $\tau$ in \cref{def:admissible-shift-sequences}. 
Similar definitions hold for admissible sequence of left shifts.

\begin{definition}[$\LA$ diagonals]
    \label{def:shift-LA}
   The facets of 
   \begin{enumerate}[(a)]
    \item the \emph{1-subset-shift $\LA$ diagonal},
    \item the \emph{$1$-shift $\LA$ diagonal},
    \item the \emph{$m$-shift $\LA$ diagonal}
   \end{enumerate}
   are defined by the formula
    \begin{align*}
        \LAD([n]) = \bigcup_{(\sigma,\tau)} \bigcup_{\mathbf{M}, \mathbf{N}} L_\mathbf{N}(\sigma)\times R_\mathbf{M}(\tau)
    \end{align*}
    where the unions are taken over all strong complementary partitions $(\sigma, \tau)$ of $[n]$, and over all admissible sequences of shifts $\textbf{M},\textbf{N}$ of the corresponding type.
\end{definition}

We again stress that compared to the $\SU$ diagonals (\cref{def:classical-SU}), the left shift operators now act on the left ordered partition, and the right shift operators on the right ordered partition.

\begin{proposition} \label{prop:trr is an isomorphism of shifts}
Let $(\sigma,\tau) \in \LAD$.
For each type of $\LA$ shift, let $\textbf{M},\textbf{N}$ be admissible sequences of this type, then 
\begin{align*}
    t(r,r)(L_\mathbf{N}(\sigma), R_\mathbf{M}(\tau)) = (R_{r\mathbf{M}}(r\tau), L_{r\mathbf{N}}(r\sigma))
\end{align*}
where $r\mathbf{M} \eqdef (rM_{i_1},...,rM_{i_p})$ and $r\mathbf{N}$ (defined similarly) are admissible sequences of $\SU$ shifts of the same type.
\end{proposition}
\begin{proof}
As reversing the elements then shifting them is the same as shifting the elements then reversing them,
it is clear that the equality holds if $r\mathbf{M},r\mathbf{N}$ are admissible sequences of $\SU$ shifts.
As such, we must simply verify the admissibility, and given the equivalence of the various shift definitions, we just do this for $1$-path shifts.
For an integer $m\geq 1$, a non-empty subset $M_i \subset \sigma_i$ (resp.~$M_{i}\subset \tau_{i}$) is $LA$ $1$-block moveable if
\begin{enumerate}
    \item 
    \begin{enumerate}
        \item $\max \sigma_i \notin M_i$ implies that $ \min r\sigma_i \not \in r M_i$
        \item (resp.~$\max \tau_{i} \notin M_i$ implies that  $ \min r\tau_{i} \not \in r M_i$)
    \end{enumerate}
    \item 
    \begin{enumerate}
        \item $\max M_i < \max \sigma_{i-1}$  implies that $\min r M_i > \min r \sigma_{i+1}$
        \item (resp.~$\min M_{i} < \max \tau_{i+1}$ implies that $\max rM_{i} > \min r\tau_{i+1}$)
    \end{enumerate}
\end{enumerate}
It is \emph{$m$-path movable} if it satisfies $(1)$ above and if
\begin{enumerate}
    \item[(2')] 
    \begin{enumerate}
        \item $\max M_i < \min \sigma_{i,i-m}$ implies that $\min r M_i > \max r \sigma_{i,i-m}$
        \item (resp.~$\max M_{i} < \min \tau_{i,i+m}$ implies that $\min r M_{i} > \max r\tau_{i,i+m}$)
    \end{enumerate}
\end{enumerate}
The reader may directly verify from \cref{def:movable-subsets}, that each $rM_i \in r\sigma_i$ meets the conditions of a moveable subset 
if it is interpreted as being in a block of the right partition ($\tau$ in the notation of the definition).
So, if $\mathbf{M} = (M_{i_1},...,M_{i_p})$, define $r(\mathbf{M}) \eqdef (rM_{i_1},...,rM_{i_p})$, and from the prior it is clear this is an admissible sequence of $SU$ shifts.

\end{proof}

\begin{remark}
The isomorphism $rs\times rs:\LAD \to \SUD$ identified in \cref{thm:bijection-operadic-diagonals}, also sends shifts operators to shift operators, but it sends left shift operators to right shift operators and vice versa.
The $\LA^{op}$ and $\SU^{op}$ diagonals also admit obvious dual shift descriptions.
\end{remark}

We now explore in example how the isomorphism $t(r\times r)$ translates the shift operators.

\begin{example} \label{ex:shift translation by theta}
The $\SCP$s $(\sigma,\tau)  \eqdef  5|17|4|236 \times 57|146|3|2$, and $(\sigma',\tau')  \eqdef  13|247|5|6 \times 3|17|4|156$, are in bijection through $t(r\times r)$. Graphically, this bijection has a clear symmetry,

\begin{center}
\begin{tikzpicture}[scale=.7]  
\node (1) at (-1.5, -1) {$5$};
\node (2) at (-1.5, -2) {$17$};
\node (3) at (-1.5, -3) {$4$};
\node (4) at (-1.5, -4) {$236$};
%
\node (5) at (1.5, -1) {$57$};
\node (6) at (1.5, -2) {$146$};
\node (7) at (1.5, -3) {$3$};
\node (8) at (1.5, -4) {$2$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0](5); 
\draw[thick] (2) to [in=180, out=0, looseness=0](5); 
\draw[thick] (2) to [in=180, out=0, looseness=0](6); 
\draw[thick] (3) to [in=180, out=0, looseness=0](6); 
\draw[thick] (4) to [in=180, out=0, looseness=0](6); 
\draw[thick] (4) to [in=180, out=0, looseness=0](7); 
\draw[thick] (4) to [in=180, out=0, looseness=0](8);
%
\end{tikzpicture}
$\xrightarrow{t(r\times r)}$
\begin{tikzpicture}[scale=.7]  
\node (1) at (-1.5, -1) {$13$};
\node (2) at (-1.5, -2) {$247$};
\node (3) at (-1.5, -3) {$5$};
\node (4) at (-1.5, -4) {$6$};
%
\node (5) at (1.5, -1) {$3$};
\node (6) at (1.5, -2) {$17$};
\node (7) at (1.5, -3) {$4$};
\node (8) at (1.5, -4) {$256$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0](5); 
\draw[thick] (2) to [in=180, out=0, looseness=0](5); 
\draw[thick] (2) to [in=180, out=0, looseness=0](6); 
\draw[thick] (3) to [in=180, out=0, looseness=0](6); 
\draw[thick] (4) to [in=180, out=0, looseness=0](6); 
\draw[thick] (4) to [in=180, out=0, looseness=0](7); 
\draw[thick] (4) to [in=180, out=0, looseness=0](8);
%
\end{tikzpicture}
\end{center}
We now illustrate all possible $\LA$ $1$-shifts of the left $\SCP$ and all possible $\SU$ $1$-shifts of the right $\SCP$. 
We first display how the $\LA$ left shifts act on $\sigma$, and the $\SU$ left shifts act on $\tau'$.
The $LA$ shifts have been drawn so that the leftmost arrow shifts the smallest element, and the $SU$ shifts have been drawn so that the leftmost arrow shifts the largest element.
As such, the face poset isomorphism $t(r\times r)$ directly translates one diagram to the other.
The specific element being shifted can be inferred by the source and target of the arrow.
\begin{center}
{\small
\begin{tikzcd}
& 5|17|4|236 \arrow[ld] \arrow[d] \arrow[rd]\\
15|7|4|236 \arrow[rd] \arrow[d]&
5|17|24|36  \arrow[dl] \arrow[rd]&
5|17|34|26 \arrow[d] \arrow[dl]\\
15|7|24|36 \arrow[dr]&
15|7|34|26  \arrow[d]&
5|17|234|6  \arrow[dl]\\
&15|7|234|6 
\end{tikzcd}
\begin{tikzcd}
& 3|17|4|256 \arrow[ld] \arrow[d] \arrow[rd]\\
37|1|4|256 \arrow[rd] \arrow[d]&
3|17|46|25  \arrow[dl] \arrow[rd]&
3|17|44|26 \arrow[d] \arrow[dl]\\
37|1|46|25 \arrow[dr]&
36|17|44|26  \arrow[d]&
3|17|456|2  \arrow[dl]\\
&37|1|456|2
\end{tikzcd}
}
\end{center}
The possible $\LAD$ right shifts (acting on $\tau$)  are,
\begin{center}
\begin{tikzcd}
\sigma \times 57|146|3|2 \arrow[r,"\rho=1"] & \sigma \times 57|46|13|2 \arrow[r,"\rho=1"] & \sigma \times 57|46|3|12
\end{tikzcd}
\end{center}
The possible $\SUD$ right shifts (acting on $\sigma'$) are,
\begin{center}
\begin{tikzcd}
13|247|5|6 \times \tau' \arrow[r,"\rho=7"] & 13|24|57|6 \arrow[r,"\rho=7"] \times \tau' & 13|24|5|67 \times \tau'
\end{tikzcd}
\end{center}
No other shifts are possible, observe for instance that we cannot perform the $\LAD$ left shift $15|7|234|6 \times 57|46|13|2 \xrightarrow{\rho=2} 15|27|34|6 \times 57|46|13|2$ as the minimal path connecting $234$ and $7$ contains $1$ which is smaller than $2$ (see \cref{ex:ECbijection}).
We will show in the next section, that these recovered diagrams are the Hasse diagrams of lattices.
\end{example}


\begin{example}
It was observed in \cite{LA21} that the $LA$ and $SU$ diagonals coincided up until $n=3$, however due to their dual shift structure they generate the non-$SCP$ pairs in a dual fashion.
In particular, the two center faces of the hexagon (\cref{fig:diagonalPermutahedron2}) are generated by 
\begin{center}

\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$13$};
\node (2) at (-1.5, -2) {$2$};
%
\node (4) at (1.5, -1) {$3$};
\node (5) at (1.5, -2) {$12$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\quad
\raisebox{1em}{$\xrightarrow{R^{SU}_{3}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$1$};
\node (2) at (-1.5, -2) {$23$};
%
\node (4) at (1.5, -1) {$3$};
\node (5) at (1.5, -2) {$12$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\end{tikzpicture}
,\quad \quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$12$};
\node (2) at (-1.5, -2) {$3$};
%
\node (4) at (1.5, -1) {$2$};
\node (5) at (1.5, -2) {$13$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\quad
\raisebox{1em}{$\xrightarrow{L^{SU}_{3}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$12$};
\node (2) at (-1.5, -2) {$3$};
%
\node (4) at (1.5, -1) {$23$};
\node (5) at (1.5, -2) {$1$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}

\end{center}
and
\begin{center}
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$1$};
\node (2) at (-1.5, -2) {$23$};
%
\node (4) at (1.5, -1) {$13$};
\node (5) at (1.5, -2) {$2$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\quad
\raisebox{1em}{$\xrightarrow{R^{LA}_{1}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$1$};
\node (2) at (-1.5, -2) {$23$};
%
\node (4) at (1.5, -1) {$3$};
\node (5) at (1.5, -2) {$12$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (5); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
,\quad \quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$2$};
\node (2) at (-1.5, -2) {$13$};
%
\node (4) at (1.5, -1) {$23$};
\node (5) at (1.5, -2) {$1$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (2) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}
\quad
\raisebox{1em}{$\xrightarrow{L^{LA}_{1}}$}
\quad
\begin{tikzpicture}[scale=.6]  
\node (1) at (-1.5, -1) {$12$};
\node (2) at (-1.5, -2) {$3$};
%
\node (4) at (1.5, -1) {$23$};
\node (5) at (1.5, -2) {$1$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0] (4); 
\draw[thick] (2) to [in=180, out=0, looseness=0] (4);
\draw[thick] (1) to [in=180, out=0, looseness=0] (5);
\end{tikzpicture}

\end{center}
where we have aligned each element, of each diagonal, vertically with its dual element.

\end{example}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Shift Lattice Structure}\label{sec:Shift-lattice}

In this section, we show that the 1-shifts of each diagonal admit a simple lattice structure, that is to say, each $\SCP$ is the minimal element of a lattice isomorphic to a product of chains, where the partial order is given by shifts.
We will discuss how this lattice is compatible with a generalised weak Bruhat order, and latter we will use the lattice structure to relate the cubical and shift definitions of the $\SUD$ diagonal (\cref{sec:Cubical}).

\begin{definition}
Let $(\sigma,\tau) \in \LAD$ or $\SUD$. For $\rho \in [n]$, let $r_\rho$ (or $l_\rho$) be the maximal value of $m$ such that $R_\rho$ (resp.~$L_\rho$) is a well-defined $m$-shift of $(\sigma,\tau)$, or $0$ if there are no such $m$-shifts.

\end{definition}

The maximal $m$-shift for an element $\rho$ of a $SCP$ can be explicitly calculated as follows. 

\begin{proposition}\label{prop:maximal m-shift formulae}
Let $(\sigma,\tau)$ be a SCP. Then the  maximal $\LAD$ shifts admit the following formulae.
\begin{itemize}
    \item For $\rho \in \sigma_i$, $l_\rho = \# $ consecutive blocks to the left of $i$ whose minima is larger than $\rho$.
    \item For $\rho \in \tau_i$, $r_\rho = \# $ consecutive blocks to the right of $i$ whose minima is larger than $\rho$.
\end{itemize}
The maximal $\SUD$ shifts admit the following formulae.
\begin{itemize}
    \item For $\rho \in \sigma_i$, $r_\rho = \# $ consecutive blocks to the right of $i$ whose maxima is smaller than $\rho$.
    \item For $\rho \in \tau_i$, $l_\rho = \# $ consecutive blocks to the left of $i$ whose maxima is smaller than $\rho$.
\end{itemize}
\end{proposition}

\begin{proof}
We show the formula holds in $\SUD$ for $r_\rho$, the other cases are similar. 
As $(\sigma,\tau)$ is a SCP, $\max \sigma_{k,k+1} = \max \sigma_{k+1}$. 
From the equivalence of $1$-shifts and $m$-shifts there exists an $m$-shift of $\rho$ from $\sigma_i$, if, and only if, there exists a sequence of $m$ consecutive $1$-shifts each satisfying $\rho > \max \sigma_{j,j+1}=\max \sigma_{j+1}$.
These iterated one shifts will be well-defined until the first failure at $j=r_\rho+1$.
\end{proof}

\begin{lemma}[$m$-shifts commute] \label{lem:m-shifts commute}
Let $(\sigma,\tau) \in \LAD$ or $\SUD$.
If either side of the following equations are  well-defined sequences of $m_1,m_2$ shift operators, then the other side is a well-defined sequence of $m_2,m_1$ shift operators, and their outputs are equal.
\begin{align*}
    R_{\rho} L_{\rho'}(\sigma,\tau) = L_{\rho'} R_{\rho}(\sigma,\tau), \quad R_{\rho} R_{\rho'}(\sigma,\tau) = R_{\rho'} R_{\rho}(\sigma,\tau), \quad L_{\rho} L_{\rho'}(\sigma,\tau) = L_{\rho'} L_{\rho}(\sigma,\tau)
\end{align*}
\end{lemma}
\begin{proof}
A $\SUD$ ($\LAD$) $m$-shift is defined when $\rho$ is greater (smaller) than the (minimal) maximal element of the connecting path.
From \cref{cor:SU-shift-preserves-max}, we know $m$-shifts conserve the maximal (minimal) elements of paths and their directions.
As such, we can commute any two shift operators.
\end{proof}

\begin{proposition} \label{prop:shift lattice}
Let $(\sigma,\tau)$ be an $\SCP$, and define
\begin{align*}
    L^{\LA}(\sigma,\tau) \eqdef \bigcup_{\mathbf{M}, \mathbf{N}} L_\mathbf{N}(\sigma)\times R_\mathbf{M}(\tau), \quad L^{\SU}(\sigma,\tau) \eqdef \bigcup_{\mathbf{M}, \mathbf{N}} R_\mathbf{M}(\sigma)\times L_\mathbf{N}(\tau)
\end{align*}
where the union is taken over all admissible sequences of $1$-shifts $\textbf{M},\textbf{N}$, for each diagonal.
Then each set is isomorphic as a lattice to a product of chains
\begin{align*}
    L^{\LA}(\sigma,\tau) \cong \prod_{\rho \in [n]} [l_\rho]
    \times \prod_{\rho \in [n]} [r_\rho], \quad L^{\SU}(\sigma,\tau) \cong \prod_{\rho \in [n]} [r_\rho]
    \times \prod_{\rho \in [n]} [l_\rho]
\end{align*}
where the maximal shifts $r_\rho,l_\rho$, are calculated with respect to $(\sigma,\tau)$, for each diagonal.
\end{proposition}

\begin{proof}

We identify $(0,0,...,0)$ with the SCP $(\sigma,\tau)$ and every other element $(r_1,...,r_n,l_1,...l_n)$, with 
$R^{r_n}_{n}...R^{r_{1}}_{1}
L^{l_n}_{n}...L^{l_{1}}_{1}(\sigma,\tau)$.
Given \cref{lem:m-shifts commute}, it is straightforward to confirm that the join (meet) of any two elements is given by their element wise maximum (minimum).
In particular, the maximal element of the lattice is given by shifting each element of $(\sigma,\tau)$ by its maximal shift.
\end{proof}

The Hasse diagram of the lattice corresponds to $1$-shifts, and we can step backwards in the diagram by applying inverse $1$-shifts.
Furthermore, we saw in \cref{lem:IJ-closed-under-shifts}, that shifts increase the number of inversions, and inverse shifts decrease the number of inversions.
As such, this lattice structure is compatible with ordering these pairs of ordered partitions by their inversions sets, i.e. it is compatible with a generalised Bruhat order.\Guillaume{@Vincent, est-ce que ca coincide avec l'ordre de Ronco?}
For a clear example of the Hasse diagram we direct the reader back to
\cref{ex:shift translation by theta}.

Given our previously obtained formulae for the number of elements in the diagonal (\cref{subsec:enumerationDiagonalPermutahedra}), and the results of this section we obtain the following statistics on permutations.
\begin{corollary}
Let $l_\rho^{\LA}(\sigma)$ be the result of calculating $l_\rho$ for the $\LA$ diagonal for the the $\SCP$ resulting from the permutation $\sigma$, and similarly for variants of this notation. Then,
\begin{align*}
    2(n+1)^{n-2} = \sum_{\sigma \in \mathbb{S}_n} \prod_{\rho=1}^n (l_\rho^{\LA}(\sigma)+1)(r_\rho^{\LA}(\sigma)+1) 
    = \sum_{\sigma \in \mathbb{S}_n} \prod_{\rho=1}^n (r_\rho^{\SU}(\sigma)+1)(l_\rho^{\SU}(\sigma)+1)
\end{align*}
Let $P_{k_1,k_2}^n\subseteq \mathbb{S}_n$ be those permutations with $k_1/k_2$ ascending/descending runs ($k_1+k_2=n-1$). Then,
\begin{align*}
    n \binom{n-1}{k_1} (n-k_1)^{k_1-1} (n-k_2)^{k_2-1} &= \sum_{\sigma \in P_{k_1,k_2}^n} \prod_{\rho=1}^n (l_\rho^{\LA}(\sigma)+1)(r_\rho^{\LA}(\sigma)+1)\\
    &= \sum_{\sigma \in P_{k_1,k_2}^n} \prod_{\rho=1}^n (r_\rho^{\SU}(\sigma)+1)(l_\rho^{\SU}(\sigma)+1)
\end{align*}
\end{corollary}
\begin{proof}
This follows directly from \cref{coro:enumerationDiagonalPermutahedra}, with the observation that shifts conserve the number of blocks, and hence the dimensions of the faces.
\end{proof}


\begin{remark}
Whilst each $l_\rho^{\SU}(\sigma)$ and similar can be calculated from the $\SCP$ they can also be reformulated directly in terms of the permutation.
For instance $l_\rho^{\SU}(\sigma)$ is the number of consecutive ascending runs, to the right of the ascending run containing $\rho$, whose maximal element is smaller than $\rho$.
\end{remark}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Matrix Description}


We first recall the alternate descriptions of the $\SUD$ diagonal from \cite{SaneblidzeUmble04} and\cite{saneblidzeComparingDiagonalsAssociahedra2022}, that we would like to transfer to $\LAD$. 
In particular, we explicitly relate the matrix and cubical descriptions of the $\SUD$ diagonal, to the description of the $\SUD$ diagonal given in \cref{def:classical-SU}.
\\\\
We previously saw that SCPs and permutations are in bijection (\cref{def:strong-complementary-pairs}). 
There is also a third equivalent way to encode this data, the \emph{step matrices} of Definition 6 of \cite{SaneblidzeUmble04}.
Informally, given a permutation $\sigma$, start in the bottom left corner of a matrix, and write increasing sequences vertically, and decreasing sequences horizontally. All other entries are $0$. Here is an example permutation, its SCP, and its step matrix, with all $0$ entries omitted.
{\small
\begin{center}
\raisebox{3em}{$6524713$}
$\quad \quad$
\begin{tikzpicture}[scale=.7]  
\node (1) at (-1.5, -1) {$256$};
\node (2) at (-1.5, -2) {$4$};
\node (3) at (-1.5, -3) {$17$};
\node (4) at (-1.5, -4) {$3$};
%
\node (5) at (1.5, -1) {$6$};
\node (6) at (1.5, -2) {$5$};
\node (7) at (1.5, -3) {$247$};
\node (8) at (1.5, -4) {$13$};
%
\draw[thick] (1) to [in=180, out=0, looseness=0](5);
\draw[thick] (1) to [in=180, out=0, looseness=0](6); 
\draw[thick] (1) to [in=180, out=0, looseness=0](7); 
\draw[thick] (2) to [in=180, out=0, looseness=0](7); 
\draw[thick] (3) to [in=180, out=0, looseness=0](7); 
\draw[thick] (3) to [in=180, out=0, looseness=0](8); 
\draw[thick] (4) to [in=180, out=0, looseness=0](8);
\end{tikzpicture}
$\quad \quad$
\raisebox{3em}{
$
\begin{blockarray}{ccccc}
  & \sigma_1 & \sigma_2 & \sigma_3 & \sigma_4  \\
\begin{block}{c[cccc]}
\tau_4 &   &   & 1 & 3 \\
\tau_3 & 2 & 4 & 7  &   \\
\tau_2 & 5 &   &   &   \\
\tau_1 & 6 &   &   &   \\
\end{block}
\end{blockarray}
$
}
\end{center}
}
Given a $l\times k$ matrix $A$ with all non-zero entries drawn without replacement from $[n]$, let $\sigma_i(A)$ denote the non-zero entries of the $i$\ordinal{} column, and $\tau_j(A)$ the non-zero entries of the $(l-j+1)$\ordinalst{} row. 
For example, we labelled the rows and columns of the prior step matrix in this fashion.
With this identification, we can apply \cref{def:movable-subsets}, to identify $1$-block moveable subsets of the matrix $M$, and we can apply \cref{def:admissible-shift-sequences}, to identify sequences of shifts which are admissible of original type.
We now define a suitable subset shift action on these matrices.
\begin{definition} [SU Matrix Subset Shifts]
A non-empty set of elements of a matrix $M_i \subset \sigma_i(A)$ (resp.~$M_{i}\subset \tau_{i}(A)$) is $1$-block right (left) movable if
\begin{enumerate}
    \item $\min \sigma_i(A) \notin M_i$ (resp.~$\min \tau_{i}(A) \notin M_i$), and
    \item $\min M_i> \max \sigma_{i+1}(A)$ (resp.~$\min M_{i}> \max \tau_{i-1}(A)$).
\end{enumerate}
The right matrix subset shift operator $R_{M_i}$ shifts the elements of $M_i$ right one column, i.e. if $A_{k,l} \in M_i$ then $(R_{M_i}A)_{k,l+1} = A_{k,l}$, replacing only elements of value $0$, and leaving $0$ elements in their wake.
The left matrix subset shift operator $L_{M_i}$ shifts the elements of $M_i$ down one row, replacing only elements of value $0$, and leaving $0$ elements in their wake.
\end{definition}
\begin{proposition}
The matrix subset shift operators are well-defined.
\end{proposition}
\begin{proof}
We verify the claim that the matrix shift operators never replace non-zero elements.
It is straightforward to show that this is true when a shift operator is applied to a $SCP$.
From here we proceed inductively.
We assume that all prior shift operators have been well-defined, and we then check that applying another valid sequential shift operator is also well-defined.
Suppose that $M_i$ is $1$-block moveable, and that $R_{M_i}$ is not well-defined as it tries to move a value $m$ into a non-zero matrix entry $n$.
Then, $n$ must have been placed into that column by a prior left shift operator $L_{N_j}$, and consequently $n>\min N_j > \max \tau_{j-1}> m$.
However, $n\in \sigma_{i+1}$ so $\max \sigma_{i+1}>n>m>\min M_i $ implies that $M_i$ is not $1$-block moveable, a contradiction.
\end{proof}


\begin{definition}[Definition 7. \cite{SaneblidzeUmble04}]
We define the set of \emph{configuration matrices} $\mathcal{C}$, to be those matrices  corresponding to $SCP$s and those generated by admissible sequences of shifts.
\end{definition}

\begin{proposition}[\cite{SaneblidzeUmble04}]
The set of $\SU$ configuration matrices are in bijection with the facets of $\SUD$.
\end{proposition}
\begin{proof}
As configuration matrices have the same recursive description as the original $\SUD$ diagonal (\cref{def:classical-SU}), and $SCP$s are in bijection with step matrices, the result immediately follows.
\end{proof}

As a result of the face poset isomorphism $t(r\times r)$ we also immediately obtain a matrix description of the $\LA$ diagonal.
\begin{definition}[LA Matrix Subset Shifts]
A non-empty set of elements of a matrix $M_i \subset \sigma_i(A)$ (resp.~$M_{i}\subset \tau_{i}(A)$) is $1$-block right (left) movable if
\begin{enumerate}
    \item $\max \sigma_i(A) \notin M_i$ (resp.~$\max \tau_{i}(A) \notin M_i$), and
    \item $\max M_i < \min \sigma_{i-1}(A)$ (resp.~$\max M_{i} < \min \tau_{i+1}(A)$).
\end{enumerate}
The right matrix subset shift operator $R_{M_i}$ shifts the elements of $M_i$ left one column, replacing only elements of value $0$, and leaving $0$ elements in their wake.
The left matrix subset shift operator $L_{M_i}$ shifts the elements of $M_i$ up one row, replacing only elements of value $0$, and leaving $0$ elements in their wake.
\end{definition}
Defining the set of configuration matrices $\mathcal{C}$, to be those matrices  corresponding to $SCP$s and those generated by admissible sequences of $\LA$ shifts, then yields the expected result.
\begin{proposition}
The set of $\LA$ configuration matrices are in bijection with the facets of $\LAD$.
\end{proposition}

\begin{example}
The first row of the following diagram contains a sequence of admissible $\SU$ subset shifts applied to the matrix encoding of the SCP $256|4|17|3\times 6|5|147|13$ (see \cref{ex:shift translation by theta} for other encodings of shifts acting on this element). 
The second row is the image of these shifts under isomorphism $t(r\times r)$.
\begin{center}
{\footnotesize
\begin{tikzcd}[column sep = 0.5cm]
\begin{bmatrix}
  &   & 1 & 3 \\
2 & 4 & 7 &   \\
5 &   &   &   \\
6 &   &   &   \\
\end{bmatrix}
\arrow[r,"R^{SU}_{5,6}"]
&
\begin{bmatrix}
  &   & 1 & 3 \\
2 & 4 & 7 &   \\
  & 5 &   &   \\
  & 6 &   &   \\
\end{bmatrix}
\arrow[r,"L^{SU}_7"]
&
\begin{bmatrix}
  &   & 1 & 3 \\
2 & 4 &   &   \\
  & 5 & 7 &   \\
  & 6 &   &   \\
\end{bmatrix}
\arrow[r,"R^{SU}_7"]
&
\begin{bmatrix}
  &   & 1 & 3 \\
2 & 4 &   &   \\
  & 5 &   & 7 \\
  & 6 &   &   \\
\end{bmatrix}
\\
\begin{bmatrix}
  &   &   & 2 \\
  &   &   & 3 \\
  & 1 & 4 & 6 \\
5 & 7 &   &   \\
\end{bmatrix}
\arrow[r,"R^{LA}_{2,3}"]
&
\begin{bmatrix}
  &   & 2 &   \\
  &   & 3 &   \\
  & 1 & 4 & 6 \\
5 & 7 &   &   \\
\end{bmatrix}
\arrow[r,"L^{LA}_1"]
&
\begin{bmatrix}
  &   & 2 &   \\
  & 1 & 3 &   \\
  &   & 4 & 6 \\
5 & 7 &   &   \\
\end{bmatrix}
\arrow[r,"R^{LA}_1"]
&
\begin{bmatrix}
  &   & 2 &   \\
1 &   & 3 &   \\
  &   & 4 & 6 \\
5 & 7 &   &   \\
\end{bmatrix}
\end{tikzcd}
}
\end{center}


\end{example}

\subsection{Cubical Description}\label{sec:Cubical}

In \cite{SaneblidzeUmble04}, Saneblidze and Umble identified that they could use a particular subdivision of the $(n-1)$-cube by $P_{n}$, to construct cellular operadic diagonals of polytopes which admit cellular projections from the permutahedra.
In their work, they briefly outline this cubical construction before using it to induce their subset shift description (\cref{def:classical-SU}).
In this section, we recall their cubical definition of the $\SU$ diagonal and explicitly relate it to their shift description, using a new proof that exploits the lattice description of the diagonal (\cref{sec:Shift-lattice}).
We finally transfer the cubical formulae to the $\LA$ diagonal via isomorphism.


\subsubsection{The Cubical Diagonal}

\begin{definition}
We define \defn{$\divcube{n}$} to be an inductive subdivision of the $(n-1)$-cube by $P_n$.
Let $\divcube{0}$ be the $0$-cube (a point), trivially subdivided by the sole element $1$ of $P_1$.
Then, assuming we have constructed $\divcube{n-1}$, we construct $\divcube{n}$ by weaving $n$ through every face of $\sigma = \sigma_1|...|\sigma_k \in P_{n-1}$, using an interval description.
For $0<j<k$ we define
$n_j := |\sigma_{k-j+1}\cup...\cup \sigma_k|$, $I_j := [1 - \frac{1}{2^{n_j}}, 1 - \frac{1}{2^{n_{j+1}}}]$, and boundary cases $I_0:= [0,1 - \frac{1}{2^{n_1}}]$, $I_k:= [1 - \frac{1}{2^{n_k}},1]$,
This defines a partition of the interval $[0,1]$, which we denote $I := I_0 \cup ... \cup I_k$.
The weaving of $n$ through $\sigma$ is then defined as follows,
\begin{align} \label{eq:SU cube inductive def}
    \sigma \times I \mapsto 
    \begin{cases}
        \sigma_1|...|\sigma_k| n, &I = [0, 0]\\
        \sigma_1|...|\sigma_j \cup n|...|\sigma_k, &I = I_j\\
        \sigma_1|...|\sigma_j|n|\sigma_{j+1}|...|\sigma_k, &I = I_j \cap I_{j+1}\\
        n|\sigma_1|...|\sigma_k, &I = [1, 1]
    \end{cases}
\end{align}
\end{definition}

Here is an illustration of this subdivision for the first few-dimensions.
We indicate, in bold, the embedding $\divcube{n-1}\hookrightarrow \divcube{n}$ that occurs when $I=[0, 0]$. 
We emphasise, that a consequence of the construction is that each dimension of $\divcube{n}$ corresponds to shifting a particular element of $[n]\setminus \{1\}$.

\begin{center}
{\small
\begin{tikzcd}[sep=0.3cm]
\mathbf{1|2} \arrow[r,dash, "12"] & 2|1
\end{tikzcd}
}
$\hookrightarrow$
{\small
\begin{tikzcd}[column sep=0.3cm]
3|1|2 \arrow[r,dash, "3|12"] \arrow[d,dash, "13|2"]& 3|2|1 \arrow[d,dash, "13|2"]\\
1|3|2 \arrow[d,dash, "1|23"] & 2|3|1 \arrow[d,dash, "2|13"]\\
\mathbf{1|2|3} \arrow[r,dash,thick, "12|3"] & \mathbf{2|1|3}
\end{tikzcd}
}
$\hookrightarrow$
{\small
\begin{tikzcd}[sep=0.15cm,scale=0.8]
& 4|2|1|3 \arrow[rr,dash] \arrow[dd,dash,dotted] \arrow[dl,dash] & & 4|2|3|1 \arrow [dd, dash,dotted] \arrow[rr,dash] & & 4|3|2|1 \arrow[dd,dash] \arrow[dl,dash]\\
4|1|2|3 \arrow [rr,dash] \arrow [dd,dash] & & 4|1|3|2 \arrow[rr,dash] \arrow[dd,dash] & & 4|3|1|2 \arrow[dd,dash]  & \\
& 2|4|1|3 \arrow [rr,dash,dotted] \arrow[dd,dash,dotted]  & & 2|4|3|1  \arrow[dd,dash,dotted] & & 3|4|2|1 \arrow [dl,dash] \arrow[dd,dash]\\
1|4|2|3 \arrow [rr,dash] \arrow [dd,dash]& & 1|4|3|2  \arrow[dd,dash] & & 3|4|1|2 \arrow[dd,dash]\\
& 2|1|4|3 \arrow[dd,dash,dotted] \arrow[dl,dash,dotted] & & 2|3|4|1 \arrow [dd, dash,dotted] \arrow [rr, dash,dotted] & & 3|2|4|1 \arrow[dd,dash] \\
1|2|4|3 \arrow [dd,dash] & & 1|3|4|2 \arrow[rr,dash] \arrow[dd,dash] & & 3|1|4|2 \arrow[dd,dash] & \\
& \mathbf{2|1|3|4} \arrow [rr,dash,dotted] \arrow [dl,dash,dotted] & & \mathbf{2|3|1|4} \arrow [rr,dash,dotted] & & \mathbf{3|2|1|4} \arrow [dl,dash] \\
\mathbf{1|2|3|4} \arrow [rr,dash] & & \mathbf{1|3|2|4} \arrow [rr,dash] & & \mathbf{3|1|2|4} \\
\end{tikzcd}
}
\end{center}
We have only labelled the vertices of $\divcube{3}$, but its edges, facets and outer face are all identified with the expected elements of $P_{4}$.
The cubical formula for the diagonal is constructed through maximal pairings of $k$-subdivision cubes of $\divcube{n}$, which we now define, and prove the existence of.

\begin{definition} \label{def:Subdivisions}
Let $e$ be a cell in $P_{n}$ with dimension $|e|$, a \defn{$k$-subdivision cube of $e$} is a set of $k$-faces whose union is a $k$-subcube of $e$ in $\divcube{n}$, for some $k\leq |e|$.
\end{definition}

As a trivial example, every $k$-face of $P_n$ is a $k$-subdivision cube of every cell which contains it, for instance itself, and the outer face of $P_n$.
Less trivial examples are provided in \cref{ex:subdivision cubes}.

\begin{lemma}\label{lem:k-subdiv cubes have max/min k faces}
A $k$-subdivision cube of $e$ has unique maximal and minimal vertices under the weak Bruhat order.
\end{lemma}

\begin{proof}
If a $k$-subdivision cube had multiple maximal/minimal vertices, then it could not be a union of $k$-faces in the shape of a $k$-cube.
\end{proof}

We thus define the unique maximal (minimal) $k$-face of a $k$-subdivision cube to be the unique $k$-face adjacent to the maximal (minimal) vertex.

\begin{lemma}\label{lem:Unique maximal subdivcubes}
Let $e$ be a cell of $P_n$ and $\sigma$ a $k$-face of the cell. Then there exists a unique maximal $k$-subdivision cube of $e$ whose maximal (minimal) $k$-face is $\sigma$.
\end{lemma}

\begin{proof}
We first prove the result for $1$-subdivision cubes, i.e. lines, then proceed inductively from there.
We only treat the case for maximal $k$-face $\sigma$, the minimal case proceeds similarly.
Given the inductive description of $\divcube{n}$ (\cref{eq:SU cube inductive def}), the maximal vertex $v$ and the face $\sigma$ specifies the element $\rho$ being shifted by the line.
Furthermore, from this inductive description, the line can be grown, with respect to inclusion of $1$-faces, by shifting $\rho$ to the right (left) as far as possible.
Note, that $\rho$ will eventually be blocked by either reaching the boundary of the enveloping cell $e$, or being blocked by a larger element.
So there is a unique maximal $1$-subdivision line with maximal $1$-face $\sigma$.
\\\\
Now consider the set of $(k+1)$-subdivision cubes with maximal $(k+1)$-face $\sigma$.
The face $\sigma$ is trivially one such cube.
Consider the $k+1$ elements of $[n]$, which correspond to dimensions spanned by $\sigma$, and let $\rho$ be the largest such element.
Let $\sigma_L$ be the $1$-face, with maximal vertex $v$, whose only non-trivial dimension corresponds to $\rho$.
Then, there exists a unique maximal $1$-subdivision line with maximal $1$-face $\sigma_L$, which we denote $L$.
In particular, if $v'$ is the minimal vertex of $L$, and $v_\rho, v'_\rho$ are the indices of $\rho$ in $v,v'$, then under the inductive description of $\divcube{n-1}$ (\cref{eq:SU cube inductive def}) the line $L$ corresponds to $\sigma_L \times I'$ where $I':=[1-\frac{1}{2^{n-v'_\rho}},1-\frac{1}{2^{n-v_\rho}}]$.
\\\\
Let $\sigma_C$ be the $k$-face which results from taking $\sigma$, and setting the dimension corresponding to $\rho$ to $1-\frac{1}{2^{n-v_\rho}}$.
This corresponds to shifting $\rho$ from its current block, into a singleton block above it, so consequently the maximal vertex of $\sigma_C$ is also $v$.
Thus, by the inductive assumption, there exists a unique maximal $k$-subdivision cube with maximal $k$-face $\sigma_C$, which we denote $C$.
The product $L\times C$ is then clearly a $(k+1)$-cube with maximal vertex $v$.
In addition, every $k$-face in $C$ must have its corresponding $\rho$ coordinate be $1-\frac{1}{2^{n-v_\rho}}$.
Consequently, as $\rho$ was the maximal element corresponding to dimensions of the $(k+1)$-cube, and the line $\sigma_L \times I'$ was well-defined, we know the product $C\times L$ will correspond to the union of intervals $\sqcup_{f\in C}f \times I'$ (\cref{eq:SU cube inductive def}), which spans the $(k+1)$-cube with $(k+1)$-faces resulting from shifting $\rho$ through $C$.
Thus, $L\times C$ is a $(k+1)$-subdivision cube of $e$.
Finally, $L\times C$ must be maximal under inclusion.
If there was a larger $(k+1)$-subdivision cube $C'$ enveloping $L\times C$, then one of its projections would be a $1,k$ subdivision cube enveloping $L$ or $C$, which contradicts the assumption they were maximal.

\end{proof}

We now define our maximal pairing of subdivision cubes.

\begin{definition} [\cite{saneblidzeComparingDiagonalsAssociahedra2022}]\label{def:subdiv pairs}
Let $e$ be a cell of $P_n$ and let $\mathcal{V}_e$ be the set of vertices in $e$.
For a given vertex $v \in \mathcal{V}_e$, we define \defn{$\subdivpairsev$} to be the set of all pairs $(C^v,C_v)$ of $k_1,k_2$ subdivision cubes of $e$ such that
\begin{enumerate}
    \item $C^v$ is a $k_1$-subdivision cube of $e$ with maximal vertex $v$.
    \item $C_v$ is a $k_2$-subdivision cube of $e$ with minimal vertex $v$.
    \item $k_1+k_2 = |e|$
\end{enumerate}
If $e$ is the outer face of $P_n$, then we denote the set of pairs \defn{$\subdivpairsv$}.
Finally, we define \defn{$\maxsubdivpairsev$} (and \defn{$\maxsubdivpairsv$}) to be the unique maximal pair, with respect to inclusion, of $\subdivpairsev$ (and $\subdivpairsv$).
\end{definition}
We note that the uniqueness of the maximal pair is a corollary of \cref{lem:Unique maximal subdivcubes}.

\begin{example}\label{ex:subdivision cubes}
We clarify the previous section with examples that are visually verifiable from the diagram of $I_3$ below.
The following sets of faces are all $k$-subdivision cubes of the outer face of $P_4$, (for varying $k$),
\begin{align*}
    \{1234\},\quad \{1|234\},\quad \{1|234, 14|23\},\quad \{1|3|24,1|34|2\}.
\end{align*}
Note, that $\{1|3|24,1|34|2\}$ is also a $1$-subdivision cube of the cell $1|234$.
The following three sets of faces are not subdivision cubes of $e$,
\begin{align*}
    \{134|2, 14|23\},\quad \{1|234, 134|2, 14|23\}, \quad \{1|2|34,1|23|4\}
\end{align*}
For $v = \blue{\mathbf{4|3|1|2}}$, $k_1=2$, $k_2=1$, the only $k_2$-subdivision cube with minimal vertex $v$ is $4|3|12$, and the three $k_1$-subdivision cubes with maximal vertex $v$ are
\begin{align*}
    \{134|2\}, \{13|24, 134|2\}, \{ 1|234, 13|24, 14|23, 134|2\}
\end{align*}

This defines $\subdivpairsv$, and thus $\maxsubdivpairsv=\{ 1|234, 13|24, 14|23, 134|2\} \times \{4|3|12\}$.
In the next section, we will show that $\maxsubdivpairsv$ is generated by all shifts of the strong complementary pair corresponding to $v$.
For now, we verify this claim on this example.
The $\SCP$ corresponding to $v$ is $(\sigma,\tau) = (\blue{\mathbf{134|2}},\blue{\mathbf{4|3|12}} )$.
The ordered partition $\sigma$ admits three distinct rights shifts, $\red{\mathbf{13|24}}$, $\red{\mathbf{14|23}}$, $\red{\mathbf{1|234}}$, and $\tau$ admits no left shifts.

\begin{center}
{\small
\begin{tikzcd}[sep=0.1cm, scale=0.3]
& 4|2|1|3 \arrow[rr,dash] \arrow[dd,dash,dotted] \arrow[dl,dash] & & 4|2|3|1 \arrow [dd, dash,dotted] \arrow[rr,dash] & & 4|3|2|1 \arrow[dd,dash] \arrow[dl,dash, near end, "\mathbf{\blue{4|3|12}}"']\\
4|1|2|3 \arrow [rr,dash] \arrow [dd,dash] & & 4|1|3|2 \arrow[rr,dash] \arrow[dd,dash] & & \mathbf{\blue{4|3|1|2}} \arrow[dd,dash]  & \\
& \red{\mathbf{14|23}} \arrow [rr,dash,dotted] \arrow[dd,dash,dotted]  & & 2|4|3|1  \arrow[dd,dash,dotted] & & 3|4|2|1 \arrow [dl,dash] \arrow[dd,dash]\\
1|4|2|3 \arrow [rr,dash] \arrow [dd,dash]& & 1|4|3|2  \arrow[dd,dash] \arrow[rr, phantom, "\blue{\mathbf{134|2}}" description,crossing over] & & 3|4|1|2 \arrow[dd,dash]\\
& 2|1|4|3 \arrow[dd,dash,dotted] \arrow[dl,dash,dotted] & & 2|3|4|1 \arrow [dd, dash,dotted] \arrow [rr, dash,dotted] & & 3|2|4|1 \arrow[dd,dash] \\
1|2|4|3 \arrow [dd,dash] \arrow[rr, phantom, "\red{\mathbf{1|234}}" description,crossing over] & & 1|3|4|2 \arrow[rr,dash] \arrow[dd,dash] & & 3|1|4|2 \arrow[dd,dash] & \\
& 2|1|3|4 \arrow [rr,dash,dotted] \arrow [dl,dash,dotted] & & \red{\mathbf{13|24}} \arrow [rr,dash,dotted] & & 3|2|1|4 \arrow [dl,dash] \\
1|2|3|4 \arrow [rr,dash] & & 1|3|2|4 \arrow [rr,dash] & & 3|1|2|4 \\
\end{tikzcd}
}
\end{center}

\end{example}

\begin{proposition}[Formula (1) of \cite{saneblidzeComparingDiagonalsAssociahedra2022}]
The following formula defines a cellular operadic diagonal of the permutahedra. 
For every cell $e$ of the permutahedra,
\begin{align*}
    \triangle(e) = \bigcup_{v \in V_e} \maxsubdivpairsev
\end{align*}
where $V_e$ is the set of vertices of the cell.
In particular, its value on outer faces is 
\begin{align*}
    \triangle([n]) = \bigcup_{v \in P_n} \maxsubdivpairsv
\end{align*}
and as a result of it being an operadic diagonal, it extends to all other faces.
\end{proposition}
\begin{proof}
By construction, the diagonal is cellular (\cref{def:cellularDiagonal}).
This follows, as the image of the map is a union of dim $P$-faces of $P\times P$.
Furthermore, for every vertex $v$ in $P$, not only is $(v,v) \in \maxsubdivpairsv$, but $\maxsubdivpairsv$ is also contractible to $(v,v)$.
The diagonal is also operadic (\cref{def:operadic diagonal}), as the presence of vertices $v$ in a cell $e=A_1|...|A_k$ are conserved under the isomorphism $\Theta$. Consequently, \Kurt{Something like this... Or can cop out and just say operadic as a result of LA being operadic...}
\begin{align*}
    \triangle(A_1|...|A_k) = \bigcup_{v \in V_{A_1|...|A_k}} \maxsubdivpairsev \cong \bigcup_{v \in V_{A_1\times ... \times A_k}} \maxsubdivpairsev
    = \triangle(A_1)\times...\times \triangle(A_k)
\end{align*}

\end{proof}

\subsubsection{The Cubical-Shift Equivalence}

We now specialise the results of the prior section to $k$-subdivision cubes of the outer face of $\divcube{n}$.
Under this specialisation, we recover the $\SU$ shift lattice structure identified in \cref{sec:Shift-lattice}.
Our first observation relating subdivision cubes to shifts is,

\begin{proposition}\label{prop:ev properties}
The set of pairs $\subdivpairsv$ satisfies the following properties,
\begin{enumerate}
    \item The strong complementary pair $(\sigma,\tau)$ corresponding to $v$ is in $\subdivpairsv$.
    \item All pairs in $\subdivpairsv$ have the same dimensions $k_1$ and $k_2$.
    \item For all $(C^v,C_v) \in \subdivpairsv$, the unique maximal $k_1$-face of $C^v$ is $\sigma$, the unique minimal $k_2$-face of $C_v$ is $\tau$.
\end{enumerate}
\end{proposition}
\begin{proof}
Strong complementary partitions correspond to those pairs of faces $(F,G)$ of the permutahedra such that the maximal vertex of $F$ is the minimal vertex of $G$ (\cref{def:strong-complementary-pairs}).
That is to say, $(\sigma,\tau)$ is the unique pair of faces of the permutahedra that meet at vertex $v$.
Consequently, not only must $(1)$ be true, but every pair of subdivision cubes $(C^v,C_v) \in \subdivpairsv$ must have $\sigma$ as its maximal $k_1$-face, and $\tau$ as its minimal $k_2$-face, giving $(2)$ and $(3)$.
\end{proof}

\begin{lemma}
Let $C$ be a maximal $k$-subdivision cube with  maximal (minimal) $k$-face $\sigma$ ($\tau$).
Then $C = \bigcup_{\mathbf{M}} R_\mathbf{M}(\sigma)$ (resp. $C=\bigcup_{\mathbf{N}} L_\mathbf{M}(\tau)$), where $\mathbf{M}$ and $\mathbf{N}$ are all admissible sequence of $\SU$ shifts.

\end{lemma}
\begin{proof}
Compared to \cref{lem:Unique maximal subdivcubes}, we now have the additional assumption that $C$ is a $k$-subdivision cell of the outer face.
This means we don't have to worry about generic boundaries imposed by generic enveloping cells $e$.
We prove the result inductively from lines, and consider just the case of the maximal $k$-face $\sigma$, as the minimal $k$-face $\tau$ proceeds similarly.
If $L$ is a maximal $1$-subdivision cube with maximal $1$-face $\sigma$, then its faces are generated by $\bigcup_{i=0}^{r_\rho} R_\rho^i(\sigma)$
Where $r_\rho$ is calculated using the maximal shift-indices of \cref{prop:maximal m-shift formulae}.
This is because the maximal $1$-face $\sigma$ uniquely determines the element $\rho$ being shifted, and the inductive description of $\divcube{n-1}$ (\cref{eq:SU cube inductive def}) coincides with the $\SU$ lattice description (\cref{sec:Shift-lattice}) given the maximal face $\sigma$ can be interpreted as the left ordered partition of an $\SCP$.
Note in both formulae, $\rho$ is simply right shifted until it reaches the final block, or is blocked by a larger element.
\\\\
Let $C^\sigma$ be the unique maximal $(k+1)$-subdivision cube with maximal $(k+1)$-face $\sigma$.
Given the proof of \cref{lem:Unique maximal subdivcubes}, we know $C^\sigma = L\times C$, i.e. the $(k+1)$-subdivision cube is a product of a line corresponding to $\rho$, and a $k$-cube $C$ corresponding to all other elements.
We know that the line $L$, with maximal $1$-face $\sigma_L$ satisfies $L=\bigcup_{i=0}^{r_\rho} R_\rho^i(\sigma_L)$, and we make the inductive assumption that $C$ with maximal $k$-face $\sigma_C$ satisfies $C = \bigcup_{\mathbf{M}}R_\mathbf{M}(\sigma_C)$, where $\mathbf{M}$ is the set of all admissible right shifts of $\sigma_C$.
\\\\
Let $\rho'$ be an element shifted in $C$, then its maximal right shift height in $C$ is the same as its maximal right shift height in $L\times C$.
This follows from the inductive description of $\divcube{n-1}$ (\cref{eq:SU cube inductive def}).
In particular, every $k$-face in $C$ has $\rho$ in a singleton block, and as $\rho$ is larger than all other elements it blocks all other shifts.
If $\rho$ is in the $i$th block of $\sigma_C$, then $\sigma$ is obtained from $\sigma_C$ by merging the $i$\ordinal{} and $(i+1)$\ordinalst{} blocks.
It is thus straightforward to see the maximal right shifts $r_{\rho'}$ are conserved, when moving from $C$ to $C\times L$.
\\\\
Finally, we know from the inductive description of $\divcube{n-1}$ (\cref{eq:SU cube inductive def}), and the proof of \cref{lem:Unique maximal subdivcubes}, that to construct the $(k+1)$-faces of $L\times C$ we weave $\rho$ through the $k$-faces of $C$ (stepping through the interval $[1-\frac{1}{2^{n-v_\rho}},1-\frac{1}{2^{n-v'_\rho}}]$).
Every $k$-face in $C$ has $\rho$ in a fixed singleton set (specified by $1-\frac{1}{2^{n-v_\rho}}$), and every $k$ face on the opposite side of $C\times L$ has $\rho$ in another fixed singleton set (specified by $1-\frac{1}{2^{n-v'_\rho}}$).
Given \cref{eq:SU cube inductive def}, this final singleton block is either the last block, or is followed by a block containing an element larger than $\rho$.
If we translate this observation back to the $(k+1)$-faces that are adjacent to the boundaries of the interval, then this corresponds to an equivalent calculation of $r_\rho$ for $\sigma$.
This thus proves that $L\times C = \bigcup_{i=0}^{r_\rho}\bigcup_{\mathbf{M}}R^i_\rho R_\mathbf{M}(\sigma) = \bigcup_{\mathbf{M'}}R_\mathbf{M'}(\sigma)$, where $M'$ must be the set of admissible sequence of right shifts of $\sigma$, given the lattice description of the diagonal \cref{prop:shift lattice}.

\end{proof}

Applying this lemma to pairs of maximal subdivision cubes yields,

\begin{corollary}\label{prop:Maximal Subdiv Pairs and Shifts}
[Formula (3) of \cite{saneblidzeComparingDiagonalsAssociahedra2022}]
Let $v$ be a vertex of $P_n$, then
\begin{align*}
    \maxsubdivpairsv = \bigcup_{\mathbf{M},\mathbf{N}} R_\mathbf{M}(\sigma) \times L_{\mathbf{N}}(\tau)
\end{align*}
where $\mathbf{M},\mathbf{N}$ are admissible sequences of $SU$ shifts.
\end{corollary}

Which consequently provides an alternate cubical formula for the $\SU$ diagonal,

\begin{proposition}[Formula (1) and (3) \cite{saneblidzeComparingDiagonalsAssociahedra2022}]
\begin{align*}
    \SUD([n]) = \bigcup_{v \in P_n} \maxsubdivpairsv
\end{align*}
\end{proposition}

\subsubsection{LA Cubical Description}

The $\LA$ diagonal also admits a cubical description, which we may quickly induce by isomorphism.

\begin{definition}
We define \defn{$\divcube{n}^{\LA}$} to be an inductive subdivision of the $(n-1)$-cube by $P_n$.
Let $\divcube{0}^{\LA}$ be the $0$-cube (a point), trivially subdivided by the sole element $1$ of $P_1$.
Then, assuming we have constructed $\divcube{n-1}^{\LA}$, we construct $\divcube{n}^{\LA}$ by weaving $1$ through every face of $\sigma = \sigma_1|...|\sigma_k \in P_{n-1}$, using an interval description.
For $0<j<k$ we define
$n_j := |\sigma_{k-j+1}\cup...\cup \sigma_k|$, $I_j := [1 - \frac{1}{2^{n_j}}, 1 - \frac{1}{2^{n_{j+1}}}]$, and boundary cases $I_0:= [0,1 - \frac{1}{2^{n_1}}]$, $I_k:= [1 - \frac{1}{2^{n_k}},1]$,
This defines a partition of the interval $[0,1]$, which we denote $I := I_0 \cup ... \cup I_k$.
The weaving of $1$ through $\sigma$ is then defined as follows,
\begin{align} \label{eq:In LA inductive def}
    \sigma \times I \mapsto 
    \begin{cases}
        \sigma'_1|...|\sigma'_k| 1, &I = [0, 0]\\
        \sigma'_1|...|\sigma'_j \cup 1|...|\sigma'_k, &I = I_j\\
        \sigma'_1|...|\sigma'_j|1|\sigma'_{j+1}|...|\sigma'_k, &I = I_j \cap I_{j+1}\\
        1|\sigma'_1|...|\sigma'_k, &I = [1, 1]
    \end{cases}
    , \text{where } \sigma'_i = \{x+1:x\in \sigma\}
\end{align}
\end{definition}

We illustrate the first few generations of $\divcube{n}^{\LA}$, indicating in bold, the embedding $\divcube{n-1}^{\LA}\hookrightarrow \divcube{n}^{\LA}$ that occurs when $I = [0, 0]$.

\begin{center}
{\small
\begin{tikzcd}[sep=0.3cm]
\mathbf{2|1} \arrow[r,dash, "12"] & 1|2
\end{tikzcd}
}
$\hookrightarrow$
{\small
\begin{tikzcd}[column sep=0.3cm]
1|3|2 \arrow[r,dash, "1|23"] \arrow[d,dash, "13|2"]& 1|2|3 \arrow[d,dash, "13|2"]\\
3|1|2 \arrow[d,dash, "3|12"] & 2|1|3 \arrow[d,dash, "2|13"]\\
\mathbf{3|2|1} \arrow[r,dash,thick, "23|1"] & \mathbf{2|3|1}
\end{tikzcd}
}
$\hookrightarrow$
{\small
\begin{tikzcd}[sep=0.15cm,scale=0.8]
& 1|3|4|2 \arrow[rr,dash] \arrow[dd,dash,dotted] \arrow[dl,dash] & & 1|3|2|4 \arrow [dd, dash,dotted] \arrow[rr,dash] & & 1|2|3|4 \arrow[dd,dash] \arrow[dl,dash]\\
1|4|3|2 \arrow [rr,dash] \arrow [dd,dash] & & 1|4|2|3 \arrow[rr,dash] \arrow[dd,dash] & & 1|2|4|3 \arrow[dd,dash]  & \\
& 3|1|4|2 \arrow [rr,dash,dotted] \arrow[dd,dash,dotted]  & & 3|1|2|4  \arrow[dd,dash,dotted] & & 2|1|3|4 \arrow [dl,dash] \arrow[dd,dash]\\
4|1|3|2 \arrow [rr,dash] \arrow [dd,dash]& & 4|1|2|3  \arrow[dd,dash] & & 2|1|4|3 \arrow[dd,dash]\\
& 3|4|1|2 \arrow[dd,dash,dotted] \arrow[dl,dash,dotted] & & 3|2|1|4 \arrow [dd, dash,dotted] \arrow [rr, dash,dotted] & & 2|3|1|4 \arrow[dd,dash] \\
4|3|1|2 \arrow [dd,dash] & & 4|2|1|3 \arrow[rr,dash] \arrow[dd,dash] & & 2|4|1|3 \arrow[dd,dash] & \\
& \mathbf{3|4|2|1} \arrow [rr,dash,dotted] \arrow [dl,dash,dotted] & & \mathbf{3|2|4|1} \arrow [rr,dash,dotted] & & \mathbf{2|3|4|1} \arrow [dl,dash] \\
\mathbf{4|3|2|1} \arrow [rr,dash] & & \mathbf{4|2|3|1} \arrow [rr,dash] & & \mathbf{2|4|3|1} \\
\end{tikzcd}
}
\end{center}

The appropriate base definitions for the $\LA$ diagonal of $k$-subdivision cubes (\ref{def:Subdivisions}),  pairs of subdivision cubes ${\subdivpairsv}$ (\ref{def:subdiv pairs}), and maximal pairs of subdivision cubes $\maxsubdivpairsv$ are all the same as in the $\SU$ case.
We relate these definitions to those in the $\SU$ case with the following result.
\begin{proposition}\label{prop:r is a k-subdiv cube isomorphism}
Let $r:P\to P$ be the face poset isomorphism of the permutahedra which acts on $A_1|...|A_k$, by replacing each block $A_j$ by the block $r(A_j):=\{n-i+1 \ | \ i \in A_j\}$.
Then the induced map $r:\divcube{n}^{\SU}\to \divcube{n}^{\LA}$,
\begin{enumerate}
    \item is a face poset isomorphism,
    \item conserves the dimensions of each face in $[0,1]^{n}$,
    \item is a $k$-subdivision cube isomorphism.
\end{enumerate}
\end{proposition}
\begin{proof}
The first property is immediate, as $r:P\to P$ is a face poset isomorphism.
The second may be shown inductively.
The third then follows from the first and the second.
\end{proof}

\begin{example}
Applying $r$ to \cref{ex:subdivision cubes} yields,
\begin{center}

{\scriptsize
\begin{tikzcd}[sep=0.1cm, scale=0.3]
& 4|2|1|3 \arrow[rr,dash] \arrow[dd,dash,dotted] \arrow[dl,dash] & & 4|2|3|1 \arrow [dd, dash,dotted] \arrow[rr,dash] & & 4|3|2|1 \arrow[dd,dash] \arrow[dl,dash, near end, "\mathbf{\blue{4|3|12}}"']\\
4|1|2|3 \arrow [rr,dash] \arrow [dd,dash] & & 4|1|3|2 \arrow[rr,dash] \arrow[dd,dash] & & \mathbf{\blue{4|3|1|2}} \arrow[dd,dash]  & \\
& \red{\mathbf{14|23}} \arrow [rr,dash,dotted] \arrow[dd,dash,dotted]  & & 2|4|3|1  \arrow[dd,dash,dotted] & & 3|4|2|1 \arrow [dl,dash] \arrow[dd,dash]\\
1|4|2|3 \arrow [rr,dash] \arrow [dd,dash]& & 1|4|3|2  \arrow[dd,dash] \arrow[rr, phantom, "\blue{\mathbf{134|2}}" description,crossing over] & & 3|4|1|2 \arrow[dd,dash]\\
& 2|1|4|3 \arrow[dd,dash,dotted] \arrow[dl,dash,dotted] & & 2|3|4|1 \arrow [dd, dash,dotted] \arrow [rr, dash,dotted] & & 3|2|4|1 \arrow[dd,dash] \\
1|2|4|3 \arrow [dd,dash] \arrow[rr, phantom, "\red{\mathbf{1|234}}" description,crossing over] & & 1|3|4|2 \arrow[rr,dash] \arrow[dd,dash] & & 3|1|4|2 \arrow[dd,dash] & \\
& 2|1|3|4 \arrow [rr,dash,dotted] \arrow [dl,dash,dotted] & & \red{\mathbf{13|24}} \arrow [rr,dash,dotted] & & 3|2|1|4 \arrow [dl,dash] \\
1|2|3|4 \arrow [rr,dash] & & 1|3|2|4 \arrow [rr,dash] & & 3|1|2|4 \\
\end{tikzcd}
}
$\xrightarrow{r}$
{\scriptsize
\begin{tikzcd}[sep=0.1cm, scale=0.3]
& 1|3|4|2 \arrow[rr,dash] \arrow[dd,dash,dotted] \arrow[dl,dash] & & 1|3|2|4 \arrow [dd, dash,dotted] \arrow[rr,dash] & & 1|2|3|4 \arrow[dd,dash] \arrow[dl,dash, near end, "\mathbf{\blue{1|2|34}}"']\\
1|4|3|2 \arrow [rr,dash] \arrow [dd,dash] & & 1|4|2|3 \arrow[rr,dash] \arrow[dd,dash] & & \mathbf{\blue{1|2|4|3}} \arrow[dd,dash]  & \\
& \red{\mathbf{14|23}} \arrow [rr,dash,dotted] \arrow[dd,dash,dotted]  & & 3|1|2|4  \arrow[dd,dash,dotted] & & 2|1|3|4 \arrow [dl,dash] \arrow[dd,dash]\\
4|1|3|2 \arrow [rr,dash] \arrow [dd,dash]& & 4|1|2|3  \arrow[dd,dash] \arrow[rr, phantom, "\blue{\mathbf{124|3}}" description,crossing over] & & 2|1|4|3 \arrow[dd,dash]\\
& 3|4|1|2 \arrow[dd,dash,dotted] \arrow[dl,dash,dotted] & & 3|2|1|4 \arrow [dd, dash,dotted] \arrow [rr, dash,dotted] & & 2|3|1|4 \arrow[dd,dash] \\
4|3|1|2 \arrow [dd,dash] \arrow[rr, phantom, "\red{\mathbf{4|123}}" description,crossing over] & & 4|2|1|3 \arrow[rr,dash] \arrow[dd,dash] & & 2|4|1|3 \arrow[dd,dash] & \\
& 3|4|2|1 \arrow [rr,dash,dotted] \arrow [dl,dash,dotted] & & \red{\mathbf{24|13}} \arrow [rr,dash,dotted] & & 2|3|4|1 \arrow [dl,dash] \\
4|3|2|1 \arrow [rr,dash] & & 4|2|3|1 \arrow [rr,dash] & & 2|4|3|1 \\
\end{tikzcd}
}
\end{center}
As $r$ is an isomorphism of $k$-subdivision cubes, the maximal pair of $\SU$ subdivision cubes has been mapped to a maximal pair of $\LA$ subdivision cubes.
Note that the maximal $\SU$ $2$-subdivision cube with maximal vertex $4|3|1|2$ was generated by $\SU$ right shifts.
Its image under $r$ is the maximal $\LA$ $2$-subdivision cube with minimal vertex $1|2|4|3$, and it is generated by $\LA$ right shifts.
\end{example}

As the example suggests, we can relate $\LA$ maximal subdivision cube pairs to $\LA$ shifts.
\begin{proposition}
Let $v$ be a vertex of $P_n$, then
\begin{align*}
    \maxsubdivpairsv = \bigcup_{\mathbf{M},\mathbf{N}} L_\mathbf{M}^{\LA}(\sigma) \times R_{\mathbf{N}}^{\LA}(\tau)
\end{align*}
where $\mathbf{M},\mathbf{N}$ are admissible sequences of $LA$ shifts.
\end{proposition}
\begin{proof}
This follows as a result of $r:\divcube{n}^{\SU}\to \divcube{n}^{\LA}$ being a $k$-subdivision cube isomorphism (\cref{prop:r is a k-subdiv cube isomorphism}), $t(r\times r):\LAD\to \SUD$ being an isomorphism of diagonals (\cref{rem:Alternate Isomorphism}), and the commutativity of the square 
\begin{center}
\begin{tikzcd}
SCP \arrow[r,"t(r\times r)",leftrightarrow] \arrow[d,leftrightarrow] & SCP \arrow[d,leftrightarrow]\\
\mathbb{S}_n \arrow[r,"r",leftrightarrow] & \mathbb{S}_n
\end{tikzcd}
\end{center}
The vertical arrows are the defining bijection between SCPs and permutations (\cref{def:strong-complementary-pairs}).
\end{proof}

This yields an alternate cubical formula for the $\LA$ diagonal.

\begin{proposition}
\begin{align*}
    \LAD([n]) = \bigcup_{v \in P_n} \maxsubdivpairsv
\end{align*}
\end{proposition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

\part{Higher algebraic structures}

%Commented to compile faster.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Higher tensor products}

%%%%%%%%%%%%%%%

\subsection{Topological operadic structures on the operahedra and multiplihedra}

The permutahedra are part of a more general family of polytopes called Loday realizations of the \emph{operahedra} \cite[Def.~2.9]{LA21} which encodes the notion of homotopy operad \cite[Def.~4.11]{LA21}.
For every planar tree $t$, there is a corresponding polytope $P_t$ whose codimension $k$ faces are in bijection with nestings of $t$ with $k$ non-trivial nests.
Since the operahedra are generalized permutahedra \cite[Coro.~2.16]{LA21}, a choice of diagonal for the permuthedra induces a choice of diagonal for every operahedron \cite[Coro.~1.31]{LA21}.
Every face of an operahedron is isomorphic to a product of lower-dimensional operahedra, via an isomorphism $\Theta$ which generalizes the one above, see Point (5) of \cite[Prop.~2.3]{LA21}.

\begin{definition}
    An \emph{operadic diagonal} for the operahedra is a choice of diagonal $\triangle_t$ for each operahedron~$P_t$, such that $\triangle \eqdef \{\triangle_t\}$ commutes with the map $\Theta$, i.e. it satisfies \cite[Prop.~4.14]{LA21}.
\end{definition}

\begin{theorem}[Operadic structures on the operahedra] 
    \label{thm:operahedra}
There are exactly 
\begin{enumerate}
    \item four operadic diagonals of the Loday operahedra, therefore exactly
    \item four colored topological cellular operad structures on the Loday operahedra, and incidentally exactly
    \item four universal tensor products of homotopy operads,
\end{enumerate}
two of which (the $\LA$ and $\SU$ diagonals) agree with the generalized Tamari order on fully nested trees. 
\end{theorem}

\begin{proof}
    Let us first examine Point (1).
    By \cref{prop:unique-operad}, we know that if one of the four choices $\LAD, (\LAD)^\op, \SUD, (\SUD)^\op$ is made on an operahedron $P_t$, one has to make the same choice on every lower-dimensional operahedron appearing in the decomposition $P_{t_1} \times \cdots \times P_{t_k} \cong F \subset P_t$ of a face $F$ of $P_t$. 
    Now suppose that one makes two distinct choices for two operahedra $P_t$ and $P_{t'}$.
    It is easy to find a bigger tree $t''$ of which both $t$ and $t'$ are subtrees.
    Therefore, $P_t$ and $P_{t'}$ appear as facets of $P_{t''}$ and by the preceding remark, any choice of diagonal for $P_{t''}$ will then contradict our initial two choices. 
    Thus, these had to be the same from the start, which concludes the proof. 

    Point (2) then follows from fact that a choice of diagonal for the Loday realizations of the operahedra \emph{forces} a unique topological cellular colored operad structure on them, see \cite[Thm.~4.18]{LA21}.
    Since universal tensor products of homotopy operads are induced by a colored operad structure on the operahedra \cite[Coro.~4.24]{LA21}, we obtain Point~(3).
    Finally, since only vectors with strictly descreasing coordinates induce the generalized Tamari order on the skeleton of the operahedra \cite[Prop.~3.11]{LA21}, we get the last part of the statement. 
\end{proof}

This answers the first question in \cite[Rem.~3.14]{LA21}.

Two other important families of generalized permutahedra are the \emph{Loday associahedra} and \emph{Forcey--Loday multiplihedra}, which encode respectively $\Ainf$-algebras and $\Ainf$-morphisms \cite[Prop.~4.9]{MazuirLA22}, as well as $\Ainf$-categories and $\Ainf$-functors \cite[Sect.~4.3]{MazuirLA22}.
Using the same techniques as in the case of the operahedra, they were endowed with diagonals and compatible operad and operadic bimodule structures in \cite[Thm.~1]{MazuirLA22}.
An analogous notion of \emph{operadic diagonal} is available for these polytopes, see \cite[Prop.~2.14]{MazuirLA22}.

\begin{samepage}
\begin{theorem}[Operadic structures on the multiplihedra]
There are exactly 
\begin{itemize}
    \item four operadic diagonals of the Forcey--Loday multiplihedra, therefore exactly
    \item four topological cellular operadic bimodule structures (over the Loday associahedra) on the Forcey--Loday multiplihedra, and incidentally exactly
    \item four compatible universal tensor products of $\Ainf$-algebras and $\Ainf$-morphisms,
\end{itemize}
two of which (the $\LA$ and $\SU$ diagonals) agree with the Tamari(-type) order on ($2$-colored) planar trees. 
\end{theorem}
\end{samepage}

\begin{proof}
    The proof is similar to the one of \cref{thm:operahedra}, using the results of \cite{MazuirLA22}.
\end{proof}

We shall see now that these different operadic structures are related to one another in the strongest possible sense: they are all isomorphic as topological cellular operadic structures.

%%%%%%%%%%%%%%%

\subsection{Relating operadic structures} 

%In this section we show that the four diagonals are isomorphic, and that this induces an isomorphism of the corresponding operadic structures on the operahedra, multiplihedra and associahedra.

Recall that the topological cellular operad structure on the operahedra \cite[Def.~4.17]{LA21} is given by a family of partial composition maps 
\[
\vcenter{\hbox{
\begin{tikzcd}[column sep=1cm]
\circ_i^{\LA}\ : \ P_{t'}\times P_{t''}
\arrow[r,  "\tr\times \id"]
& P_{(t',\omega)}\times P_{t''}
 \arrow[r,hookrightarrow, "\Theta"]
&
P_t \ .
\end{tikzcd}
}}  \]
Here, the map $\tr$ is the \emph{unique} topological cellular map which commutes with the diagonal~$\LAD$ \cite[Prop.~7]{masudaDiagonalAssociahedra2021}. 
This partial composition $\circ_i^\LA$ is an isomorphism (in the category $\PolySub$ \cite[Def.~4.13]{LA21}) between the product $P_{t'}\times P_{t''}$ and the facet $t' \circ_i^\LA t''$ of~$P_t$.
Using the $\SU$ diagonal $\SUD$, one can define similarly a topological operad structure via the same formula, but with a different transition map $\tr$, which commutes with $\SUD$.

Recall that a face $F$ of $P_t$ is represented by a nested tree $(t,\mathcal{N})$, which can be written uniquely as a sequence of substitution of trivially nested trees 
$(t,\mathcal{N})=t_1\circ_{i_1} t_2 \circ_{i_2} t_3 \cdots \circ_{i_k} t_{k+1}$.
Note that we do not need to specify a parenthesization of this sequence of $\circ_i$ operations since these form an operad \cite[Def.~4.7]{LA21}.
At the geometric level, we have an isomorphism
\[\circ_{i_1}^\LA \circ_{i_2}^\LA \cdots \circ_{i_k}^\LA: P_{t_1} \times P_{t_2} \times \cdots \times P_{t_{k+1}} \overset{\cong}{\longrightarrow} F \subset P_t \]
between a uniquely determined product of lower dimensional operahedra, and the face $F=(t,\mathcal{N})$ of~$P_t$.
Note that we can omit the parentheses in the sequence of $\circ_i^\LA$ operations since they define an operad structure \cite[Thm.~4.18]{LA21}.
The same holds when taking the~$\circ_i^\SU$ operations instead of the $\circ_i^\LA$. 

\begin{definition}
    For any operahedron $P_t$, the map $\Psi_t : P_t \to P_t$ is defined 
    \begin{itemize}
        \item on the interior of the top face by the identity $\id : \mathring P_t \to \mathring P_t$, and 
        \item on the interior of the face $F=t_1 \circ_{i_1} t_2 \circ_{i_2} \cdots \circ_{i_k} t_{k+1}$ of~$P_t$ by the composition of the isomorphisms
        \[ 
        (\circ_{i_1}^\SU \circ_{i_2}^\SU \cdots \circ_{i_k}^\SU) (\circ_{i_1}^\LA \circ_{i_2}^\LA \cdots \circ_{i_k}^\LA)^{-1}: F \to F \ . \] 
    \end{itemize}
\end{definition}

\begin{proposition}
    \label{thm:top-iso}
    The map $\Psi \eqdef \{\Psi_t\}$ is an isomorphism of topological cellular symmetric colored operad in the category $\PolySub$.
\end{proposition}

\begin{proof}
    By definition, we have that $\Psi$ is an isomorphism in the category $\PolySub$. 
    It remains to show that it preserves the operad structures, i.e. that the following diagram commutes
    \[
    \vcenter{\hbox{
    \begin{tikzcd}[column sep=2.2cm, row sep=1.3cm]
    P_{t'}\times P_{t''}
    \arrow[r,  "\circ_i^\LA"] 
    \arrow[d,  "\Psi_{t'}\times\Psi_{t''}"]
    & P_{t} \arrow[d,  "\Psi_t"] \\
    P_{t'}\times P_{t''}  
    \arrow[r,  "\circ_i^\SU"]
    & P_{t}\ .
    \end{tikzcd}
    }}\]
    For two interior points $(x,y) \in \mathring P_{t'}\times \mathring P_{t''}$, the diagram clearly commutes by definition, since $\Psi_{t'}$ $\Psi_{t''}$ are the identity in that case. 
    If $x$ is in a face $F=t_1 \circ_{i_1} t_2 \circ_{i_2} \cdots \circ_{i_k} t_{k+1}$ of the boundary of $P_{t'}$, then the lower composite is equal to $\circ_i^\SU (\circ_{i_1}^\SU \circ_{i_2}^\SU \cdots \circ_{i_k}^\SU \times \id)(\circ_{i_1}^\LA \circ_{i_2}^\LA \cdots \circ_{i_k}^\LA \times \id)^{-1}$, and so is the upper composite since $\Psi_t$ starts with the inverse $(\circ_i^\LA)^{-1}$ and the decomposition of $F$ unto $P_{t_1} \times \cdots \times P_{t_{k+1}} \times P_{t''}$ is unique.
    The case when $y$ is in the boundary of $P_{t''}$ is similar.  
    Finally, the compatibility of $\Psi$ with units and the symmetric group actions are straightfoward to check, see \cite[Def.~4.17 \& Thm.~4.18]{LA21}.
\end{proof}

Note that $\Psi$ is \emph{not} a morphism of ``Hopf" operads, i.e. it does not commute with the respective diagonals $\LAD$ and $\SUD$. 
\Guillaume{Give explicit counterexample}

\begin{corollary}
    The four topological operad structures on the operahedra are all isomorphic. 
\end{corollary}

\begin{proof}
    It is clear that the proof of \cref{thm:top-iso} does not depend on the specific choices of diagonals $\LAD$ and $\SUD$, it can therefore be applied to any pair of diagonals among $\LA, \LA^\op, \SU$ and $\SU^\op$. 
\end{proof}

\Guillaume{Find an iso which commutes??}

\begin{example}
    This isomorphism is a highly non-trivial map. 
    For instance, it is not the one you would expect...  [compare with the general symmetries]
\end{example}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Tensor products of homotopy operads and morphims}

Even though the diagonals of the permutahedra are isomorphic, and the operad structures that they induce are as well, the tensor products of homotopy operads and $\Ainf$-morphisms that they define are \emph{not} isomorphic.
The purpose of this short section is to exhibit counterexamples.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Aknowledgements}

Hugh Thomas (everything started in Montr\'eal), Sylvie Corteel for hyperplane arrangements

Saneblidze--Umble for useful correspondence

We would like to thank the Max Planck Institute for Mathematics in Bonn where part of this work was carried out. BDO was partially supported by the French ANR grants ALCOHOL (ANR-19-CE40-0006), CARPLO (ANR-20-CE40-0007), HighAGT (ANR-20-CE40-0016) and S3 (ANR-20-CE48-0010). GLA and KS were supported by the Australian Research Council Future Fellowship FT210100256. VP was partially supported by the French ANR grant CHARMS (ANR-19-CE40-0017) and by the French--Austrian project PAGCAP (ANR-21-CE48-0020 \& FWF I 5788). KS was supported by an Australian Government Research Training Program (RTP) Scholarship.

Galashin (asked about characteristic polynomials). Organizers of the Simon Center conference.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{alpha}
\bibliography{diagonalsPermutahedra}
\label{sec:biblio}

\end{document}
